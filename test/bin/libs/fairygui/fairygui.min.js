var fgui;!function(fgui){fgui.ControllerAction=class{constructor(){}static createAction(type){switch(type){case 0:return new fgui.PlayTransitionAction;case 1:return new fgui.ChangePageAction}return null}run(controller,prevPage,curPage){null!=this.fromPage&&0!=this.fromPage.length&&-1==this.fromPage.indexOf(prevPage)||null!=this.toPage&&0!=this.toPage.length&&-1==this.toPage.indexOf(curPage)?this.leave(controller):this.enter(controller)}enter(controller){}leave(controller){}setup(buffer){var cnt,i;for(cnt=buffer.getInt16(),this.fromPage=[],i=0;i<cnt;i++)this.fromPage[i]=buffer.readS();for(cnt=buffer.getInt16(),this.toPage=[],i=0;i<cnt;i++)this.toPage[i]=buffer.readS()}}}(fgui||(fgui={})),function(fgui){fgui.PlayTransitionAction=class extends fgui.ControllerAction{constructor(){super(),this.playTimes=1,this.delay=0,this.stopOnExit=!1}enter(controller){var trans=controller.parent.getTransition(this.transitionName);trans&&(this._currentTransition&&this._currentTransition.playing?trans.changePlayTimes(this.playTimes):trans.play(null,this.playTimes,this.delay),this._currentTransition=trans)}leave(controller){this.stopOnExit&&this._currentTransition&&(this._currentTransition.stop(),this._currentTransition=null)}setup(buffer){super.setup(buffer),this.transitionName=buffer.readS(),this.playTimes=buffer.getInt32(),this.delay=buffer.getFloat32(),this.stopOnExit=buffer.readBool()}}}(fgui||(fgui={})),function(fgui){fgui.ChangePageAction=class extends fgui.ControllerAction{constructor(){super()}enter(controller){var gcom;if(this.controllerName&&(gcom=this.objectId?controller.parent.getChildById(this.objectId):controller.parent)){var cc=gcom.getController(this.controllerName);cc&&cc!=controller&&!cc.changing&&(cc.selectedPageId=this.targetPage)}}setup(buffer){super.setup(buffer),this.objectId=buffer.readS(),this.controllerName=buffer.readS(),this.targetPage=buffer.readS()}}}(fgui||(fgui={})),function(fgui){fgui.BitmapFont=class{constructor(){this.size=0,this.glyphs={}}};fgui.BMGlyph=class{constructor(){this.offsetX=0,this.offsetY=0,this.width=0,this.height=0,this.advance=0,this.lineHeight=0,this.channel=0}}}(fgui||(fgui={})),function(fgui){fgui.Image=class extends Laya.Sprite{constructor(){super(),this._scaleByTile=!1,this._scale9Grid=null,this._tileGridIndice=0,this._needRebuild=0,this._fillMethod=0,this._fillOrigin=0,this._fillAmount=0,this._fillClockwise=!1,this._mask=null,this.mouseEnabled=!1,this._color="#FFFFFF"}set width(value){this._width!==value&&(super.set_width(value),this.markChanged(1))}set height(value){this._height!==value&&(super.set_height(value),this.markChanged(1))}get texture(){return this._source}set texture(value){this._source!=value&&(this._source=value,0==this._width&&(this._source?this.size(this._source.width,this._source.height):this.size(0,0)),this.repaint(),this.markChanged(1))}get scale9Grid(){return this._scale9Grid}set scale9Grid(value){this._scale9Grid=value,this._sizeGrid=null,this.markChanged(1)}get scaleByTile(){return this._scaleByTile}set scaleByTile(value){this._scaleByTile!=value&&(this._scaleByTile=value,this.markChanged(1))}get tileGridIndice(){return this._tileGridIndice}set tileGridIndice(value){this._tileGridIndice!=value&&(this._tileGridIndice=value,this.markChanged(1))}get fillMethod(){return this._fillMethod}set fillMethod(value){this._fillMethod!=value&&(this._fillMethod=value,0!=this._fillMethod?(this._mask||(this._mask=new Laya.Sprite,this._mask.mouseEnabled=!1),this.mask=this._mask,this.markChanged(2)):this.mask&&(this._mask.graphics.clear(),this.mask=null))}get fillOrigin(){return this._fillOrigin}set fillOrigin(value){this._fillOrigin!=value&&(this._fillOrigin=value,0!=this._fillMethod&&this.markChanged(2))}get fillClockwise(){return this._fillClockwise}set fillClockwise(value){this._fillClockwise!=value&&(this._fillClockwise=value,0!=this._fillMethod&&this.markChanged(2))}get fillAmount(){return this._fillAmount}set fillAmount(value){this._fillAmount!=value&&(this._fillAmount=value,0!=this._fillMethod&&this.markChanged(2))}get color(){return this._color}set color(value){this._color!=value&&(this._color=value)}markChanged(flag){this._needRebuild?this._needRebuild|=flag:(this._needRebuild=flag,Laya.timer.callLater(this,this.rebuild))}rebuild(){0!=(1&this._needRebuild)&&this.doDraw(),0!=(2&this._needRebuild)&&0!=this._fillMethod&&this.doFill(),this._needRebuild=0}doDraw(){var w=this._width,h=this._height,g=this.graphics,tex=this._source;if(g.clear(),null!=tex&&0!=w&&0!=h)if(this._scaleByTile)g.fillTexture(tex,0,0,w,h);else if(null!=this._scale9Grid){if(!this._sizeGrid){var tw=tex.width,th=tex.height,left=this._scale9Grid.x,right=Math.max(tw-this._scale9Grid.right,0),top=this._scale9Grid.y,bottom=Math.max(th-this._scale9Grid.bottom,0);this._sizeGrid=[top,right,bottom,left]}g.draw9Grid(tex,0,0,w,h,this._sizeGrid)}else g.drawImage(tex,0,0,w,h)}doFill(){var w=this._width,h=this._height,g=this._mask.graphics;if(g.clear(),0!=w&&0!=h){var points=fgui.FillUtils.fill(w,h,this._fillMethod,this._fillOrigin,this._fillClockwise,this._fillAmount);if(null==points)return this.mask=null,void(this.mask=this._mask);g.drawPoly(0,0,points,"#FFFFFF")}}}}(fgui||(fgui={})),function(fgui){fgui.MovieClip=class extends fgui.Image{constructor(){super(),this.interval=0,this.swing=!1,this.repeatDelay=0,this.timeScale=1,this._playing=!0,this._frameCount=0,this._frame=0,this._start=0,this._end=0,this._times=0,this._endAt=0,this._status=0,this._endHandler=null,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.mouseEnabled=!1,this.setPlaySettings(),this.on(Laya.Event.DISPLAY,this,this.__addToStage),this.on(Laya.Event.UNDISPLAY,this,this.__removeFromStage)}get frames(){return this._frames}set frames(value){this._frames=value,this._scaleByTile=!1,this._scale9Grid=null,null!=this._frames?(this._frameCount=this._frames.length,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),(-1==this._endAt||this._endAt>this._frameCount-1)&&(this._endAt=this._frameCount-1),(this._frame<0||this._frame>this._frameCount-1)&&(this._frame=this._frameCount-1),this._frameElapsed=0,this._repeatedCount=0,this._reversed=!1):this._frameCount=0,this.drawFrame(),this.checkTimer()}get frameCount(){return this._frameCount}get frame(){return this._frame}set frame(value){this._frame!=value&&(null!=this._frames&&value>=this._frameCount&&(value=this._frameCount-1),this._frame=value,this._frameElapsed=0,this.drawFrame())}get playing(){return this._playing}set playing(value){this._playing!=value&&(this._playing=value,this.checkTimer())}rewind(){this._frame=0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.drawFrame()}syncStatus(anotherMc){this._frame=anotherMc._frame,this._frameElapsed=anotherMc._frameElapsed,this._reversed=anotherMc._reversed,this._repeatedCount=anotherMc._repeatedCount,this.drawFrame()}advance(timeInMiniseconds){for(var beginFrame=this._frame,beginReversed=this._reversed,backupTime=timeInMiniseconds;;){var tt=this.interval+this._frames[this._frame].addDelay;if(0==this._frame&&this._repeatedCount>0&&(tt+=this.repeatDelay),timeInMiniseconds<tt){this._frameElapsed=0;break}if(timeInMiniseconds-=tt,this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),this._frame==beginFrame&&this._reversed==beginReversed){var roundTime=backupTime-timeInMiniseconds;timeInMiniseconds-=Math.floor(timeInMiniseconds/roundTime)*roundTime}}this.drawFrame()}setPlaySettings(start=0,end=-1,times=0,endAt=-1,endHandler=null){this._start=start,this._end=end,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),this._times=times,this._endAt=endAt,-1==this._endAt&&(this._endAt=this._end),this._status=0,this._endHandler=endHandler,this.frame=start}update(){if(this._playing&&0!=this._frameCount&&3!=this._status){var dt=Laya.timer.delta;dt>100&&(dt=100),1!=this.timeScale&&(dt*=this.timeScale),this._frameElapsed+=dt;var tt=this.interval+this._frames[this._frame].addDelay;if(0==this._frame&&this._repeatedCount>0&&(tt+=this.repeatDelay),!(this._frameElapsed<tt)){if(this._frameElapsed-=tt,this._frameElapsed>this.interval&&(this._frameElapsed=this.interval),this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),1==this._status)this._frame=this._start,this._frameElapsed=0,this._status=0;else if(2==this._status){if(this._frame=this._endAt,this._frameElapsed=0,this._status=3,null!=this._endHandler){var handler=this._endHandler;this._endHandler=null,handler.run()}}else this._frame==this._end&&(this._times>0?(this._times--,0==this._times?this._status=2:this._status=1):0!=this._start&&(this._status=1));this.drawFrame()}}}drawFrame(){if(this._frameCount>0&&this._frame<this._frames.length){var frame=this._frames[this._frame];this.texture=frame.texture}else this.texture=null;this.rebuild()}checkTimer(){this._playing&&this._frameCount>0&&null!=this.stage?Laya.timer.frameLoop(1,this,this.update):Laya.timer.clear(this,this.update)}__addToStage(){this._playing&&this._frameCount>0&&Laya.timer.frameLoop(1,this,this.update)}__removeFromStage(){Laya.timer.clear(this,this.update)}};fgui.Frame=class{constructor(){this.addDelay=0}}}(fgui||(fgui={})),function(fgui){class FillUtils{static fill(w,h,method,origin,clockwise,amount){if(amount<=0)return null;if(amount>=.9999)return[0,0,w,0,w,h,0,h];var points;switch(method){case fgui.FillMethod.Horizontal:points=FillUtils.fillHorizontal(w,h,origin,amount);break;case fgui.FillMethod.Vertical:points=FillUtils.fillVertical(w,h,origin,amount);break;case fgui.FillMethod.Radial90:points=FillUtils.fillRadial90(w,h,origin,clockwise,amount);break;case fgui.FillMethod.Radial180:points=FillUtils.fillRadial180(w,h,origin,clockwise,amount);break;case fgui.FillMethod.Radial360:points=FillUtils.fillRadial360(w,h,origin,clockwise,amount)}return points}static fillHorizontal(w,h,origin,amount){var w2=w*amount;return origin==fgui.FillOrigin.Left||origin==fgui.FillOrigin.Top?[0,0,w2,0,w2,h,0,h]:[w,0,w,h,w-w2,h,w-w2,0]}static fillVertical(w,h,origin,amount){var h2=h*amount;return origin==fgui.FillOrigin.Left||origin==fgui.FillOrigin.Top?[0,0,0,h2,w,h2,w,0]:[0,h,w,h,w,h-h2,0,h-h2]}static fillRadial90(w,h,origin,clockwise,amount){var v2,h2,points;switch((!clockwise||origin!=fgui.FillOrigin.TopRight&&origin!=fgui.FillOrigin.BottomLeft)&&(clockwise||origin!=fgui.FillOrigin.TopLeft&&origin!=fgui.FillOrigin.BottomRight)||(amount=1-amount),v2=((h2=w*Math.tan(Math.PI/2*amount))-h)/h2,origin){case fgui.FillOrigin.TopLeft:points=clockwise?h2<=h?[0,0,w,h2,w,0]:[0,0,w*(1-v2),h,w,h,w,0]:h2<=h?[0,0,w,h2,w,h,0,h]:[0,0,w*(1-v2),h,0,h];break;case fgui.FillOrigin.TopRight:points=clockwise?h2<=h?[w,0,0,h2,0,h,w,h]:[w,0,w*v2,h,w,h]:h2<=h?[w,0,0,h2,0,0]:[w,0,w*v2,h,0,h,0,0];break;case fgui.FillOrigin.BottomLeft:points=clockwise?h2<=h?[0,h,w,h-h2,w,0,0,0]:[0,h,w*(1-v2),0,0,0]:h2<=h?[0,h,w,h-h2,w,h]:[0,h,w*(1-v2),0,w,0,w,h];break;case fgui.FillOrigin.BottomRight:points=clockwise?h2<=h?[w,h,0,h-h2,0,h]:[w,h,w*v2,0,0,0,0,h]:h2<=h?[w,h,0,h-h2,0,0,w,0]:[w,h,w*v2,0,w,0]}return points}static movePoints(points,offsetX,offsetY){for(var cnt=points.length,i=0;i<cnt;i+=2)points[i]+=offsetX,points[i+1]+=offsetY}static fillRadial180(w,h,origin,clockwise,amount){var points;switch(origin){case fgui.FillOrigin.Top:amount<=.5?(amount/=.5,points=FillUtils.fillRadial90(w/2,h,clockwise?fgui.FillOrigin.TopLeft:fgui.FillOrigin.TopRight,clockwise,amount),clockwise&&FillUtils.movePoints(points,w/2,0)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial90(w/2,h,clockwise?fgui.FillOrigin.TopRight:fgui.FillOrigin.TopLeft,clockwise,amount),clockwise?points.push(w,h,w,0):(FillUtils.movePoints(points,w/2,0),points.push(0,h,0,0)));break;case fgui.FillOrigin.Bottom:amount<=.5?(amount/=.5,points=FillUtils.fillRadial90(w/2,h,clockwise?fgui.FillOrigin.BottomRight:fgui.FillOrigin.BottomLeft,clockwise,amount),clockwise||FillUtils.movePoints(points,w/2,0)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial90(w/2,h,clockwise?fgui.FillOrigin.BottomLeft:fgui.FillOrigin.BottomRight,clockwise,amount),clockwise?(FillUtils.movePoints(points,w/2,0),points.push(0,0,0,h)):points.push(w,0,w,h));break;case fgui.FillOrigin.Left:amount<=.5?(amount/=.5,points=FillUtils.fillRadial90(w,h/2,clockwise?fgui.FillOrigin.BottomLeft:fgui.FillOrigin.TopLeft,clockwise,amount),clockwise||FillUtils.movePoints(points,0,h/2)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial90(w,h/2,clockwise?fgui.FillOrigin.TopLeft:fgui.FillOrigin.BottomLeft,clockwise,amount),clockwise?(FillUtils.movePoints(points,0,h/2),points.push(w,0,0,0)):points.push(w,h,0,h));break;case fgui.FillOrigin.Right:amount<=.5?(amount/=.5,points=FillUtils.fillRadial90(w,h/2,clockwise?fgui.FillOrigin.TopRight:fgui.FillOrigin.BottomRight,clockwise,amount),clockwise&&FillUtils.movePoints(points,0,h/2)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial90(w,h/2,clockwise?fgui.FillOrigin.BottomRight:fgui.FillOrigin.TopRight,clockwise,amount),clockwise?points.push(0,h,w,h):(FillUtils.movePoints(points,0,h/2),points.push(0,0,w,0)))}return points}static fillRadial360(w,h,origin,clockwise,amount){var points;switch(origin){case fgui.FillOrigin.Top:amount<=.5?(amount/=.5,points=FillUtils.fillRadial180(w/2,h,clockwise?fgui.FillOrigin.Left:fgui.FillOrigin.Right,clockwise,amount),clockwise&&FillUtils.movePoints(points,w/2,0)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial180(w/2,h,clockwise?fgui.FillOrigin.Right:fgui.FillOrigin.Left,clockwise,amount),clockwise?points.push(w,h,w,0,w/2,0):(FillUtils.movePoints(points,w/2,0),points.push(0,h,0,0,w/2,0)));break;case fgui.FillOrigin.Bottom:amount<=.5?(amount/=.5,points=FillUtils.fillRadial180(w/2,h,clockwise?fgui.FillOrigin.Right:fgui.FillOrigin.Left,clockwise,amount),clockwise||FillUtils.movePoints(points,w/2,0)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial180(w/2,h,clockwise?fgui.FillOrigin.Left:fgui.FillOrigin.Right,clockwise,amount),clockwise?(FillUtils.movePoints(points,w/2,0),points.push(0,0,0,h,w/2,h)):points.push(w,0,w,h,w/2,h));break;case fgui.FillOrigin.Left:amount<=.5?(amount/=.5,points=FillUtils.fillRadial180(w,h/2,clockwise?fgui.FillOrigin.Bottom:fgui.FillOrigin.Top,clockwise,amount),clockwise||FillUtils.movePoints(points,0,h/2)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial180(w,h/2,clockwise?fgui.FillOrigin.Top:fgui.FillOrigin.Bottom,clockwise,amount),clockwise?(FillUtils.movePoints(points,0,h/2),points.push(w,0,0,0,0,h/2)):points.push(w,h,0,h,0,h/2));break;case fgui.FillOrigin.Right:amount<=.5?(amount/=.5,points=FillUtils.fillRadial180(w,h/2,clockwise?fgui.FillOrigin.Top:fgui.FillOrigin.Bottom,clockwise,amount),clockwise&&FillUtils.movePoints(points,0,h/2)):(amount=(amount-.5)/.5,points=FillUtils.fillRadial180(w,h/2,clockwise?fgui.FillOrigin.Bottom:fgui.FillOrigin.Top,clockwise,amount),clockwise?points.push(0,h,w,h,w,h/2):(FillUtils.movePoints(points,0,h/2),points.push(0,0,w,0,w,h/2)))}return points}}fgui.FillUtils=FillUtils}(fgui||(fgui={})),function(fgui){class ByteBuffer extends Laya.Byte{constructor(data=null,offset=0,length=-1){-1==length&&(length=data.byteLength-offset),0==offset&&length==data.byteLength?super(data):(super(),this._u8d_=new Uint8Array(data,offset,length),this._d_=new DataView(this._u8d_.buffer,offset,length),this._length=length),this.endian=Laya.Byte.BIG_ENDIAN}skip(count){this.pos+=count}readBool(){return 1==this.getUint8()}readS(){var index=this.getUint16();return 65534==index?null:65533==index?"":this.stringTable[index]}writeS(value){var index=this.getUint16();65534!=index&&65533!=index&&(this.stringTable[index]=value)}readColor(hasAlpha=!1){var r=this.getUint8(),g=this.getUint8(),b=this.getUint8(),a=this.getUint8();return(hasAlpha?a<<24:0)+(r<<16)+(g<<8)+b}readColorS(hasAlpha=!1){var r=this.getUint8(),g=this.getUint8(),b=this.getUint8(),a=this.getUint8();if(hasAlpha&&255!=a)return"rgba("+r+","+g+","+b+","+a/255+")";var sr=r.toString(16),sg=g.toString(16),sb=b.toString(16);return 1==sr.length&&(sr="0"+sr),1==sg.length&&(sg="0"+sg),1==sb.length&&(sb="0"+sb),"#"+sr+sg+sb}readChar(){var i=this.getUint16();return String.fromCharCode(i)}readBuffer(){var count=this.getUint32(),ba=new ByteBuffer(this.buffer,this._pos_,count);return ba.stringTable=this.stringTable,ba.version=this.version,ba}seek(indexTablePos,blockIndex){var newPos,tmp=this._pos_;return this.pos=indexTablePos,blockIndex<this.getUint8()?(1==this.getUint8()?(this.pos+=2*blockIndex,newPos=this.getUint16()):(this.pos+=4*blockIndex,newPos=this.getUint32()),newPos>0?(this.pos=indexTablePos+newPos,!0):(this.pos=tmp,!1)):(this.pos=tmp,!1)}}fgui.ByteBuffer=ByteBuffer}(fgui||(fgui={})),function(fgui){let _func=Laya.HitArea._isHitGraphic;fgui.ChildHitArea=class extends Laya.HitArea{constructor(child,reversed){super(),this._child=child,this._reversed=reversed,this._reversed?this.unHit=child.hitArea.hit:this.hit=child.hitArea.hit}contains(x,y){var tPos;return(tPos=Laya.Point.TEMP).setTo(0,0),tPos=this._child.toParentPoint(tPos),this._reversed?!_func(x-tPos.x,y-tPos.y,this.unHit):_func(x-tPos.x,y-tPos.y,this.hit)}}}(fgui||(fgui={})),function(fgui){class UBBParser{constructor(){this._readPos=0,this.smallFontSize=12,this.normalFontSize=14,this.largeFontSize=16,this.defaultImgWidth=0,this.defaultImgHeight=0,this._handlers={},this._handlers.url=this.onTag_URL,this._handlers.img=this.onTag_IMG,this._handlers.b=this.onTag_Simple,this._handlers.i=this.onTag_Simple,this._handlers.u=this.onTag_Simple,this._handlers.sup=this.onTag_Simple,this._handlers.sub=this.onTag_Simple,this._handlers.color=this.onTag_COLOR,this._handlers.font=this.onTag_FONT,this._handlers.size=this.onTag_SIZE}onTag_URL(tagName,end,attr){return end?"</a>":null!=attr?'<a href="'+attr+'" target="_blank">':'<a href="'+this.getTagText()+'" target="_blank">'}onTag_IMG(tagName,end,attr){if(end)return null;var src=this.getTagText(!0);return src?this.defaultImgWidth?'<img src="'+src+'" width="'+this.defaultImgWidth+'" height="'+this.defaultImgHeight+'"/>':'<img src="'+src+'"/>':null}onTag_Simple(tagName,end,attr){return end?"</"+tagName+">":"<"+tagName+">"}onTag_COLOR(tagName,end,attr){return end?"</span>":'<span style="color:'+attr+'">'}onTag_FONT(tagName,end,attr){return end?"</span>":'<span style="font-family:'+attr+'">'}onTag_SIZE(tagName,end,attr){return end?"</span>":("normal"==attr?attr=""+this.normalFontSize:"small"==attr?attr=""+this.smallFontSize:"large"==attr?attr=""+this.largeFontSize:attr.length&&"+"==attr.charAt(0)?attr=""+(this.smallFontSize+parseInt(attr.substr(1))):attr.length&&"-"==attr.charAt(0)&&(attr=""+(this.smallFontSize-parseInt(attr.substr(1)))),'<span style="font-size:'+attr+'">')}getTagText(remove=!1){for(var pos2,pos1=this._readPos,result="";-1!=(pos2=this._text.indexOf("[",pos1));){if(92!=this._text.charCodeAt(pos2-1)){result+=this._text.substring(pos1,pos2);break}result+=this._text.substring(pos1,pos2-1),result+="[",pos1=pos2+1}return-1==pos2?null:(remove&&(this._readPos=pos2),result)}parse(text,remove=!1){this._text=text;for(var pos2,pos3,end,tag,attr,repl,func,pos1=0,result="";-1!=(pos2=this._text.indexOf("[",pos1));)if(pos2>0&&92==this._text.charCodeAt(pos2-1))result+=this._text.substring(pos1,pos2-1),result+="[",pos1=pos2+1;else{if(result+=this._text.substring(pos1,pos2),pos1=pos2,-1==(pos2=this._text.indexOf("]",pos1)))break;end="/"==this._text.charAt(pos1+1),tag=this._text.substring(end?pos1+2:pos1+1,pos2),this._readPos=pos2+1,attr=null,repl=null,-1!=(pos3=tag.indexOf("="))&&(attr=tag.substring(pos3+1),tag=tag.substring(0,pos3)),tag=tag.toLowerCase(),null!=(func=this._handlers[tag])?remove||null!=(repl=func.call(this,tag,end,attr))&&(result+=repl):result+=this._text.substring(pos1,this._readPos),pos1=this._readPos}return pos1<this._text.length&&(result+=this._text.substr(pos1)),this._text=null,result}}UBBParser.inst=new UBBParser,fgui.UBBParser=UBBParser}(fgui||(fgui={})),function(fgui){fgui.PixelHitTest=class extends Laya.HitArea{constructor(data,offsetX=0,offsetY=0){super(),this._data=data,this.offsetX=offsetX,this.offsetY=offsetY,this.scaleX=1,this.scaleY=1}contains(x,y){if(x=Math.floor((x/this.scaleX-this.offsetX)*this._data.scale),y=Math.floor((y/this.scaleY-this.offsetY)*this._data.scale),x<0||y<0||x>=this._data.pixelWidth)return!1;var pos=y*this._data.pixelWidth+x,pos2=Math.floor(pos/8),pos3=pos%8;return pos2>=0&&pos2<this._data.pixels.length&&1==(this._data.pixels[pos2]>>pos3&1)}};fgui.PixelHitTestData=class{constructor(){}load(ba){ba.getInt32(),this.pixelWidth=ba.getInt32(),this.scale=1/ba.readByte();var len=ba.getInt32();this.pixels=[];for(var i=0;i<len;i++){var j=ba.readByte();j<0&&(j+=256),this.pixels[i]=j}}}}(fgui||(fgui={})),function(fgui){class ToolSet{static getFileName(source){var i=source.lastIndexOf("/");return-1!=i&&(source=source.substr(i+1)),-1!=(i=source.lastIndexOf("\\"))&&(source=source.substr(i+1)),-1!=(i=source.lastIndexOf("."))?source.substring(0,i):source}static startsWith(source,str,ignoreCase=!1){return!!source&&(!(source.length<str.length)&&(source=source.substring(0,str.length),ignoreCase?source.toLowerCase()==str.toLowerCase():source==str))}static endsWith(source,str,ignoreCase=!1){return!!source&&(!(source.length<str.length)&&(source=source.substring(source.length-str.length),ignoreCase?source.toLowerCase()==str.toLowerCase():source==str))}static trim(targetString){return ToolSet.trimLeft(ToolSet.trimRight(targetString))}static trimLeft(targetString){for(var tempChar="",i=0;i<targetString.length&&(" "==(tempChar=targetString.charAt(i))||"\n"==tempChar||"\r"==tempChar);i++);return targetString.substr(i)}static trimRight(targetString){for(var tempChar="",i=targetString.length-1;i>=0&&(" "==(tempChar=targetString.charAt(i))||"\n"==tempChar||"\r"==tempChar);i--);return targetString.substring(0,i+1)}static convertToHtmlColor(argb,hasAlpha=!1){var alpha;alpha=hasAlpha?(argb>>24&255).toString(16):"";var red=(argb>>16&255).toString(16),green=(argb>>8&255).toString(16),blue=(255&argb).toString(16);return 1==alpha.length&&(alpha="0"+alpha),1==red.length&&(red="0"+red),1==green.length&&(green="0"+green),1==blue.length&&(blue="0"+blue),"#"+alpha+red+green+blue}static convertFromHtmlColor(str,hasAlpha=!1){return str.length<1?0:("#"==str.charAt(0)&&(str=str.substr(1)),8==str.length?(parseInt(str.substr(0,2),16)<<24)+parseInt(str.substr(2),16):hasAlpha?4278190080+parseInt(str,16):parseInt(str,16))}static displayObjectToGObject(obj){for(;null!=obj&&!(obj instanceof Laya.Stage);){if(obj.$owner)return obj.$owner;obj=obj.parent}return null}static encodeHTML(str){return str?str.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("'","&apos;"):""}static parseUBB(text){return ToolSet.defaultUBBParser.parse(text)}static removeUBB(text){return ToolSet.defaultUBBParser.parse(text,!0)}static clamp(value,min,max){return value<min?value=min:value>max&&(value=max),value}static clamp01(value){return value>1?value=1:value<0&&(value=0),value}static lerp(start,end,percent){return start+percent*(end-start)}}ToolSet.defaultUBBParser=new fgui.UBBParser,fgui.ToolSet=ToolSet}(fgui||(fgui={})),function(fgui){class ColorMatrix extends Array{constructor(){super(),this.reset()}static create(p_brightness,p_contrast,p_saturation,p_hue){var ret=new ColorMatrix;return ret.adjustColor(p_brightness,p_contrast,p_saturation,p_hue),ret}reset(){for(var i=0;i<ColorMatrix.LENGTH;i++)this[i]=ColorMatrix.IDENTITY_MATRIX[i]}invert(){this.multiplyMatrix([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])}adjustColor(p_brightness,p_contrast,p_saturation,p_hue){this.adjustHue(p_hue),this.adjustContrast(p_contrast),this.adjustBrightness(p_brightness),this.adjustSaturation(p_saturation)}adjustBrightness(p_val){p_val=255*this.cleanValue(p_val,1),this.multiplyMatrix([1,0,0,0,p_val,0,1,0,0,p_val,0,0,1,0,p_val,0,0,0,1,0])}adjustContrast(p_val){var s=(p_val=this.cleanValue(p_val,1))+1,o=128*(1-s);this.multiplyMatrix([s,0,0,0,o,0,s,0,0,o,0,0,s,0,o,0,0,0,1,0])}adjustSaturation(p_val){p_val=this.cleanValue(p_val,1);var invSat=1-(p_val+=1),invLumR=invSat*ColorMatrix.LUMA_R,invLumG=invSat*ColorMatrix.LUMA_G,invLumB=invSat*ColorMatrix.LUMA_B;this.multiplyMatrix([invLumR+p_val,invLumG,invLumB,0,0,invLumR,invLumG+p_val,invLumB,0,0,invLumR,invLumG,invLumB+p_val,0,0,0,0,0,1,0])}adjustHue(p_val){p_val=this.cleanValue(p_val,1),p_val*=Math.PI;var cos=Math.cos(p_val),sin=Math.sin(p_val);this.multiplyMatrix([ColorMatrix.LUMA_R+cos*(1-ColorMatrix.LUMA_R)+sin*-ColorMatrix.LUMA_R,ColorMatrix.LUMA_G+cos*-ColorMatrix.LUMA_G+sin*-ColorMatrix.LUMA_G,ColorMatrix.LUMA_B+cos*-ColorMatrix.LUMA_B+sin*(1-ColorMatrix.LUMA_B),0,0,ColorMatrix.LUMA_R+cos*-ColorMatrix.LUMA_R+.143*sin,ColorMatrix.LUMA_G+cos*(1-ColorMatrix.LUMA_G)+.14*sin,ColorMatrix.LUMA_B+cos*-ColorMatrix.LUMA_B+-.283*sin,0,0,ColorMatrix.LUMA_R+cos*-ColorMatrix.LUMA_R+sin*-(1-ColorMatrix.LUMA_R),ColorMatrix.LUMA_G+cos*-ColorMatrix.LUMA_G+sin*ColorMatrix.LUMA_G,ColorMatrix.LUMA_B+cos*(1-ColorMatrix.LUMA_B)+sin*ColorMatrix.LUMA_B,0,0,0,0,0,1,0])}concatMatrix(p_matrix){p_matrix.length==ColorMatrix.LENGTH&&this.multiplyMatrix(p_matrix)}clone(){var result=new ColorMatrix;return result.copyMatrix(this),result}copyMatrix(p_matrix){for(var l=ColorMatrix.LENGTH,i=0;i<l;i++)this[i]=p_matrix[i]}multiplyMatrix(p_matrix){for(var col=[],i=0,y=0;y<4;++y){for(var x=0;x<5;++x)col[i+x]=p_matrix[i]*this[x]+p_matrix[i+1]*this[x+5]+p_matrix[i+2]*this[x+10]+p_matrix[i+3]*this[x+15]+(4==x?p_matrix[i+4]:0);i+=5}this.copyMatrix(col)}cleanValue(p_val,p_limit){return Math.min(p_limit,Math.max(-p_limit,p_val))}}ColorMatrix.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],ColorMatrix.LENGTH=ColorMatrix.IDENTITY_MATRIX.length,ColorMatrix.LUMA_R=.299,ColorMatrix.LUMA_G=.587,ColorMatrix.LUMA_B=.114,fgui.ColorMatrix=ColorMatrix}(fgui||(fgui={})),function(fgui){class EaseManager{static evaluate(easeType,time,duration,overshootOrAmplitude,period){switch(easeType){case fgui.EaseType.Linear:return time/duration;case fgui.EaseType.SineIn:return 1-Math.cos(time/duration*EaseManager._PiOver2);case fgui.EaseType.SineOut:return Math.sin(time/duration*EaseManager._PiOver2);case fgui.EaseType.SineInOut:return-.5*(Math.cos(Math.PI*time/duration)-1);case fgui.EaseType.QuadIn:return(time/=duration)*time;case fgui.EaseType.QuadOut:return-(time/=duration)*(time-2);case fgui.EaseType.QuadInOut:return(time/=.5*duration)<1?.5*time*time:-.5*(--time*(time-2)-1);case fgui.EaseType.CubicIn:return(time/=duration)*time*time;case fgui.EaseType.CubicOut:return(time=time/duration-1)*time*time+1;case fgui.EaseType.CubicInOut:return(time/=.5*duration)<1?.5*time*time*time:.5*((time-=2)*time*time+2);case fgui.EaseType.QuartIn:return(time/=duration)*time*time*time;case fgui.EaseType.QuartOut:return-((time=time/duration-1)*time*time*time-1);case fgui.EaseType.QuartInOut:return(time/=.5*duration)<1?.5*time*time*time*time:-.5*((time-=2)*time*time*time-2);case fgui.EaseType.QuintIn:return(time/=duration)*time*time*time*time;case fgui.EaseType.QuintOut:return(time=time/duration-1)*time*time*time*time+1;case fgui.EaseType.QuintInOut:return(time/=.5*duration)<1?.5*time*time*time*time*time:.5*((time-=2)*time*time*time*time+2);case fgui.EaseType.ExpoIn:return 0==time?0:Math.pow(2,10*(time/duration-1));case fgui.EaseType.ExpoOut:return time==duration?1:1-Math.pow(2,-10*time/duration);case fgui.EaseType.ExpoInOut:return 0==time?0:time==duration?1:(time/=.5*duration)<1?.5*Math.pow(2,10*(time-1)):.5*(2-Math.pow(2,-10*--time));case fgui.EaseType.CircIn:return-(Math.sqrt(1-(time/=duration)*time)-1);case fgui.EaseType.CircOut:return Math.sqrt(1-(time=time/duration-1)*time);case fgui.EaseType.CircInOut:return(time/=.5*duration)<1?-.5*(Math.sqrt(1-time*time)-1):.5*(Math.sqrt(1-(time-=2)*time)+1);case fgui.EaseType.ElasticIn:var s0;return 0==time?0:1==(time/=duration)?1:(0==period&&(period=.3*duration),overshootOrAmplitude<1?(overshootOrAmplitude=1,s0=period/4):s0=period/EaseManager._TwoPi*Math.asin(1/overshootOrAmplitude),-overshootOrAmplitude*Math.pow(2,10*(time-=1))*Math.sin((time*duration-s0)*EaseManager._TwoPi/period));case fgui.EaseType.ElasticOut:var s1;return 0==time?0:1==(time/=duration)?1:(0==period&&(period=.3*duration),overshootOrAmplitude<1?(overshootOrAmplitude=1,s1=period/4):s1=period/EaseManager._TwoPi*Math.asin(1/overshootOrAmplitude),overshootOrAmplitude*Math.pow(2,-10*time)*Math.sin((time*duration-s1)*EaseManager._TwoPi/period)+1);case fgui.EaseType.ElasticInOut:var s;return 0==time?0:2==(time/=.5*duration)?1:(0==period&&(period=duration*(.3*1.5)),overshootOrAmplitude<1?(overshootOrAmplitude=1,s=period/4):s=period/EaseManager._TwoPi*Math.asin(1/overshootOrAmplitude),time<1?overshootOrAmplitude*Math.pow(2,10*(time-=1))*Math.sin((time*duration-s)*EaseManager._TwoPi/period)*-.5:overshootOrAmplitude*Math.pow(2,-10*(time-=1))*Math.sin((time*duration-s)*EaseManager._TwoPi/period)*.5+1);case fgui.EaseType.BackIn:return(time/=duration)*time*((overshootOrAmplitude+1)*time-overshootOrAmplitude);case fgui.EaseType.BackOut:return(time=time/duration-1)*time*((overshootOrAmplitude+1)*time+overshootOrAmplitude)+1;case fgui.EaseType.BackInOut:return(time/=.5*duration)<1?time*time*((1+(overshootOrAmplitude*=1.525))*time-overshootOrAmplitude)*.5:.5*((time-=2)*time*((1+(overshootOrAmplitude*=1.525))*time+overshootOrAmplitude)+2);case fgui.EaseType.BounceIn:return Bounce.easeIn(time,duration);case fgui.EaseType.BounceOut:return Bounce.easeOut(time,duration);case fgui.EaseType.BounceInOut:return Bounce.easeInOut(time,duration);default:return-(time/=duration)*(time-2)}}}EaseManager._PiOver2=.5*Math.PI,EaseManager._TwoPi=2*Math.PI,fgui.EaseManager=EaseManager;class Bounce{static easeIn(time,duration){return 1-Bounce.easeOut(duration-time,duration)}static easeOut(time,duration){return(time/=duration)<1/2.75?7.5625*time*time:time<2/2.75?7.5625*(time-=1.5/2.75)*time+.75:time<2.5/2.75?7.5625*(time-=2.25/2.75)*time+.9375:7.5625*(time-=2.625/2.75)*time+.984375}static easeInOut(time,duration){return time<.5*duration?.5*Bounce.easeIn(2*time,duration):.5*Bounce.easeOut(2*time-duration,duration)+.5}}}(fgui||(fgui={})),function(fgui){class EaseType{}EaseType.Linear=0,EaseType.SineIn=1,EaseType.SineOut=2,EaseType.SineInOut=3,EaseType.QuadIn=4,EaseType.QuadOut=5,EaseType.QuadInOut=6,EaseType.CubicIn=7,EaseType.CubicOut=8,EaseType.CubicInOut=9,EaseType.QuartIn=10,EaseType.QuartOut=11,EaseType.QuartInOut=12,EaseType.QuintIn=13,EaseType.QuintOut=14,EaseType.QuintInOut=15,EaseType.ExpoIn=16,EaseType.ExpoOut=17,EaseType.ExpoInOut=18,EaseType.CircIn=19,EaseType.CircOut=20,EaseType.CircInOut=21,EaseType.ElasticIn=22,EaseType.ElasticOut=23,EaseType.ElasticInOut=24,EaseType.BackIn=25,EaseType.BackOut=26,EaseType.BackInOut=27,EaseType.BounceIn=28,EaseType.BounceOut=29,EaseType.BounceInOut=30,EaseType.Custom=31,fgui.EaseType=EaseType}(fgui||(fgui={})),function(fgui){class GTween{static to(start,end,duration){return fgui.TweenManager.createTween()._to(start,end,duration)}static to2(start,start2,end,end2,duration){return fgui.TweenManager.createTween()._to2(start,start2,end,end2,duration)}static to3(start,start2,start3,end,end2,end3,duration){return fgui.TweenManager.createTween()._to3(start,start2,start3,end,end2,end3,duration)}static to4(start,start2,start3,start4,end,end2,end3,end4,duration){return fgui.TweenManager.createTween()._to4(start,start2,start3,start4,end,end2,end3,end4,duration)}static toColor(start,end,duration){return fgui.TweenManager.createTween()._toColor(start,end,duration)}static delayedCall(delay){return fgui.TweenManager.createTween().setDelay(delay)}static shake(startX,startY,amplitude,duration){return fgui.TweenManager.createTween()._shake(startX,startY,amplitude,duration)}static isTweening(target,propType){return fgui.TweenManager.isTweening(target,propType)}static kill(target,complete,propType){fgui.TweenManager.killTweens(target,complete,propType)}static getTween(target,propType){return fgui.TweenManager.getTween(target,propType)}}GTween.catchCallbackExceptions=!0,fgui.GTween=GTween}(fgui||(fgui={})),function(fgui){fgui.GTweener=class{constructor(){this._startValue=new fgui.TweenValue,this._endValue=new fgui.TweenValue,this._value=new fgui.TweenValue,this._deltaValue=new fgui.TweenValue,this._reset()}setDelay(value){return this._delay=value,this}get delay(){return this._delay}setDuration(value){return this._duration=value,this}get duration(){return this._duration}setBreakpoint(value){return this._breakpoint=value,this}setEase(value){return this._easeType=value,this}setEasePeriod(value){return this._easePeriod=value,this}setEaseOvershootOrAmplitude(value){return this._easeOvershootOrAmplitude=value,this}setRepeat(repeat,yoyo=!1){return this._repeat=repeat,this._yoyo=yoyo,this}get repeat(){return this._repeat}setTimeScale(value){return this._timeScale=value,this}setSnapping(value){return this._snapping=value,this}setTarget(value,propType){return this._target=value,this._propType=propType,this}get target(){return this._target}setUserData(value){return this._userData=value,this}get userData(){return this._userData}onUpdate(callback,caller){return this._onUpdate=callback,this._onUpdateCaller=caller,this}onStart(callback,caller){return this._onStart=callback,this._onStartCaller=caller,this}onComplete(callback,caller){return this._onComplete=callback,this._onCompleteCaller=caller,this}get startValue(){return this._startValue}get endValue(){return this._endValue}get value(){return this._value}get deltaValue(){return this._deltaValue}get normalizedTime(){return this._normalizedTime}get completed(){return 0!=this._ended}get allCompleted(){return 1==this._ended}setPaused(paused){return this._paused=paused,this}seek(time){if(!this._killed){if(this._elapsedTime=time,this._elapsedTime<this._delay){if(!this._started)return;this._elapsedTime=this._delay}this.update()}}kill(complete){this._killed||(complete&&(0==this._ended&&(this._breakpoint>=0?this._elapsedTime=this._delay+this._breakpoint:this._repeat>=0?this._elapsedTime=this._delay+this._duration*(this._repeat+1):this._elapsedTime=this._delay+2*this._duration,this.update()),this.callCompleteCallback()),this._killed=!0)}_to(start,end,duration){return this._valueSize=1,this._startValue.x=start,this._endValue.x=end,this._value.x=start,this._duration=duration,this}_to2(start,start2,end,end2,duration){return this._valueSize=2,this._startValue.x=start,this._endValue.x=end,this._startValue.y=start2,this._endValue.y=end2,this._value.x=start,this._value.y=start2,this._duration=duration,this}_to3(start,start2,start3,end,end2,end3,duration){return this._valueSize=3,this._startValue.x=start,this._endValue.x=end,this._startValue.y=start2,this._endValue.y=end2,this._startValue.z=start3,this._endValue.z=end3,this._value.x=start,this._value.y=start2,this._value.z=start3,this._duration=duration,this}_to4(start,start2,start3,start4,end,end2,end3,end4,duration){return this._valueSize=4,this._startValue.x=start,this._endValue.x=end,this._startValue.y=start2,this._endValue.y=end2,this._startValue.z=start3,this._endValue.z=end3,this._startValue.w=start4,this._endValue.w=end4,this._value.x=start,this._value.y=start2,this._value.z=start3,this._value.w=start4,this._duration=duration,this}_toColor(start,end,duration){return this._valueSize=4,this._startValue.color=start,this._endValue.color=end,this._value.color=start,this._duration=duration,this}_shake(startX,startY,amplitude,duration){return this._valueSize=5,this._startValue.x=startX,this._startValue.y=startY,this._startValue.w=amplitude,this._duration=duration,this}_init(){this._delay=0,this._duration=0,this._breakpoint=-1,this._easeType=fgui.EaseType.QuadOut,this._timeScale=1,this._easePeriod=0,this._easeOvershootOrAmplitude=1.70158,this._snapping=!1,this._repeat=0,this._yoyo=!1,this._valueSize=0,this._started=!1,this._paused=!1,this._killed=!1,this._elapsedTime=0,this._normalizedTime=0,this._ended=0}_reset(){this._target=null,this._userData=null,this._onStart=this._onUpdate=this._onComplete=null,this._onStartCaller=this._onUpdateCaller=this._onCompleteCaller=null}_update(dt){if(1!=this._timeScale&&(dt*=this._timeScale),0!=dt){if(0!=this._ended)return this.callCompleteCallback(),void(this._killed=!0);this._elapsedTime+=dt,this.update(),0!=this._ended&&(this._killed||(this.callCompleteCallback(),this._killed=!0))}}update(){if(this._ended=0,0!=this._valueSize){if(!this._started){if(this._elapsedTime<this._delay)return;if(this._started=!0,this.callStartCallback(),this._killed)return}var reversed=!1,tt=this._elapsedTime-this._delay;if(this._breakpoint>=0&&tt>=this._breakpoint&&(tt=this._breakpoint,this._ended=2),0!=this._repeat){var round=Math.floor(tt/this._duration);tt-=this._duration*round,this._yoyo&&(reversed=round%2==1),this._repeat>0&&this._repeat-round<0&&(this._yoyo&&(reversed=this._repeat%2==1),tt=this._duration,this._ended=1)}else tt>=this._duration&&(tt=this._duration,this._ended=1);if(this._normalizedTime=fgui.EaseManager.evaluate(this._easeType,reversed?this._duration-tt:tt,this._duration,this._easeOvershootOrAmplitude,this._easePeriod),this._value.setZero(),this._deltaValue.setZero(),5==this._valueSize)if(0==this._ended){var r=this._startValue.w*(1-this._normalizedTime),rx=r*(Math.random()>.5?1:-1),ry=r*(Math.random()>.5?1:-1);this._deltaValue.x=rx,this._deltaValue.y=ry,this._value.x=this._startValue.x+rx,this._value.y=this._startValue.y+ry}else this._value.x=this._startValue.x,this._value.y=this._startValue.y;else for(var i=0;i<this._valueSize;i++){var n1=this._startValue.getField(i),f=n1+(this._endValue.getField(i)-n1)*this._normalizedTime;this._snapping&&(f=Math.round(f)),this._deltaValue.setField(i,f-this._value.getField(i)),this._value.setField(i,f)}if(null!=this._target&&this._propType)if(this._propType instanceof Function)switch(this._valueSize){case 1:this._propType.call(this._target,this._value.x);break;case 2:this._propType.call(this._target,this._value.x,this._value.y);break;case 3:this._propType.call(this._target,this._value.x,this._value.y,this._value.z);break;case 4:this._propType.call(this._target,this._value.x,this._value.y,this._value.z,this._value.w);break;case 5:this._propType.call(this._target,this._value.color);break;case 6:this._propType.call(this._target,this._value.x,this._value.y)}else 5==this._valueSize?this._target[this._propType]=this._value.color:this._target[this._propType]=this._value.x;this.callUpdateCallback()}else this._elapsedTime>=this._delay+this._duration&&(this._ended=1)}callStartCallback(){if(null!=this._onStart)try{this._onStart.call(this._onStartCaller,this)}catch(err){console.log("FairyGUI: error in start callback > "+err)}}callUpdateCallback(){if(null!=this._onUpdate)try{this._onUpdate.call(this._onUpdateCaller,this)}catch(err){console.log("FairyGUI: error in update callback > "+err)}}callCompleteCallback(){if(null!=this._onComplete)try{this._onComplete.call(this._onCompleteCaller,this)}catch(err){console.log("FairyGUI: error in complete callback > "+err)}}}}(fgui||(fgui={})),function(fgui){class TweenManager{static createTween(){var tweener;return TweenManager._inited||(Laya.timer.frameLoop(1,null,TweenManager.update),TweenManager._inited=!0),(tweener=TweenManager._tweenerPool.length>0?TweenManager._tweenerPool.pop():new fgui.GTweener)._init(),TweenManager._activeTweens[TweenManager._totalActiveTweens++]=tweener,tweener}static isTweening(target,propType){if(null==target)return!1;for(var anyType=!propType,i=0;i<TweenManager._totalActiveTweens;i++){var tweener=TweenManager._activeTweens[i];if(null!=tweener&&tweener.target==target&&!tweener._killed&&(anyType||tweener._propType==propType))return!0}return!1}static killTweens(target,completed,propType){if(null==target)return!1;for(var flag=!1,cnt=TweenManager._totalActiveTweens,anyType=!propType,i=0;i<cnt;i++){var tweener=TweenManager._activeTweens[i];null==tweener||tweener.target!=target||tweener._killed||!anyType&&tweener._propType!=propType||(tweener.kill(completed),flag=!0)}return flag}static getTween(target,propType){if(null==target)return null;for(var cnt=TweenManager._totalActiveTweens,anyType=!propType,i=0;i<cnt;i++){var tweener=TweenManager._activeTweens[i];if(null!=tweener&&tweener.target==target&&!tweener._killed&&(anyType||tweener._propType==propType))return tweener}return null}static update(){for(var dt=Laya.timer.delta/1e3,cnt=TweenManager._totalActiveTweens,freePosStart=-1,i=0;i<cnt;i++){var tweener=TweenManager._activeTweens[i];null==tweener?-1==freePosStart&&(freePosStart=i):tweener._killed?(tweener._reset(),TweenManager._tweenerPool.push(tweener),TweenManager._activeTweens[i]=null,-1==freePosStart&&(freePosStart=i)):(tweener._target instanceof fgui.GObject&&tweener._target.isDisposed?tweener._killed=!0:tweener._paused||tweener._update(dt),-1!=freePosStart&&(TweenManager._activeTweens[freePosStart]=tweener,TweenManager._activeTweens[i]=null,freePosStart++))}if(freePosStart>=0){if(TweenManager._totalActiveTweens!=cnt){var j=cnt;for(cnt=TweenManager._totalActiveTweens-cnt,i=0;i<cnt;i++)TweenManager._activeTweens[freePosStart++]=TweenManager._activeTweens[j++]}TweenManager._totalActiveTweens=freePosStart}}}TweenManager._activeTweens=new Array,TweenManager._tweenerPool=[],TweenManager._totalActiveTweens=0,TweenManager._inited=!1,fgui.TweenManager=TweenManager}(fgui||(fgui={})),function(fgui){fgui.TweenValue=class{constructor(){this.x=this.y=this.z=this.w=0}get color(){return(this.w<<24)+(this.x<<16)+(this.y<<8)+this.z}set color(value){this.x=(16711680&value)>>16,this.y=(65280&value)>>8,this.z=255&value,this.w=(4278190080&value)>>24}getField(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("Index out of bounds: "+index)}}setField(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("Index out of bounds: "+index)}}setZero(){this.x=this.y=this.z=this.w=0}}}(fgui||(fgui={})),function(fgui){class GearBase{constructor(owner){this._owner=owner}dispose(){null!=this._tweenConfig&&null!=this._tweenConfig._tweener&&(this._tweenConfig._tweener.kill(),this._tweenConfig._tweener=null)}get controller(){return this._controller}set controller(val){val!=this._controller&&(this._controller=val,this._controller&&this.init())}get tweenConfig(){return null==this._tweenConfig&&(this._tweenConfig=new GearTweenConfig),this._tweenConfig}setup(buffer){var cnt,i,page;if(this._controller=this._owner.parent.getControllerAt(buffer.getInt16()),this.init(),this instanceof fgui.GearDisplay){cnt=buffer.getInt16();var pages=[];for(i=0;i<cnt;i++)pages[i]=buffer.readS();this.pages=pages}else{for(cnt=buffer.getInt16(),i=0;i<cnt;i++)null!=(page=buffer.readS())&&this.addStatus(page,buffer);buffer.readBool()&&this.addStatus(null,buffer)}buffer.readBool()&&(this._tweenConfig=new GearTweenConfig,this._tweenConfig.easeType=buffer.readByte(),this._tweenConfig.duration=buffer.getFloat32(),this._tweenConfig.delay=buffer.getFloat32())}updateFromRelations(dx,dy){}addStatus(pageId,buffer){}init(){}apply(){}updateState(){}}GearBase.disableAllTweenEffect=!1,fgui.GearBase=GearBase;class GearTweenConfig{constructor(){this.tween=!0,this.easeType=fgui.EaseType.QuadOut,this.duration=.3,this.delay=0}}fgui.GearTweenConfig=GearTweenConfig}(fgui||(fgui={})),function(fgui){fgui.GearSize=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=new GearSizeValue(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY),this._storage={}}addStatus(pageId,buffer){var gv;null==pageId?gv=this._default:(gv=new GearSizeValue,this._storage[pageId]=gv),gv.width=buffer.getInt32(),gv.height=buffer.getInt32(),gv.scaleX=buffer.getFloat32(),gv.scaleY=buffer.getFloat32()}apply(){var gv=this._storage[this._controller.selectedPageId];if(gv||(gv=this._default),null==this._tweenConfig||!this._tweenConfig.tween||fgui.UIPackage._constructing||fgui.GearBase.disableAllTweenEffect)this._owner._gearLocked=!0,this._owner.setSize(gv.width,gv.height,this._owner.checkGearController(1,this._controller)),this._owner.setScale(gv.scaleX,gv.scaleY),this._owner._gearLocked=!1;else{if(null!=this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==gv.width&&this._tweenConfig._tweener.endValue.y==gv.height&&this._tweenConfig._tweener.endValue.z==gv.scaleX&&this._tweenConfig._tweener.endValue.w==gv.scaleY)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var a=gv.width!=this._owner.width||gv.height!=this._owner.height,b=gv.scaleX!=this._owner.scaleX||gv.scaleY!=this._owner.scaleY;(a||b)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=fgui.GTween.to4(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY,gv.width,gv.height,gv.scaleX,gv.scaleY,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((a?1:0)+(b?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}}__tweenUpdate(tweener){var flag=tweener.userData;this._owner._gearLocked=!0,0!=(1&flag)&&this._owner.setSize(tweener.value.x,tweener.value.y,this._owner.checkGearController(1,this._controller)),0!=(2&flag)&&this._owner.setScale(tweener.value.z,tweener.value.w),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var gv=this._storage[this._controller.selectedPageId];gv||(gv=new GearSizeValue,this._storage[this._controller.selectedPageId]=gv),gv.width=this._owner.width,gv.height=this._owner.height,gv.scaleX=this._owner.scaleX,gv.scaleY=this._owner.scaleY}updateFromRelations(dx,dy){if(null!=this._controller&&null!=this._storage){for(var key in this._storage){var gv=this._storage[key];gv.width+=dx,gv.height+=dy}this._default.width+=dx,this._default.height+=dy,this.updateState()}}};class GearSizeValue{constructor(width=0,height=0,scaleX=0,scaleY=0){this.width=width,this.height=height,this.scaleX=scaleX,this.scaleY=scaleY}}}(fgui||(fgui={})),function(fgui){fgui.GearXY=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=new Laya.Point(this._owner.x,this._owner.y),this._storage={}}addStatus(pageId,buffer){var gv;null==pageId?gv=this._default:(gv=new Laya.Point,this._storage[pageId]=gv),gv.x=buffer.getInt32(),gv.y=buffer.getInt32()}apply(){var pt=this._storage[this._controller.selectedPageId];if(pt||(pt=this._default),null==this._tweenConfig||!this._tweenConfig.tween||fgui.UIPackage._constructing||fgui.GearBase.disableAllTweenEffect)this._owner._gearLocked=!0,this._owner.setXY(pt.x,pt.y),this._owner._gearLocked=!1;else{if(null!=this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==pt.x&&this._tweenConfig._tweener.endValue.y==pt.y)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}this._owner.x==pt.x&&this._owner.y==pt.y||(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=fgui.GTween.to2(this._owner.x,this._owner.y,pt.x,pt.y,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}}__tweenUpdate(tweener){this._owner._gearLocked=!0,this._owner.setXY(tweener.value.x,tweener.value.y),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var pt=this._storage[this._controller.selectedPageId];pt||(pt=new Laya.Point,this._storage[this._controller.selectedPageId]=pt),pt.x=this._owner.x,pt.y=this._owner.y}updateFromRelations(dx,dy){if(null!=this._controller&&null!=this._storage){for(var key in this._storage){var pt=this._storage[key];pt.x+=dx,pt.y+=dy}this._default.x+=dx,this._default.y+=dy,this.updateState()}}}}(fgui||(fgui={})),function(fgui){fgui.GearText=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=this._owner.text,this._storage={}}addStatus(pageId,buffer){null==pageId?this._default=buffer.readS():this._storage[pageId]=buffer.readS()}apply(){this._owner._gearLocked=!0;var data=this._storage[this._controller.selectedPageId];this._owner.text=void 0!==data?data:this._default,this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.text}}}(fgui||(fgui={})),function(fgui){fgui.GearIcon=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=this._owner.icon,this._storage={}}addStatus(pageId,buffer){null==pageId?this._default=buffer.readS():this._storage[pageId]=buffer.readS()}apply(){this._owner._gearLocked=!0;var data=this._storage[this._controller.selectedPageId];this._owner.icon=void 0!==data?data:this._default,this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.icon}}}(fgui||(fgui={})),function(fgui){fgui.GearAnimation=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=new GearAnimationValue(this._owner.getProp(fgui.ObjectPropID.Playing),this._owner.getProp(fgui.ObjectPropID.Frame)),this._storage={}}addStatus(pageId,buffer){var gv;null==pageId?gv=this._default:(gv=new GearAnimationValue,this._storage[pageId]=gv),gv.playing=buffer.readBool(),gv.frame=buffer.getInt32()}apply(){this._owner._gearLocked=!0;var gv=this._storage[this._controller.selectedPageId];gv||(gv=this._default),this._owner.setProp(fgui.ObjectPropID.Playing,gv.playing),this._owner.setProp(fgui.ObjectPropID.Frame,gv.frame),this._owner._gearLocked=!1}updateState(){var gv=this._storage[this._controller.selectedPageId];gv||(gv=new GearAnimationValue,this._storage[this._controller.selectedPageId]=gv),gv.playing=this._owner.getProp(fgui.ObjectPropID.Playing),gv.frame=this._owner.getProp(fgui.ObjectPropID.Frame)}};class GearAnimationValue{constructor(playing=!0,frame=0){this.playing=playing,this.frame=frame}}}(fgui||(fgui={})),function(fgui){fgui.GearColor=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=new GearColorValue(this._owner.getProp(fgui.ObjectPropID.Color),this._owner.getProp(fgui.ObjectPropID.OutlineColor)),this._storage={}}addStatus(pageId,buffer){var gv;null==pageId?gv=this._default:(gv=new GearColorValue,this._storage[pageId]=gv),gv.color=buffer.readColorS(),gv.strokeColor=buffer.readColorS()}apply(){this._owner._gearLocked=!0;var gv=this._storage[this._controller.selectedPageId];gv||(gv=this._default),this._owner.setProp(fgui.ObjectPropID.Color,gv.color),null!=gv.strokeColor&&this._owner.setProp(fgui.ObjectPropID.OutlineColor,gv.strokeColor),this._owner._gearLocked=!1}updateState(){var gv=this._storage[this._controller.selectedPageId];gv||(gv=new GearColorValue(null,null),this._storage[this._controller.selectedPageId]=gv),gv.color=this._owner.getProp(fgui.ObjectPropID.Color),gv.strokeColor=this._owner.getProp(fgui.ObjectPropID.OutlineColor)}};class GearColorValue{constructor(color=null,strokeColor=null){this.color=color,this.strokeColor=strokeColor}}}(fgui||(fgui={})),function(fgui){fgui.GearDisplay=class extends fgui.GearBase{constructor(owner){super(owner),this._visible=0,this._displayLockToken=0,this._displayLockToken=1}init(){this.pages=null}addLock(){return this._visible++,this._displayLockToken}releaseLock(token){token==this._displayLockToken&&this._visible--}get connected(){return null==this._controller||this._visible>0}apply(){this._displayLockToken++,this._displayLockToken<=0&&(this._displayLockToken=1),null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}}}(fgui||(fgui={})),function(fgui){fgui.GearLook=class extends fgui.GearBase{constructor(owner){super(owner)}init(){this._default=new GearLookValue(this._owner.alpha,this._owner.rotation,this._owner.grayed,this._owner.touchable),this._storage={}}addStatus(pageId,buffer){var gv;null==pageId?gv=this._default:(gv=new GearLookValue,this._storage[pageId]=gv),gv.alpha=buffer.getFloat32(),gv.rotation=buffer.getFloat32(),gv.grayed=buffer.readBool(),gv.touchable=buffer.readBool()}apply(){var gv=this._storage[this._controller.selectedPageId];if(gv||(gv=this._default),null==this._tweenConfig||!this._tweenConfig.tween||fgui.UIPackage._constructing||fgui.GearBase.disableAllTweenEffect)this._owner._gearLocked=!0,this._owner.grayed=gv.grayed,this._owner.alpha=gv.alpha,this._owner.rotation=gv.rotation,this._owner.touchable=gv.touchable,this._owner._gearLocked=!1;else{if(this._owner._gearLocked=!0,this._owner.grayed=gv.grayed,this._owner.touchable=gv.touchable,this._owner._gearLocked=!1,null!=this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==gv.alpha&&this._tweenConfig._tweener.endValue.y==gv.rotation)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var a=gv.alpha!=this._owner.alpha,b=gv.rotation!=this._owner.rotation;(a||b)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=fgui.GTween.to2(this._owner.alpha,this._owner.rotation,gv.alpha,gv.rotation,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((a?1:0)+(b?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}}__tweenUpdate(tweener){var flag=tweener.userData;this._owner._gearLocked=!0,0!=(1&flag)&&(this._owner.alpha=tweener.value.x),0!=(2&flag)&&(this._owner.rotation=tweener.value.y),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var gv=this._storage[this._controller.selectedPageId];gv||(gv=new GearLookValue,this._storage[this._controller.selectedPageId]=gv),gv.alpha=this._owner.alpha,gv.rotation=this._owner.rotation,gv.grayed=this._owner.grayed,gv.touchable=this._owner.touchable}};class GearLookValue{constructor(alpha=0,rotation=0,grayed=!1,touchable=!0){this.alpha=alpha,this.rotation=rotation,this.grayed=grayed,this.touchable=touchable}}}(fgui||(fgui={})),function(fgui){class AssetProxy{constructor(){this._asset=Laya.loader}static get inst(){return null==AssetProxy._inst&&(AssetProxy._inst=new AssetProxy),AssetProxy._inst}getRes(url){return this._asset.getRes(url)}load(url,complete=null,progress=null,type=null,priority=1,cache=!0){this._asset.load(url,complete,progress,type,priority,cache)}setAsset(asset){this._asset=asset}}fgui.AssetProxy=AssetProxy}(fgui||(fgui={})),function(fgui){fgui.AsyncOperation=class{constructor(){this._itemList=new Array,this._objectPool=[]}createObject(pkgName,resName){var pkg=fgui.UIPackage.getByName(pkgName);if(!pkg)throw new Error("namespace sunnyboxs found: "+pkgName);var pi=pkg.getItemByName(resName);if(!pi)throw new Error("resource not found: "+resName);this.internalCreateObject(pi)}createObjectFromURL(url){var pi=fgui.UIPackage.getItemByURL(url);if(!pi)throw new Error("resource not found: "+url);this.internalCreateObject(pi)}cancel(){if(Laya.timer.clear(this,this.run),this._itemList.length=0,this._objectPool.length>0){for(var cnt=this._objectPool.length,i=0;i<cnt;i++)this._objectPool[i].dispose();this._objectPool.length=0}}internalCreateObject(item){this._itemList.length=0,this._objectPool.length=0;var di=new DisplayListItem(item,fgui.ObjectType.Component);di.childCount=this.collectComponentChildren(item),this._itemList.push(di),this._index=0,Laya.timer.frameLoop(1,this,this.run)}collectComponentChildren(item){var di,pi,i,dataLen,curPos,pkg,buffer=item.rawData;buffer.seek(0,2);var dcnt=buffer.getInt16();for(i=0;i<dcnt;i++){dataLen=buffer.getInt16(),curPos=buffer.pos,buffer.seek(curPos,0);var type=buffer.readByte(),src=buffer.readS(),pkgId=buffer.readS();buffer.pos=curPos,null!=src?(pi=null!=(pkg=null!=pkgId?fgui.UIPackage.getById(pkgId):item.owner)?pkg.getItemById(src):null,di=new DisplayListItem(pi,type),null!=pi&&pi.type==fgui.PackageItemType.Component&&(di.childCount=this.collectComponentChildren(pi))):(di=new DisplayListItem(null,type),type==fgui.ObjectType.List&&(di.listItemCount=this.collectListChildren(buffer))),this._itemList.push(di),buffer.pos=curPos+dataLen}return dcnt}collectListChildren(buffer){buffer.seek(buffer.pos,8);var i,nextPos,url,pi,di,listItemCount=0,defaultItem=buffer.readS(),itemCount=buffer.getInt16();for(i=0;i<itemCount;i++)nextPos=buffer.getInt16(),nextPos+=buffer.pos,null==(url=buffer.readS())&&(url=defaultItem),url&&null!=(pi=fgui.UIPackage.getItemByURL(url))&&(di=new DisplayListItem(pi,pi.objectType),pi.type==fgui.PackageItemType.Component&&(di.childCount=this.collectComponentChildren(pi)),this._itemList.push(di),listItemCount++),buffer.pos=nextPos;return listItemCount}run(){for(var obj,di,poolStart,k,t=Laya.Browser.now(),frameTime=fgui.UIConfig.frameTimeForAsyncUIConstruction,totalItems=this._itemList.length;this._index<totalItems;){if(null!=(di=this._itemList[this._index]).packageItem)(obj=fgui.UIObjectFactory.newObject(di.packageItem)).packageItem=di.packageItem,this._objectPool.push(obj),fgui.UIPackage._constructing++,di.packageItem.type==fgui.PackageItemType.Component?(poolStart=this._objectPool.length-di.childCount-1,obj.constructFromResource2(this._objectPool,poolStart),this._objectPool.splice(poolStart,di.childCount)):obj.constructFromResource(),fgui.UIPackage._constructing--;else if(obj=fgui.UIObjectFactory.newObject2(di.type),this._objectPool.push(obj),di.type==fgui.ObjectType.List&&di.listItemCount>0){for(poolStart=this._objectPool.length-di.listItemCount-1,k=0;k<di.listItemCount;k++)obj.itemPool.returnObject(this._objectPool[k+poolStart]);this._objectPool.splice(poolStart,di.listItemCount)}if(this._index++,this._index%5==0&&Laya.Browser.now()-t>=frameTime)return}Laya.timer.clear(this,this.run);var result=this._objectPool[0];this._itemList.length=0,this._objectPool.length=0,null!=this.callback&&this.callback.runWith(result)}};class DisplayListItem{constructor(packageItem,type){this.packageItem=packageItem,this.type=type}}}(fgui||(fgui={})),function(fgui){class Controller extends Laya.EventDispatcher{constructor(){super(),this._selectedIndex=0,this._previousIndex=0,this.changing=!1,this._pageIds=[],this._pageNames=[],this._selectedIndex=-1,this._previousIndex=-1}dispose(){this.offAll()}get selectedIndex(){return this._selectedIndex}set selectedIndex(value){if(this._selectedIndex!=value){if(value>this._pageIds.length-1)throw"index out of bounds: "+value;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=value,this.parent.applyController(this),this.event(fgui.Events.STATE_CHANGED),this.changing=!1}}setSelectedIndex(value=0){if(this._selectedIndex!=value){if(value>this._pageIds.length-1)throw"index out of bounds: "+value;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=value,this.parent.applyController(this),this.changing=!1}}get previsousIndex(){return this._previousIndex}get selectedPage(){return-1==this._selectedIndex?null:this._pageNames[this._selectedIndex]}set selectedPage(val){var i=this._pageNames.indexOf(val);-1==i&&(i=0),this.selectedIndex=i}setSelectedPage(value){var i=this._pageNames.indexOf(value);-1==i&&(i=0),this.setSelectedIndex(i)}get previousPage(){return-1==this._previousIndex?null:this._pageNames[this._previousIndex]}get pageCount(){return this._pageIds.length}getPageName(index=0){return this._pageNames[index]}addPage(name=""){this.addPageAt(this.name,this._pageIds.length)}addPageAt(name,index=0){var nid=""+Controller._nextPageId++;index==this._pageIds.length?(this._pageIds.push(nid),this._pageNames.push(this.name)):(this._pageIds.splice(index,0,nid),this._pageNames.splice(index,0,this.name))}removePage(name){var i=this._pageNames.indexOf(this.name);-1!=i&&(this._pageIds.splice(i,1),this._pageNames.splice(i,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this))}removePageAt(index=0){this._pageIds.splice(index,1),this._pageNames.splice(index,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this)}clearPages(){this._pageIds.length=0,this._pageNames.length=0,-1!=this._selectedIndex?this.selectedIndex=-1:this.parent.applyController(this)}hasPage(aName){return-1!=this._pageNames.indexOf(aName)}getPageIndexById(aId){return this._pageIds.indexOf(aId)}getPageIdByName(aName){var i=this._pageNames.indexOf(aName);return-1!=i?this._pageIds[i]:null}getPageNameById(aId){var i=this._pageIds.indexOf(aId);return-1!=i?this._pageNames[i]:null}getPageId(index=0){return this._pageIds[index]}get selectedPageId(){return-1==this._selectedIndex?null:this._pageIds[this._selectedIndex]}set selectedPageId(val){var i=this._pageIds.indexOf(val);this.selectedIndex=i}set oppositePageId(val){this._pageIds.indexOf(val)>0?this.selectedIndex=0:this._pageIds.length>1&&(this.selectedIndex=1)}get previousPageId(){return-1==this._previousIndex?null:this._pageIds[this._previousIndex]}runActions(){if(this._actions)for(var cnt=this._actions.length,i=0;i<cnt;i++)this._actions[i].run(this,this.previousPageId,this.selectedPageId)}setup(buffer){var i,nextPos,beginPos=buffer.pos;buffer.seek(beginPos,0),this.name=buffer.readS(),this.autoRadioGroupDepth=buffer.readBool(),buffer.seek(beginPos,1);var cnt=buffer.getInt16();for(i=0;i<cnt;i++)this._pageIds.push(buffer.readS()),this._pageNames.push(buffer.readS());if(buffer.seek(beginPos,2),(cnt=buffer.getInt16())>0)for(null==this._actions&&(this._actions=[]),i=0;i<cnt;i++){nextPos=buffer.getInt16(),nextPos+=buffer.pos;var action=fgui.ControllerAction.createAction(buffer.readByte());action.setup(buffer),this._actions.push(action),buffer.pos=nextPos}null!=this.parent&&this._pageIds.length>0?this._selectedIndex=0:this._selectedIndex=-1}}Controller._nextPageId=0,fgui.Controller=Controller}(fgui||(fgui={})),function(fgui){class Events{static createEvent(type,target,source=null){return Events.$event.setTo(type,target,source?source.target:target),source?(Events.$event.touchId=source.touchId,Events.$event.nativeEvent=source.nativeEvent):Events.$event.nativeEvent=null,Events.$event._stoped=!1,Events.$event}static dispatch(type,target,source=null){target.event(type,Events.createEvent(type,target,source))}}Events.STATE_CHANGED="fui_state_changed",Events.XY_CHANGED="fui_xy_changed",Events.SIZE_CHANGED="fui_size_changed",Events.SIZE_DELAY_CHANGE="fui_size_delay_change",Events.CLICK_ITEM="fui_click_item",Events.SCROLL="fui_scroll",Events.SCROLL_END="fui_scroll_end",Events.DROP="fui_drop",Events.FOCUS_CHANGED="fui_focus_changed",Events.DRAG_START="fui_drag_start",Events.DRAG_MOVE="fui_drag_move",Events.DRAG_END="fui_drag_end",Events.PULL_DOWN_RELEASE="fui_pull_down_release",Events.PULL_UP_RELEASE="fui_pull_up_release",Events.GEAR_STOP="fui_gear_stop",Events.$event=new Laya.Event,fgui.Events=Events}(fgui||(fgui={})),function(fgui){let ButtonMode,AutoSizeType,AlignType,VertAlignType,LoaderFillType,ListLayoutType,ListSelectionMode,OverflowType,PackageItemType,ObjectType,ProgressTitleType,ScrollBarDisplayType,ScrollType,FlipType,ChildrenRenderOrder,GroupLayoutType,PopupDirection,RelationType,FillMethod,FillOrigin,FillOrigin90,ObjectPropID;!function(ButtonMode){ButtonMode[ButtonMode.Common=0]="Common",ButtonMode[ButtonMode.Check=1]="Check",ButtonMode[ButtonMode.Radio=2]="Radio"}(ButtonMode=fgui.ButtonMode||(fgui.ButtonMode={})),function(AutoSizeType){AutoSizeType[AutoSizeType.None=0]="None",AutoSizeType[AutoSizeType.Both=1]="Both",AutoSizeType[AutoSizeType.Height=2]="Height"}(AutoSizeType=fgui.AutoSizeType||(fgui.AutoSizeType={})),function(AlignType){AlignType[AlignType.Left=0]="Left",AlignType[AlignType.Center=1]="Center",AlignType[AlignType.Right=2]="Right"}(AlignType=fgui.AlignType||(fgui.AlignType={})),function(VertAlignType){VertAlignType[VertAlignType.Top=0]="Top",VertAlignType[VertAlignType.Middle=1]="Middle",VertAlignType[VertAlignType.Bottom=2]="Bottom"}(VertAlignType=fgui.VertAlignType||(fgui.VertAlignType={})),function(LoaderFillType){LoaderFillType[LoaderFillType.None=0]="None",LoaderFillType[LoaderFillType.Scale=1]="Scale",LoaderFillType[LoaderFillType.ScaleMatchHeight=2]="ScaleMatchHeight",LoaderFillType[LoaderFillType.ScaleMatchWidth=3]="ScaleMatchWidth",LoaderFillType[LoaderFillType.ScaleFree=4]="ScaleFree",LoaderFillType[LoaderFillType.ScaleNoBorder=5]="ScaleNoBorder"}(LoaderFillType=fgui.LoaderFillType||(fgui.LoaderFillType={})),function(ListLayoutType){ListLayoutType[ListLayoutType.SingleColumn=0]="SingleColumn",ListLayoutType[ListLayoutType.SingleRow=1]="SingleRow",ListLayoutType[ListLayoutType.FlowHorizontal=2]="FlowHorizontal",ListLayoutType[ListLayoutType.FlowVertical=3]="FlowVertical",ListLayoutType[ListLayoutType.Pagination=4]="Pagination"}(ListLayoutType=fgui.ListLayoutType||(fgui.ListLayoutType={})),function(ListSelectionMode){ListSelectionMode[ListSelectionMode.Single=0]="Single",ListSelectionMode[ListSelectionMode.Multiple=1]="Multiple",ListSelectionMode[ListSelectionMode.Multiple_SingleClick=2]="Multiple_SingleClick",ListSelectionMode[ListSelectionMode.None=3]="None"}(ListSelectionMode=fgui.ListSelectionMode||(fgui.ListSelectionMode={})),function(OverflowType){OverflowType[OverflowType.Visible=0]="Visible",OverflowType[OverflowType.Hidden=1]="Hidden",OverflowType[OverflowType.Scroll=2]="Scroll"}(OverflowType=fgui.OverflowType||(fgui.OverflowType={})),function(PackageItemType){PackageItemType[PackageItemType.Image=0]="Image",PackageItemType[PackageItemType.MovieClip=1]="MovieClip",PackageItemType[PackageItemType.Sound=2]="Sound",PackageItemType[PackageItemType.Component=3]="Component",PackageItemType[PackageItemType.Atlas=4]="Atlas",PackageItemType[PackageItemType.Font=5]="Font",PackageItemType[PackageItemType.Swf=6]="Swf",PackageItemType[PackageItemType.Misc=7]="Misc",PackageItemType[PackageItemType.Unknown=8]="Unknown"}(PackageItemType=fgui.PackageItemType||(fgui.PackageItemType={})),function(ObjectType){ObjectType[ObjectType.Image=0]="Image",ObjectType[ObjectType.MovieClip=1]="MovieClip",ObjectType[ObjectType.Swf=2]="Swf",ObjectType[ObjectType.Graph=3]="Graph",ObjectType[ObjectType.Loader=4]="Loader",ObjectType[ObjectType.Group=5]="Group",ObjectType[ObjectType.Text=6]="Text",ObjectType[ObjectType.RichText=7]="RichText",ObjectType[ObjectType.InputText=8]="InputText",ObjectType[ObjectType.Component=9]="Component",ObjectType[ObjectType.List=10]="List",ObjectType[ObjectType.Label=11]="Label",ObjectType[ObjectType.Button=12]="Button",ObjectType[ObjectType.ComboBox=13]="ComboBox",ObjectType[ObjectType.ProgressBar=14]="ProgressBar",ObjectType[ObjectType.Slider=15]="Slider",ObjectType[ObjectType.ScrollBar=16]="ScrollBar"}(ObjectType=fgui.ObjectType||(fgui.ObjectType={})),function(ProgressTitleType){ProgressTitleType[ProgressTitleType.Percent=0]="Percent",ProgressTitleType[ProgressTitleType.ValueAndMax=1]="ValueAndMax",ProgressTitleType[ProgressTitleType.Value=2]="Value",ProgressTitleType[ProgressTitleType.Max=3]="Max"}(ProgressTitleType=fgui.ProgressTitleType||(fgui.ProgressTitleType={})),function(ScrollBarDisplayType){ScrollBarDisplayType[ScrollBarDisplayType.Default=0]="Default",ScrollBarDisplayType[ScrollBarDisplayType.Visible=1]="Visible",ScrollBarDisplayType[ScrollBarDisplayType.Auto=2]="Auto",ScrollBarDisplayType[ScrollBarDisplayType.Hidden=3]="Hidden"}(ScrollBarDisplayType=fgui.ScrollBarDisplayType||(fgui.ScrollBarDisplayType={})),function(ScrollType){ScrollType[ScrollType.Horizontal=0]="Horizontal",ScrollType[ScrollType.Vertical=1]="Vertical",ScrollType[ScrollType.Both=2]="Both"}(ScrollType=fgui.ScrollType||(fgui.ScrollType={})),function(FlipType){FlipType[FlipType.None=0]="None",FlipType[FlipType.Horizontal=1]="Horizontal",FlipType[FlipType.Vertical=2]="Vertical",FlipType[FlipType.Both=3]="Both"}(FlipType=fgui.FlipType||(fgui.FlipType={})),function(ChildrenRenderOrder){ChildrenRenderOrder[ChildrenRenderOrder.Ascent=0]="Ascent",ChildrenRenderOrder[ChildrenRenderOrder.Descent=1]="Descent",ChildrenRenderOrder[ChildrenRenderOrder.Arch=2]="Arch"}(ChildrenRenderOrder=fgui.ChildrenRenderOrder||(fgui.ChildrenRenderOrder={})),function(GroupLayoutType){GroupLayoutType[GroupLayoutType.None=0]="None",GroupLayoutType[GroupLayoutType.Horizontal=1]="Horizontal",GroupLayoutType[GroupLayoutType.Vertical=2]="Vertical"}(GroupLayoutType=fgui.GroupLayoutType||(fgui.GroupLayoutType={})),function(PopupDirection){PopupDirection[PopupDirection.Auto=0]="Auto",PopupDirection[PopupDirection.Up=1]="Up",PopupDirection[PopupDirection.Down=2]="Down"}(PopupDirection=fgui.PopupDirection||(fgui.PopupDirection={})),function(RelationType){RelationType[RelationType.Left_Left=0]="Left_Left",RelationType[RelationType.Left_Center=1]="Left_Center",RelationType[RelationType.Left_Right=2]="Left_Right",RelationType[RelationType.Center_Center=3]="Center_Center",RelationType[RelationType.Right_Left=4]="Right_Left",RelationType[RelationType.Right_Center=5]="Right_Center",RelationType[RelationType.Right_Right=6]="Right_Right",RelationType[RelationType.Top_Top=7]="Top_Top",RelationType[RelationType.Top_Middle=8]="Top_Middle",RelationType[RelationType.Top_Bottom=9]="Top_Bottom",RelationType[RelationType.Middle_Middle=10]="Middle_Middle",RelationType[RelationType.Bottom_Top=11]="Bottom_Top",RelationType[RelationType.Bottom_Middle=12]="Bottom_Middle",RelationType[RelationType.Bottom_Bottom=13]="Bottom_Bottom",RelationType[RelationType.Width=14]="Width",RelationType[RelationType.Height=15]="Height",RelationType[RelationType.LeftExt_Left=16]="LeftExt_Left",RelationType[RelationType.LeftExt_Right=17]="LeftExt_Right",RelationType[RelationType.RightExt_Left=18]="RightExt_Left",RelationType[RelationType.RightExt_Right=19]="RightExt_Right",RelationType[RelationType.TopExt_Top=20]="TopExt_Top",RelationType[RelationType.TopExt_Bottom=21]="TopExt_Bottom",RelationType[RelationType.BottomExt_Top=22]="BottomExt_Top",RelationType[RelationType.BottomExt_Bottom=23]="BottomExt_Bottom",RelationType[RelationType.Size=24]="Size"}(RelationType=fgui.RelationType||(fgui.RelationType={})),function(FillMethod){FillMethod[FillMethod.None=0]="None",FillMethod[FillMethod.Horizontal=1]="Horizontal",FillMethod[FillMethod.Vertical=2]="Vertical",FillMethod[FillMethod.Radial90=3]="Radial90",FillMethod[FillMethod.Radial180=4]="Radial180",FillMethod[FillMethod.Radial360=5]="Radial360"}(FillMethod=fgui.FillMethod||(fgui.FillMethod={})),function(FillOrigin){FillOrigin[FillOrigin.Top=0]="Top",FillOrigin[FillOrigin.Bottom=1]="Bottom",FillOrigin[FillOrigin.Left=2]="Left",FillOrigin[FillOrigin.Right=3]="Right",FillOrigin[FillOrigin.TopLeft=0]="TopLeft",FillOrigin[FillOrigin.TopRight=1]="TopRight",FillOrigin[FillOrigin.BottomLeft=2]="BottomLeft",FillOrigin[FillOrigin.BottomRight=3]="BottomRight"}(FillOrigin=fgui.FillOrigin||(fgui.FillOrigin={})),function(FillOrigin90){FillOrigin90[FillOrigin90.TopLeft=0]="TopLeft",FillOrigin90[FillOrigin90.TopRight=1]="TopRight",FillOrigin90[FillOrigin90.BottomLeft=2]="BottomLeft",FillOrigin90[FillOrigin90.BottomRight=3]="BottomRight"}(FillOrigin90=fgui.FillOrigin90||(fgui.FillOrigin90={})),function(ObjectPropID){ObjectPropID[ObjectPropID.Text=0]="Text",ObjectPropID[ObjectPropID.Icon=1]="Icon",ObjectPropID[ObjectPropID.Color=2]="Color",ObjectPropID[ObjectPropID.OutlineColor=3]="OutlineColor",ObjectPropID[ObjectPropID.Playing=4]="Playing",ObjectPropID[ObjectPropID.Frame=5]="Frame",ObjectPropID[ObjectPropID.DeltaTime=6]="DeltaTime",ObjectPropID[ObjectPropID.TimeScale=7]="TimeScale",ObjectPropID[ObjectPropID.FontSize=8]="FontSize",ObjectPropID[ObjectPropID.Selected=9]="Selected"}(ObjectPropID=fgui.ObjectPropID||(fgui.ObjectPropID={}))}(fgui||(fgui={})),function(fgui){class Transition{constructor(owner){this._owner=owner,this._items=new Array,this._totalDuration=0,this._autoPlayTimes=1,this._autoPlayDelay=0,this._timeScale=1,this._startTime=0,this._endTime=0}play(onComplete=null,times=1,delay=0,startTime=0,endTime=-1){this._play(onComplete,times,delay,startTime,endTime,!1)}playReverse(onComplete=null,times=1,delay=0,startTime=0,endTime=-1){this._play(onComplete,1,delay,startTime,endTime,!0)}changePlayTimes(value){this._totalTimes=value}setAutoPlay(value,times=1,delay=0){this._autoPlay!=value&&(this._autoPlay=value,this._autoPlayTimes=times,this._autoPlayDelay=delay,this._autoPlay?this._owner.onStage&&this.play(null,null,this._autoPlayTimes,this._autoPlayDelay):this._owner.onStage||this.stop(!1,!0))}_play(onComplete=null,times=1,delay=0,startTime=0,endTime=-1,reversed=!1){this.stop(!0,!0),this._totalTimes=times,this._reversed=reversed,this._startTime=startTime,this._endTime=endTime,this._playing=!0,this._paused=!1,this._onComplete=onComplete;for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];if(null==item.target?item.targetId?item.target=this._owner.getChildById(item.targetId):item.target=this._owner:item.target!=this._owner&&item.target.parent!=this._owner&&(item.target=null),null!=item.target&&item.type==TransitionActionType.Transition){var trans=item.target.getTransition(item.value.transName);if(trans==this&&(trans=null),null!=trans)if(0==item.value.playTimes){var j;for(j=i-1;j>=0;j--){var item2=this._items[j];if(item2.type==TransitionActionType.Transition&&item2.value.trans==trans){item2.value.stopTime=item.time-item2.time;break}}j<0?item.value.stopTime=0:trans=null}else item.value.stopTime=-1;item.value.trans=trans}}0==delay?this.onDelayedPlay():fgui.GTween.delayedCall(delay).onComplete(this.onDelayedPlay,this)}stop(setToComplete=!0,processCallback=!1){if(this._playing){this._playing=!1,this._totalTasks=0,this._totalTimes=0;var handler=this._onComplete;this._onComplete=null,fgui.GTween.kill(this);var cnt=this._items.length;if(this._reversed)for(var i=cnt-1;i>=0;i--){var item=this._items[i];null!=item.target&&this.stopItem(item,setToComplete)}else for(i=0;i<cnt;i++)null!=(item=this._items[i]).target&&this.stopItem(item,setToComplete);processCallback&&null!=handler&&handler.run()}}stopItem(item,setToComplete){if(0!=item.displayLockToken&&(item.target.releaseDisplayLock(item.displayLockToken),item.displayLockToken=0),null!=item.tweener&&(item.tweener.kill(setToComplete),item.tweener=null,item.type!=TransitionActionType.Shake||setToComplete||(item.target._gearLocked=!0,item.target.setXY(item.target.x-item.value.lastOffsetX,item.target.y-item.value.lastOffsetY),item.target._gearLocked=!1)),item.type==TransitionActionType.Transition){var trans=item.value.trans;null!=trans&&trans.stop(setToComplete,!1)}}setPaused(paused){if(this._playing&&this._paused!=paused){this._paused=paused;var tweener=fgui.GTween.getTween(this);null!=tweener&&tweener.setPaused(paused);for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];null!=item.target&&(item.type==TransitionActionType.Transition?null!=item.value.trans&&item.value.trans.setPaused(paused):item.type==TransitionActionType.Animation&&(paused?(item.value.flag=item.target.getProp(fgui.ObjectPropID.Playing),item.target.setProp(fgui.ObjectPropID.Playing,!1)):item.target.setProp(fgui.ObjectPropID.Playing,item.value.flag)),null!=item.tweener&&item.tweener.setPaused(paused))}}}dispose(){this._playing&&fgui.GTween.kill(this);for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];null!=item.tweener&&(item.tweener.kill(),item.tweener=null),item.target=null,item.hook=null,null!=item.tweenConfig&&(item.tweenConfig.endHook=null)}this._items.length=0,this._playing=!1,this._onComplete=null}get playing(){return this._playing}setValue(label,...args){for(var value,cnt=this._items.length,found=!1,i=0;i<cnt;i++){var item=this._items[i];if(item.label==label)value=null!=item.tweenConfig?item.tweenConfig.startValue:item.value,found=!0;else{if(null==item.tweenConfig||item.tweenConfig.endLabel!=label)continue;value=item.tweenConfig.endValue,found=!0}switch(item.type){case TransitionActionType.XY:case TransitionActionType.Size:case TransitionActionType.Pivot:case TransitionActionType.Scale:case TransitionActionType.Skew:value.b1=!0,value.b2=!0,value.f1=parseFloat(args[0]),value.f2=parseFloat(args[1]);break;case TransitionActionType.Alpha:case TransitionActionType.Rotation:case TransitionActionType.Color:value.f1=parseFloat(args[0]);break;case TransitionActionType.Animation:value.frame=parseInt(args[0]),args.length>1&&(value.playing=args[1]);break;case TransitionActionType.Visible:value.visible=args[0];break;case TransitionActionType.Sound:value.sound=args[0],args.length>1&&(value.volume=parseFloat(args[1]));break;case TransitionActionType.Transition:value.transName=args[0],args.length>1&&(value.playTimes=parseInt(args[1]));break;case TransitionActionType.Shake:value.amplitude=parseFloat(args[0]),args.length>1&&(value.duration=parseFloat(args[1]));break;case TransitionActionType.ColorFilter:value.f1=parseFloat(args[0]),value.f2=parseFloat(args[1]),value.f3=parseFloat(args[2]),value.f4=parseFloat(args[3]);break;case TransitionActionType.Text:case TransitionActionType.Icon:value.text=args[0]}}if(!found)throw new Error("this.label not exists")}setHook(label,callback){for(var cnt=this._items.length,found=!1,i=0;i<cnt;i++){var item=this._items[i];if(item.label==label){item.hook=callback,found=!0;break}if(null!=item.tweenConfig&&item.tweenConfig.endLabel==label){item.tweenConfig.endHook=callback,found=!0;break}}if(!found)throw new Error("this.label not exists")}clearHooks(){for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];item.hook=null,null!=item.tweenConfig&&(item.tweenConfig.endHook=null)}}setTarget(label,newTarget){for(var cnt=this._items.length,found=!1,i=0;i<cnt;i++){var item=this._items[i];item.label==label&&(item.targetId=newTarget==this._owner||null==newTarget?"":newTarget.id,this._playing?item.targetId.length>0?item.target=this._owner.getChildById(item.targetId):item.target=this._owner:item.target=null,found=!0)}if(!found)throw new Error("this.label not exists")}setDuration(label,value){for(var cnt=this._items.length,found=!1,i=0;i<cnt;i++){var item=this._items[i];null!=item.tweenConfig&&item.label==label&&(item.tweenConfig.duration=value,found=!0)}if(!found)throw new Error("this.label not exists")}getLabelTime(label){for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];if(item.label==label)return item.time;if(null!=item.tweenConfig&&item.tweenConfig.endLabel==label)return item.time+item.tweenConfig.duration}return NaN}get timeScale(){return this._timeScale}set timeScale(value){if(this._timeScale!=value&&(this._timeScale=value,this._playing))for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];null!=item.tweener?item.tweener.setTimeScale(value):item.type==TransitionActionType.Transition?null!=item.value.trans&&(item.value.trans.timeScale=value):item.type==TransitionActionType.Animation&&null!=item.target&&item.target.setProp(fgui.ObjectPropID.TimeScale,value)}}updateFromRelations(targetId,dx,dy){var cnt=this._items.length;if(0!=cnt)for(var i=0;i<cnt;i++){var item=this._items[i];item.type==TransitionActionType.XY&&item.targetId==targetId&&(null!=item.tweenConfig?(item.tweenConfig.startValue.f1+=dx,item.tweenConfig.startValue.f2+=dy,item.tweenConfig.endValue.f1+=dx,item.tweenConfig.endValue.f2+=dy):(item.value.f1+=dx,item.value.f2+=dy))}}onOwnerAddedToStage(){this._autoPlay&&!this._playing&&this.play(null,this._autoPlayTimes,this._autoPlayDelay)}onOwnerRemovedFromStage(){0==(this._options&Transition.OPTION_AUTO_STOP_DISABLED)&&this.stop(0!=(this._options&Transition.OPTION_AUTO_STOP_AT_END),!1)}onDelayedPlay(){if(this.internalPlay(),this._playing=this._totalTasks>0,this._playing){if(0!=(this._options&Transition.OPTION_IGNORE_DISPLAY_CONTROLLER))for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];null!=item.target&&item.target!=this._owner&&(item.displayLockToken=item.target.addDisplayLock())}}else if(null!=this._onComplete){var handler=this._onComplete;this._onComplete=null,handler.run()}}internalPlay(){this._ownerBaseX=this._owner.x,this._ownerBaseY=this._owner.y,this._totalTasks=0;var item,cnt=this._items.length,needSkipAnimations=!1;if(this._reversed)for(i=cnt-1;i>=0;i--)null!=(item=this._items[i]).target&&this.playItem(item);else for(var i=0;i<cnt;i++)null!=(item=this._items[i]).target&&(item.type==TransitionActionType.Animation&&0!=this._startTime&&item.time<=this._startTime?(needSkipAnimations=!0,item.value.flag=!1):this.playItem(item));needSkipAnimations&&this.skipAnimations()}playItem(item){var time;if(null!=item.tweenConfig){if(time=this._reversed?this._totalDuration-item.time-item.tweenConfig.duration:item.time,-1==this._endTime||time<=this._endTime){var startValue,endValue;switch(this._reversed?(startValue=item.tweenConfig.endValue,endValue=item.tweenConfig.startValue):(startValue=item.tweenConfig.startValue,endValue=item.tweenConfig.endValue),item.value.b1=startValue.b1||endValue.b1,item.value.b2=startValue.b2||endValue.b2,item.type){case TransitionActionType.XY:case TransitionActionType.Size:case TransitionActionType.Scale:case TransitionActionType.Skew:item.tweener=fgui.GTween.to2(startValue.f1,startValue.f2,endValue.f1,endValue.f2,item.tweenConfig.duration);break;case TransitionActionType.Alpha:case TransitionActionType.Rotation:item.tweener=fgui.GTween.to(startValue.f1,endValue.f1,item.tweenConfig.duration);break;case TransitionActionType.Color:item.tweener=fgui.GTween.toColor(startValue.f1,endValue.f1,item.tweenConfig.duration);break;case TransitionActionType.ColorFilter:item.tweener=fgui.GTween.to4(startValue.f1,startValue.f2,startValue.f3,startValue.f4,endValue.f1,endValue.f2,endValue.f3,endValue.f4,item.tweenConfig.duration)}item.tweener.setDelay(time).setEase(item.tweenConfig.easeType).setRepeat(item.tweenConfig.repeat,item.tweenConfig.yoyo).setTimeScale(this._timeScale).setTarget(item).onStart(this.onTweenStart,this).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&item.tweener.setBreakpoint(this._endTime-time),this._totalTasks++}}else item.type==TransitionActionType.Shake?(time=this._reversed?this._totalDuration-item.time-item.value.duration:item.time,item.value.offsetX=item.value.offsetY=0,item.value.lastOffsetX=item.value.lastOffsetY=0,item.tweener=fgui.GTween.shake(0,0,item.value.amplitude,item.value.duration).setDelay(time).setTimeScale(this._timeScale).setTarget(item).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&item.tweener.setBreakpoint(this._endTime-item.time),this._totalTasks++):(time=this._reversed?this._totalDuration-item.time:item.time)<=this._startTime?(this.applyValue(item),this.callHook(item,!1)):(-1==this._endTime||time<=this._endTime)&&(this._totalTasks++,item.tweener=fgui.GTween.delayedCall(time).setTimeScale(this._timeScale).setTarget(item).onComplete(this.onDelayedPlayItem,this));null!=item.tweener&&item.tweener.seek(this._startTime)}skipAnimations(){for(var frame,playStartTime,playTotalTime,value,target,item,cnt=this._items.length,i=0;i<cnt;i++)if(!((item=this._items[i]).type!=TransitionActionType.Animation||item.time>this._startTime||(value=item.value).flag)){frame=(target=item.target).getProp(fgui.ObjectPropID.Frame),playStartTime=target.getProp(fgui.ObjectPropID.Playing)?0:-1,playTotalTime=0;for(var j=i;j<cnt;j++)(item=this._items[j]).type!=TransitionActionType.Animation||item.target!=target||item.time>this._startTime||((value=item.value).flag=!0,-1!=value.frame?(frame=value.frame,playStartTime=value.playing?item.time:-1,playTotalTime=0):value.playing?playStartTime<0&&(playStartTime=item.time):(playStartTime>=0&&(playTotalTime+=item.time-playStartTime),playStartTime=-1),this.callHook(item,!1));playStartTime>=0&&(playTotalTime+=this._startTime-playStartTime),target.setProp(fgui.ObjectPropID.Playing,playStartTime>=0),target.setProp(fgui.ObjectPropID.Frame,frame),playTotalTime>0&&target.setProp(fgui.ObjectPropID.DeltaTime,1e3*playTotalTime)}}onDelayedPlayItem(tweener){var item=tweener.target;item.tweener=null,this._totalTasks--,this.applyValue(item),this.callHook(item,!1),this.checkAllComplete()}onTweenStart(tweener){var startValue,endValue,item=tweener.target;item.type!=TransitionActionType.XY&&item.type!=TransitionActionType.Size||(this._reversed?(startValue=item.tweenConfig.endValue,endValue=item.tweenConfig.startValue):(startValue=item.tweenConfig.startValue,endValue=item.tweenConfig.endValue),item.type==TransitionActionType.XY?item.target!=this._owner?(startValue.b1||(startValue.f1=item.target.x),startValue.b2||(startValue.f2=item.target.y)):(startValue.b1||(startValue.f1=item.target.x-this._ownerBaseX),startValue.b2||(startValue.f2=item.target.y-this._ownerBaseY)):(startValue.b1||(startValue.f1=item.target.width),startValue.b2||(startValue.f2=item.target.height)),endValue.b1||(endValue.f1=startValue.f1),endValue.b2||(endValue.f2=startValue.f2),tweener.startValue.x=startValue.f1,tweener.startValue.y=startValue.f2,tweener.endValue.x=endValue.f1,tweener.endValue.y=endValue.f2);this.callHook(item,!1)}onTweenUpdate(tweener){var item=tweener.target;switch(item.type){case TransitionActionType.XY:case TransitionActionType.Size:case TransitionActionType.Scale:case TransitionActionType.Skew:item.value.f1=tweener.value.x,item.value.f2=tweener.value.y;break;case TransitionActionType.Alpha:case TransitionActionType.Rotation:item.value.f1=tweener.value.x;break;case TransitionActionType.Color:item.value.f1=tweener.value.color;break;case TransitionActionType.ColorFilter:item.value.f1=tweener.value.x,item.value.f2=tweener.value.y,item.value.f3=tweener.value.z,item.value.f4=tweener.value.w;break;case TransitionActionType.Shake:item.value.offsetX=tweener.deltaValue.x,item.value.offsetY=tweener.deltaValue.y}this.applyValue(item)}onTweenComplete(tweener){var item=tweener.target;item.tweener=null,this._totalTasks--,tweener.allCompleted&&this.callHook(item,!0),this.checkAllComplete()}onPlayTransCompleted(item){this._totalTasks--,this.checkAllComplete()}callHook(item,tweenEnd){tweenEnd?null!=item.tweenConfig&&null!=item.tweenConfig.endHook&&item.tweenConfig.endHook.run():item.time>=this._startTime&&null!=item.hook&&item.hook.run()}checkAllComplete(){if(this._playing&&0==this._totalTasks)if(this._totalTimes<0)this.internalPlay();else if(this._totalTimes--,this._totalTimes>0)this.internalPlay();else{this._playing=!1;for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._items[i];null!=item.target&&0!=item.displayLockToken&&(item.target.releaseDisplayLock(item.displayLockToken),item.displayLockToken=0)}if(null!=this._onComplete){var handler=this._onComplete;this._onComplete=null,handler.run()}}}applyValue(item){switch(item.target._gearLocked=!0,item.type){case TransitionActionType.XY:var f1,f2;if(item.target==this._owner)f1=item.value.b1?item.value.f1+this._ownerBaseX:item.target.x,f2=item.value.b2?item.value.f2+this._ownerBaseY:item.target.y,item.target.setXY(f1,f2);else item.value.b1||(item.value.f1=item.target.x),item.value.b2||(item.value.f2=item.target.y),item.target.setXY(item.value.f1,item.value.f2);break;case TransitionActionType.Size:item.value.b1||(item.value.f1=item.target.width),item.value.b2||(item.value.f2=item.target.height),item.target.setSize(item.value.f1,item.value.f2);break;case TransitionActionType.Pivot:item.target.setPivot(item.value.f1,item.value.f2,item.target.pivotAsAnchor);break;case TransitionActionType.Alpha:item.target.alpha=item.value.f1;break;case TransitionActionType.Rotation:item.target.rotation=item.value.f1;break;case TransitionActionType.Scale:item.target.setScale(item.value.f1,item.value.f2);break;case TransitionActionType.Skew:item.target.setSkew(item.value.f1,item.value.f2);break;case TransitionActionType.Color:item.target.setProp(fgui.ObjectPropID.Color,fgui.ToolSet.convertToHtmlColor(item.value.f1,!1));break;case TransitionActionType.Animation:item.value.frame>=0&&item.target.setProp(fgui.ObjectPropID.Frame,item.value.frame),item.target.setProp(fgui.ObjectPropID.Playing,item.value.playing),item.target.setProp(fgui.ObjectPropID.TimeScale,this._timeScale);break;case TransitionActionType.Visible:item.target.visible=item.value.visible;break;case TransitionActionType.Transition:if(this._playing){var trans=item.value.trans;if(null!=trans){this._totalTasks++;var startTime=this._startTime>item.time?this._startTime-item.time:0,endTime=this._endTime>=0?this._endTime-item.time:-1;item.value.stopTime>=0&&(endTime<0||endTime>item.value.stopTime)&&(endTime=item.value.stopTime),trans.timeScale=this._timeScale,trans._play(Laya.Handler.create(this,this.onPlayTransCompleted,[item]),item.value.playTimes,0,startTime,endTime,this._reversed)}}break;case TransitionActionType.Sound:if(this._playing&&item.time>=this._startTime){if(null==item.value.audioClip){var pi=fgui.UIPackage.getItemByURL(item.value.sound);item.value.audioClip=pi?pi.file:item.value.sound}item.value.audioClip&&fgui.GRoot.inst.playOneShotSound(item.value.audioClip,item.value.volume)}break;case TransitionActionType.Shake:item.target.setXY(item.target.x-item.value.lastOffsetX+item.value.offsetX,item.target.y-item.value.lastOffsetY+item.value.offsetY),item.value.lastOffsetX=item.value.offsetX,item.value.lastOffsetY=item.value.offsetY;break;case TransitionActionType.ColorFilter:var arr=item.target.filters,cm=new fgui.ColorMatrix;cm.adjustBrightness(item.value.f1),cm.adjustContrast(item.value.f2),cm.adjustSaturation(item.value.f3),cm.adjustHue(item.value.f4),arr=[new Laya.ColorFilter(cm)],item.target.filters=arr;break;case TransitionActionType.Text:item.target.text=item.value.text;break;case TransitionActionType.Icon:item.target.icon=item.value.text}item.target._gearLocked=!1}setup(buffer){this.name=buffer.readS(),this._options=buffer.getInt32(),this._autoPlay=buffer.readBool(),this._autoPlayTimes=buffer.getInt32(),this._autoPlayDelay=buffer.getFloat32();for(var cnt=buffer.getInt16(),i=0;i<cnt;i++){var dataLen=buffer.getInt16(),curPos=buffer.pos;buffer.seek(curPos,0);var item=new TransitionItem(buffer.readByte());this._items[i]=item,item.time=buffer.getFloat32();var targetId=buffer.getInt16();item.targetId=targetId<0?"":this._owner.getChildAt(targetId).id,item.label=buffer.readS(),buffer.readBool()?(buffer.seek(curPos,1),item.tweenConfig=new TweenConfig,item.tweenConfig.duration=buffer.getFloat32(),item.time+item.tweenConfig.duration>this._totalDuration&&(this._totalDuration=item.time+item.tweenConfig.duration),item.tweenConfig.easeType=buffer.readByte(),item.tweenConfig.repeat=buffer.getInt32(),item.tweenConfig.yoyo=buffer.readBool(),item.tweenConfig.endLabel=buffer.readS(),buffer.seek(curPos,2),this.decodeValue(item,buffer,item.tweenConfig.startValue),buffer.seek(curPos,3),this.decodeValue(item,buffer,item.tweenConfig.endValue)):(item.time>this._totalDuration&&(this._totalDuration=item.time),buffer.seek(curPos,2),this.decodeValue(item,buffer,item.value)),buffer.pos=curPos+dataLen}}decodeValue(item,buffer,value){switch(item.type){case TransitionActionType.XY:case TransitionActionType.Size:case TransitionActionType.Pivot:case TransitionActionType.Skew:value.b1=buffer.readBool(),value.b2=buffer.readBool(),value.f1=buffer.getFloat32(),value.f2=buffer.getFloat32();break;case TransitionActionType.Alpha:case TransitionActionType.Rotation:value.f1=buffer.getFloat32();break;case TransitionActionType.Scale:value.f1=buffer.getFloat32(),value.f2=buffer.getFloat32();break;case TransitionActionType.Color:value.f1=buffer.readColor();break;case TransitionActionType.Animation:value.playing=buffer.readBool(),value.frame=buffer.getInt32();break;case TransitionActionType.Visible:value.visible=buffer.readBool();break;case TransitionActionType.Sound:value.sound=buffer.readS(),value.volume=buffer.getFloat32();break;case TransitionActionType.Transition:value.transName=buffer.readS(),value.playTimes=buffer.getInt32();break;case TransitionActionType.Shake:value.amplitude=buffer.getFloat32(),value.duration=buffer.getFloat32();break;case TransitionActionType.ColorFilter:value.f1=buffer.getFloat32(),value.f2=buffer.getFloat32(),value.f3=buffer.getFloat32(),value.f4=buffer.getFloat32();break;case TransitionActionType.Text:case TransitionActionType.Icon:value.text=buffer.readS()}}}Transition.OPTION_IGNORE_DISPLAY_CONTROLLER=1,Transition.OPTION_AUTO_STOP_DISABLED=2,Transition.OPTION_AUTO_STOP_AT_END=4,fgui.Transition=Transition;class TransitionActionType{}TransitionActionType.XY=0,TransitionActionType.Size=1,TransitionActionType.Scale=2,TransitionActionType.Pivot=3,TransitionActionType.Alpha=4,TransitionActionType.Rotation=5,TransitionActionType.Color=6,TransitionActionType.Animation=7,TransitionActionType.Visible=8,TransitionActionType.Sound=9,TransitionActionType.Transition=10,TransitionActionType.Shake=11,TransitionActionType.ColorFilter=12,TransitionActionType.Skew=13,TransitionActionType.Text=14,TransitionActionType.Icon=15,TransitionActionType.Unknown=16;class TransitionItem{constructor(type){switch(this.type=type,type){case TransitionActionType.XY:case TransitionActionType.Size:case TransitionActionType.Scale:case TransitionActionType.Pivot:case TransitionActionType.Skew:case TransitionActionType.Alpha:case TransitionActionType.Rotation:case TransitionActionType.Color:case TransitionActionType.ColorFilter:this.value=new TValue;break;case TransitionActionType.Animation:this.value=new TValue_Animation;break;case TransitionActionType.Shake:this.value=new TValue_Shake;break;case TransitionActionType.Sound:this.value=new TValue_Sound;break;case TransitionActionType.Transition:this.value=new TValue_Transition;break;case TransitionActionType.Visible:this.value=new TValue_Visible;break;case TransitionActionType.Text:case TransitionActionType.Icon:this.value=new TValue_Text}}}class TweenConfig{constructor(){this.easeType=fgui.EaseType.QuadOut,this.startValue=new TValue,this.endValue=new TValue}}class TValue_Visible{}class TValue_Animation{}class TValue_Sound{}class TValue_Transition{}class TValue_Shake{}class TValue_Text{}class TValue{constructor(){this.b1=this.b2=!0}}}(fgui||(fgui={})),function(fgui){class GObject{constructor(){this._x=0,this._y=0,this._alpha=1,this._rotation=0,this._visible=!0,this._touchable=!0,this._grayed=!1,this._draggable=!1,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._pivotX=0,this._pivotY=0,this._pivotAsAnchor=!1,this._pivotOffsetX=0,this._pivotOffsetY=0,this._sortingOrder=0,this._internalVisible=!0,this._handlingController=!1,this._focusable=!1,this._pixelSnapping=!1,this._yOffset=0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.sourceWidth=0,this.sourceHeight=0,this.initWidth=0,this.initHeight=0,this._width=0,this._height=0,this._rawWidth=0,this._rawHeight=0,this._sizePercentInGroup=0,this._id=""+GObject._gInstanceCounter++,this._name="",this.createDisplayObject(),this._relations=new fgui.Relations(this),this._gears=[]}get id(){return this._id}get name(){return this._name}set name(value){this._name=value}get x(){return this._x}set x(value){this.setXY(value,this._y)}get y(){return this._y}set y(value){this.setXY(this._x,value)}setXY(xv,yv){if(this._x!=xv||this._y!=yv){var dx=xv-this._x,dy=yv-this._y;this._x=xv,this._y=yv,this.handleXYChanged(),this instanceof fgui.GGroup&&this.moveChildren(dx,dy),this.updateGear(1),!this._parent||this._parent instanceof fgui.GList||(this._parent.setBoundsChangedFlag(),null!=this._group&&this._group.setBoundsChangedFlag(),this.displayObject.event(fgui.Events.XY_CHANGED)),GObject.draggingObject!=this||GObject.sUpdateInDragging||this.localToGlobalRect(0,0,this.width,this.height,GObject.sGlobalRect)}}get xMin(){return this._pivotAsAnchor?this._x-this._width*this._pivotX:this._x}set xMin(value){this._pivotAsAnchor?this.setXY(value+this._width*this._pivotX,this._y):this.setXY(value,this._y)}get yMin(){return this._pivotAsAnchor?this._y-this._height*this._pivotY:this._y}set yMin(value){this._pivotAsAnchor?this.setXY(this._x,value+this._height*this._pivotY):this.setXY(this._x,value)}get pixelSnapping(){return this._pixelSnapping}set pixelSnapping(value){this._pixelSnapping!=value&&(this._pixelSnapping=value,this.handleXYChanged())}center(restraint=!1){var r;r=null!=this._parent?this.parent:this.root,this.setXY((r.width-this.width)/2,(r.height-this.height)/2),restraint&&(this.addRelation(r,fgui.RelationType.Center_Center),this.addRelation(r,fgui.RelationType.Middle_Middle))}get width(){return this.ensureSizeCorrect(),this._relations.sizeDirty&&this._relations.ensureRelationsSizeCorrect(),this._width}set width(value){this.setSize(value,this._rawHeight)}get height(){return this.ensureSizeCorrect(),this._relations.sizeDirty&&this._relations.ensureRelationsSizeCorrect(),this._height}set height(value){this.setSize(this._rawWidth,value)}setSize(wv,hv,ignorePivot=!1){if(this._rawWidth!=wv||this._rawHeight!=hv){this._rawWidth=wv,this._rawHeight=hv,wv<this.minWidth&&(wv=this.minWidth),hv<this.minHeight&&(hv=this.minHeight),this.maxWidth>0&&wv>this.maxWidth&&(wv=this.maxWidth),this.maxHeight>0&&hv>this.maxHeight&&(hv=this.maxHeight);var dWidth=wv-this._width,dHeight=hv-this._height;this._width=wv,this._height=hv,this.handleSizeChanged(),0==this._pivotX&&0==this._pivotY||(this._pivotAsAnchor?this.applyPivot():(ignorePivot||this.setXY(this.x-this._pivotX*dWidth,this.y-this._pivotY*dHeight),this.updatePivotOffset())),this instanceof fgui.GGroup&&this.resizeChildren(dWidth,dHeight),this.updateGear(2),this._parent&&(this._relations.onOwnerSizeChanged(dWidth,dHeight,this._pivotAsAnchor||!ignorePivot),this._parent.setBoundsChangedFlag(),null!=this._group&&this._group.setBoundsChangedFlag(!0)),this.displayObject.event(fgui.Events.SIZE_CHANGED)}}ensureSizeCorrect(){}makeFullScreen(){this.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height)}get actualWidth(){return this.width*Math.abs(this._scaleX)}get actualHeight(){return this.height*Math.abs(this._scaleY)}get scaleX(){return this._scaleX}set scaleX(value){this.setScale(value,this._scaleY)}get scaleY(){return this._scaleY}set scaleY(value){this.setScale(this._scaleX,value)}setScale(sx,sy){this._scaleX==sx&&this._scaleY==sy||(this._scaleX=sx,this._scaleY=sy,this.handleScaleChanged(),this.applyPivot(),this.updateGear(2))}get skewX(){return this._skewX}set skewX(value){this.setSkew(value,this._skewY)}get skewY(){return this._skewY}set skewY(value){this.setSkew(this._skewX,value)}setSkew(sx,sy){this._skewX==sx&&this._skewY==sy||(this._skewX=sx,this._skewY=sy,null!=this._displayObject&&(this._displayObject.skew(-sx,sy),this.applyPivot()))}get pivotX(){return this._pivotX}set pivotX(value){this.setPivot(value,this._pivotY)}get pivotY(){return this._pivotY}set pivotY(value){this.setPivot(this._pivotX,value)}setPivot(xv,yv=0,asAnchor=!1){this._pivotX==xv&&this._pivotY==yv&&this._pivotAsAnchor==asAnchor||(this._pivotX=xv,this._pivotY=yv,this._pivotAsAnchor=asAnchor,this.updatePivotOffset(),this.handleXYChanged())}get pivotAsAnchor(){return this._pivotAsAnchor}internalSetPivot(xv,yv,asAnchor){this._pivotX=xv,this._pivotY=yv,this._pivotAsAnchor=asAnchor,this._pivotAsAnchor&&this.handleXYChanged()}updatePivotOffset(){if(null!=this._displayObject)if(!this._displayObject.transform||0==this._pivotX&&0==this._pivotY)this._pivotOffsetX=0,this._pivotOffsetY=0;else{GObject.sHelperPoint.x=this._pivotX*this._width,GObject.sHelperPoint.y=this._pivotY*this._height;var pt=this._displayObject.transform.transformPoint(GObject.sHelperPoint);this._pivotOffsetX=this._pivotX*this._width-pt.x,this._pivotOffsetY=this._pivotY*this._height-pt.y}}applyPivot(){0==this._pivotX&&0==this._pivotY||(this.updatePivotOffset(),this.handleXYChanged())}get touchable(){return this._touchable}set touchable(value){if(this._touchable!=value){if(this._touchable=value,this.updateGear(3),this instanceof fgui.GImage||this instanceof fgui.GMovieClip||this instanceof fgui.GTextField&&!(this instanceof fgui.GTextInput)&&!(this instanceof fgui.GRichTextField))return;null!=this._displayObject&&(this._displayObject.mouseEnabled=this._touchable)}}get grayed(){return this._grayed}set grayed(value){this._grayed!=value&&(this._grayed=value,this.handleGrayedChanged(),this.updateGear(3))}get enabled(){return!this._grayed&&this._touchable}set enabled(value){this.grayed=!value,this.touchable=value}get rotation(){return this._rotation}set rotation(value){this._rotation!=value&&(this._rotation=value,null!=this._displayObject&&(this._displayObject.rotation=this.normalizeRotation,this.applyPivot()),this.updateGear(3))}get normalizeRotation(){var rot=this._rotation%360;return rot>180?rot-=360:rot<-180&&(rot=360+rot),rot}get alpha(){return this._alpha}set alpha(value){this._alpha!=value&&(this._alpha=value,this.handleAlphaChanged(),this.updateGear(3))}get visible(){return this._visible}set visible(value){this._visible!=value&&(this._visible=value,this.handleVisibleChanged(),this._parent&&this._parent.setBoundsChangedFlag())}get internalVisible(){return this._internalVisible&&(!this._group||this._group.internalVisible)&&!this._displayObject._cacheStyle.maskParent}get internalVisible2(){return this._visible&&(!this._group||this._group.internalVisible2)}get sortingOrder(){return this._sortingOrder}set sortingOrder(value){if(value<0&&(value=0),this._sortingOrder!=value){var old=this._sortingOrder;this._sortingOrder=value,null!=this._parent&&this._parent.childSortingOrderChanged(this,old,this._sortingOrder)}}get focusable(){return this._focusable}set focusable(value){this._focusable=value}get focused(){return this.root.focus==this}requestFocus(){for(var p=this;p&&!p._focusable;)p=p.parent;null!=p&&(this.root.focus=p)}get tooltips(){return this._tooltips}set tooltips(value){this._tooltips&&(this.off(Laya.Event.ROLL_OVER,this,this.__rollOver),this.off(Laya.Event.ROLL_OUT,this,this.__rollOut)),this._tooltips=value,this._tooltips&&(this.on(Laya.Event.ROLL_OVER,this,this.__rollOver),this.on(Laya.Event.ROLL_OUT,this,this.__rollOut))}__rollOver(evt){Laya.timer.once(100,this,this.__doShowTooltips)}__doShowTooltips(){this.root&&this.root.showTooltips(this._tooltips)}__rollOut(evt){Laya.timer.clear(this,this.__doShowTooltips),this.root.hideTooltips()}get blendMode(){return this._displayObject.blendMode}set blendMode(value){this._displayObject.blendMode=value}get filters(){return this._displayObject.filters}set filters(value){this._displayObject.filters=value}get inContainer(){return null!=this._displayObject&&null!=this._displayObject.parent}get onStage(){return null!=this._displayObject&&null!=this._displayObject.stage}get resourceURL(){return null!=this.packageItem?"ui://"+this.packageItem.owner.id+this.packageItem.id:null}set group(value){this._group!=value&&(null!=this._group&&this._group.setBoundsChangedFlag(!0),this._group=value,null!=this._group&&this._group.setBoundsChangedFlag(!0))}get group(){return this._group}getGear(index){var gear=this._gears[index];if(null==gear){switch(index){case 0:gear=new fgui.GearDisplay(this);break;case 1:gear=new fgui.GearXY(this);break;case 2:gear=new fgui.GearSize(this);break;case 3:gear=new fgui.GearLook(this);break;case 4:gear=new fgui.GearColor(this);break;case 5:gear=new fgui.GearAnimation(this);break;case 6:gear=new fgui.GearText(this);break;case 7:gear=new fgui.GearIcon(this);break;default:throw new Error("FairyGUI: invalid gear index!")}this._gears[index]=gear}return gear}updateGear(index){if(!this._underConstruct&&!this._gearLocked){var gear=this._gears[index];null!=gear&&null!=gear.controller&&gear.updateState()}}checkGearController(index,c){return null!=this._gears[index]&&this._gears[index].controller==c}updateGearFromRelations(index,dx,dy){null!=this._gears[index]&&this._gears[index].updateFromRelations(dx,dy)}addDisplayLock(){var gearDisplay=this._gears[0];if(gearDisplay&&gearDisplay.controller){var ret=gearDisplay.addLock();return this.checkGearDisplay(),ret}return 0}releaseDisplayLock(token){var gearDisplay=this._gears[0];gearDisplay&&gearDisplay.controller&&(gearDisplay.releaseLock(token),this.checkGearDisplay())}checkGearDisplay(){if(!this._handlingController){var connected=null==this._gears[0]||this._gears[0].connected;connected!=this._internalVisible&&(this._internalVisible=connected,this._parent&&this._parent.childStateChanged(this))}}get relations(){return this._relations}addRelation(target,relationType,usePercent=!1){this._relations.add(target,relationType,usePercent)}removeRelation(target,relationType=0){this._relations.remove(target,relationType)}get displayObject(){return this._displayObject}get parent(){return this._parent}set parent(val){this._parent=val}removeFromParent(){this._parent&&this._parent.removeChild(this)}get root(){if(this instanceof fgui.GRoot)return this;for(var p=this._parent;p;){if(p instanceof fgui.GRoot)return p;p=p.parent}return fgui.GRoot.inst}get asCom(){return this}get asButton(){return this}get asLabel(){return this}get asProgress(){return this}get asTextField(){return this}get asRichTextField(){return this}get asTextInput(){return this}get asLoader(){return this}get asList(){return this}get asGraph(){return this}get asGroup(){return this}get asSlider(){return this}get asComboBox(){return this}get asImage(){return this}get asMovieClip(){return this}get text(){return null}set text(value){}get icon(){return null}set icon(value){}get isDisposed(){return null==this._displayObject}dispose(){this.removeFromParent(),this._relations.dispose(),this._displayObject.destroy(),this._displayObject=null;for(var i=0;i<8;i++){var gear=this._gears[i];null!=gear&&gear.dispose()}}onClick(thisObj,listener,args=null){this.on(Laya.Event.CLICK,thisObj,listener,args)}offClick(thisObj,listener){this.off(Laya.Event.CLICK,thisObj,listener)}hasClickListener(){return this._displayObject.hasListener(Laya.Event.CLICK)}on(type,thisObject,listener,args=null){this._displayObject.on(type,thisObject,listener,args)}off(type,thisObject,listener){this._displayObject.off(type,thisObject,listener)}get draggable(){return this._draggable}set draggable(value){this._draggable!=value&&(this._draggable=value,this.initDrag())}get dragBounds(){return this._dragBounds}set dragBounds(value){this._dragBounds=value}startDrag(touchPointID=-1){null!=this._displayObject.stage&&this.dragBegin()}stopDrag(){this.dragEnd()}get dragging(){return GObject.draggingObject==this}localToGlobal(ax=0,ay=0,resultPoint=null){return this._pivotAsAnchor&&(ax+=this._pivotX*this._width,ay+=this._pivotY*this._height),resultPoint?(resultPoint.x=ax,resultPoint.y=ay,this._displayObject.localToGlobal(resultPoint,!1)):((resultPoint=GObject.sHelperPoint).x=ax,resultPoint.y=ay,this._displayObject.localToGlobal(resultPoint,!0))}globalToLocal(ax=0,ay=0,resultPoint=null){return resultPoint?(resultPoint.x=ax,resultPoint.y=ay,this._displayObject.globalToLocal(resultPoint,!1)):((resultPoint=GObject.sHelperPoint).x=ax,resultPoint.y=ay,resultPoint=this._displayObject.globalToLocal(resultPoint,!0)),this._pivotAsAnchor&&(resultPoint.x-=this._pivotX*this._width,resultPoint.y-=this._pivotY*this._height),resultPoint}localToGlobalRect(ax=0,ay=0,aWidth=0,aHeight=0,resultRect=null){null==resultRect&&(resultRect=new Laya.Rectangle);var pt=this.localToGlobal(ax,ay);return resultRect.x=pt.x,resultRect.y=pt.y,pt=this.localToGlobal(ax+aWidth,ay+aHeight),resultRect.width=pt.x-resultRect.x,resultRect.height=pt.y-resultRect.y,resultRect}globalToLocalRect(ax=0,ay=0,aWidth=0,aHeight=0,resultRect=null){null==resultRect&&(resultRect=new Laya.Rectangle);var pt=this.globalToLocal(ax,ay);return resultRect.x=pt.x,resultRect.y=pt.y,pt=this.globalToLocal(ax+aWidth,ay+aHeight),resultRect.width=pt.x-resultRect.x,resultRect.height=pt.y-resultRect.y,resultRect}handleControllerChanged(c){this._handlingController=!0;for(var i=0;i<8;i++){var gear=this._gears[i];null!=gear&&gear.controller==c&&gear.apply()}this._handlingController=!1,this.checkGearDisplay()}createDisplayObject(){this._displayObject=new Laya.Sprite,this._displayObject.$owner=this}handleXYChanged(){var xv=this._x,yv=this._y+this._yOffset;this._pivotAsAnchor&&(xv-=this._pivotX*this._width,yv-=this._pivotY*this._height),this._pixelSnapping&&(xv=Math.round(xv),yv=Math.round(yv)),this._displayObject.pos(xv+this._pivotOffsetX,yv+this._pivotOffsetY)}handleSizeChanged(){null!=this._displayObject&&this._displayObject.size(this._width,this._height)}handleScaleChanged(){null!=this._displayObject&&this._displayObject.scale(this._scaleX,this._scaleY)}handleGrayedChanged(){this._displayObject&&(this._grayed?(null==GObject.grayFilter&&(GObject.grayFilter=new Laya.ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])),this._displayObject.filters=[GObject.grayFilter]):this._displayObject.filters=null)}handleAlphaChanged(){this._displayObject&&(this._displayObject.alpha=this._alpha)}handleVisibleChanged(){this._displayObject&&(this._displayObject.visible=this.internalVisible2)}getProp(index){switch(index){case fgui.ObjectPropID.Text:return this.text;case fgui.ObjectPropID.Icon:return this.icon;case fgui.ObjectPropID.Color:case fgui.ObjectPropID.OutlineColor:return null;case fgui.ObjectPropID.Playing:return!1;case fgui.ObjectPropID.Frame:case fgui.ObjectPropID.DeltaTime:return 0;case fgui.ObjectPropID.TimeScale:return 1;case fgui.ObjectPropID.FontSize:return 0;case fgui.ObjectPropID.Selected:return!1;default:return}}setProp(index,value){switch(index){case fgui.ObjectPropID.Text:this.text=value;break;case fgui.ObjectPropID.Icon:this.icon=value}}constructFromResource(){}setup_beforeAdd(buffer,beginPos){var f1,f2;if(buffer.seek(beginPos,0),buffer.skip(5),this._id=buffer.readS(),this._name=buffer.readS(),f1=buffer.getInt32(),f2=buffer.getInt32(),this.setXY(f1,f2),buffer.readBool()&&(this.initWidth=buffer.getInt32(),this.initHeight=buffer.getInt32(),this.setSize(this.initWidth,this.initHeight,!0)),buffer.readBool()&&(this.minWidth=buffer.getInt32(),this.maxWidth=buffer.getInt32(),this.minHeight=buffer.getInt32(),this.maxHeight=buffer.getInt32()),buffer.readBool()&&(f1=buffer.getFloat32(),f2=buffer.getFloat32(),this.setScale(f1,f2)),buffer.readBool()&&(f1=buffer.getFloat32(),f2=buffer.getFloat32(),this.setSkew(f1,f2)),buffer.readBool()&&(f1=buffer.getFloat32(),f2=buffer.getFloat32(),this.setPivot(f1,f2,buffer.readBool())),1!=(f1=buffer.getFloat32())&&(this.alpha=f1),0!=(f1=buffer.getFloat32())&&(this.rotation=f1),buffer.readBool()||(this.visible=!1),buffer.readBool()||(this.touchable=!1),buffer.readBool()&&(this.grayed=!0),2==buffer.readByte()&&(this.blendMode="lighter"),1==buffer.readByte()){var cm=new fgui.ColorMatrix;cm.adjustBrightness(buffer.getFloat32()),cm.adjustContrast(buffer.getFloat32()),cm.adjustSaturation(buffer.getFloat32()),cm.adjustHue(buffer.getFloat32());var cf=new Laya.ColorFilter(cm);this.filters=[cf]}var str=buffer.readS();null!=str&&(this.data=str)}setup_afterAdd(buffer,beginPos){buffer.seek(beginPos,1);var str=buffer.readS();null!=str&&(this.tooltips=str);var groupId=buffer.getInt16();groupId>=0&&(this.group=this.parent.getChildAt(groupId)),buffer.seek(beginPos,2);for(var cnt=buffer.getInt16(),i=0;i<cnt;i++){var nextPos=buffer.getInt16();nextPos+=buffer.pos,this.getGear(buffer.readByte()).setup(buffer),buffer.pos=nextPos}}initDrag(){this._draggable?this.on(Laya.Event.MOUSE_DOWN,this,this.__begin):this.off(Laya.Event.MOUSE_DOWN,this,this.__begin)}dragBegin(){null!=GObject.draggingObject&&GObject.draggingObject.stopDrag(),GObject.sGlobalDragStart.x=Laya.stage.mouseX,GObject.sGlobalDragStart.y=Laya.stage.mouseY,this.localToGlobalRect(0,0,this.width,this.height,GObject.sGlobalRect),GObject.draggingObject=this,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.__moving2),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__end2)}dragEnd(){GObject.draggingObject==this&&(Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.__moving2),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.__end2),GObject.draggingObject=null),GObject.sDraggingQuery=!1}reset(){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.__moving),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.__end)}__begin(){null==this._touchDownPoint&&(this._touchDownPoint=new Laya.Point),this._touchDownPoint.x=Laya.stage.mouseX,this._touchDownPoint.y=Laya.stage.mouseY,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.__moving),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__end)}__end(){this.reset()}__moving(evt){var sensitivity=fgui.UIConfig.touchDragSensitivity;null!=this._touchDownPoint&&Math.abs(this._touchDownPoint.x-Laya.stage.mouseX)<sensitivity&&Math.abs(this._touchDownPoint.y-Laya.stage.mouseY)<sensitivity||(this.reset(),GObject.sDraggingQuery=!0,fgui.Events.dispatch(fgui.Events.DRAG_START,this._displayObject,evt),GObject.sDraggingQuery&&this.dragBegin())}__moving2(evt){var xx=Laya.stage.mouseX-GObject.sGlobalDragStart.x+GObject.sGlobalRect.x,yy=Laya.stage.mouseY-GObject.sGlobalDragStart.y+GObject.sGlobalRect.y;if(null!=this._dragBounds){var rect=fgui.GRoot.inst.localToGlobalRect(this._dragBounds.x,this._dragBounds.y,this._dragBounds.width,this._dragBounds.height,GObject.sDragHelperRect);xx<rect.x?xx=rect.x:xx+GObject.sGlobalRect.width>rect.right&&(xx=rect.right-GObject.sGlobalRect.width)<rect.x&&(xx=rect.x),yy<rect.y?yy=rect.y:yy+GObject.sGlobalRect.height>rect.bottom&&(yy=rect.bottom-GObject.sGlobalRect.height)<rect.y&&(yy=rect.y)}GObject.sUpdateInDragging=!0;var pt=this.parent.globalToLocal(xx,yy,GObject.sHelperPoint);this.setXY(Math.round(pt.x),Math.round(pt.y)),GObject.sUpdateInDragging=!1,fgui.Events.dispatch(fgui.Events.DRAG_MOVE,this._displayObject,evt)}__end2(evt){GObject.draggingObject==this&&(this.stopDrag(),fgui.Events.dispatch(fgui.Events.DRAG_END,this._displayObject,evt))}static cast(sprite){return sprite.$owner}}GObject._gInstanceCounter=0,GObject.grayFilter=null,GObject.sGlobalDragStart=new Laya.Point,GObject.sGlobalRect=new Laya.Rectangle,GObject.sHelperPoint=new Laya.Point,GObject.sDragHelperRect=new Laya.Rectangle,fgui.GObject=GObject}(fgui||(fgui={})),function(fgui){fgui.PackageItem=class{constructor(){this.width=0,this.height=0,this.tileGridIndice=0,this.interval=0,this.repeatDelay=0}load(){return this.owner.getItemAsset(this)}toString(){return this.name}}}(fgui||(fgui={})),function(fgui){fgui.GComponent=class extends fgui.GObject{constructor(){super(),this._sortingChildCount=0,this._mask=null,this._children=[],this._controllers=[],this._transitions=[],this._margin=new fgui.Margin,this._alignOffset=new Laya.Point,this._opaque=!1,this._childrenRenderOrder=0,this._apexIndex=0}createDisplayObject(){super.createDisplayObject(),this._displayObject.mouseEnabled=!0,this._displayObject.mouseThrough=!0,this._container=this._displayObject}dispose(){var i,cnt;for(cnt=this._transitions.length,i=0;i<cnt;++i)this._transitions[i].dispose();for(cnt=this._controllers.length,i=0;i<cnt;++i)this._controllers[i].dispose();for(null!=this.scrollPane&&this.scrollPane.dispose(),i=(cnt=this._children.length)-1;i>=0;--i){var obj=this._children[i];obj.parent=null,obj.dispose()}this._boundsChanged=!1,this._mask=null,super.dispose()}get displayListContainer(){return this._container}addChild(child){return this.addChildAt(child,this._children.length),child}addChildAt(child,index=0){if(!child)throw"child is null";if(this._children.length,index>=0&&index<=this.numChildren){if(child.parent==this)this.setChildIndex(child,index);else{child.removeFromParent(),child.parent=this;var cnt=this._children.length;0!=child.sortingOrder?(this._sortingChildCount++,index=this.getInsertPosForSortingChild(child)):this._sortingChildCount>0&&index>cnt-this._sortingChildCount&&(index=cnt-this._sortingChildCount),index==cnt?this._children.push(child):this._children.splice(index,0,child),this.childStateChanged(child),this.setBoundsChangedFlag()}return child}throw"Invalid child index"}getInsertPosForSortingChild(target){var cnt=this._children.length,i=0;for(i=0;i<cnt;i++){var child=this._children[i];if(child!=target&&target.sortingOrder<child.sortingOrder)break}return i}removeChild(child,dispose){var childIndex=this._children.indexOf(child);return-1!=childIndex&&this.removeChildAt(childIndex,dispose),child}removeChildAt(index,dispose){if(index>=0&&index<this.numChildren){var child=this._children[index];return child.parent=null,0!=child.sortingOrder&&this._sortingChildCount--,this._children.splice(index,1),child.group=null,child.inContainer&&(this._container.removeChild(child.displayObject),this._childrenRenderOrder==fgui.ChildrenRenderOrder.Arch&&Laya.timer.callLater(this,this.buildNativeDisplayList)),dispose&&child.dispose(),this.setBoundsChangedFlag(),child}throw"Invalid child index"}removeChildren(beginIndex=0,endIndex=-1,dispose){(endIndex<0||endIndex>=this.numChildren)&&(endIndex=this.numChildren-1);for(var i=beginIndex;i<=endIndex;++i)this.removeChildAt(beginIndex,dispose)}getChildAt(index){if(index>=0&&index<this.numChildren)return this._children[index];throw"Invalid child index"}getChild(name){for(var cnt=this._children.length,i=0;i<cnt;++i)if(this._children[i].name==name)return this._children[i];return null}getVisibleChild(name){for(var cnt=this._children.length,i=0;i<cnt;++i){var child=this._children[i];if(child.internalVisible&&child.internalVisible2&&child.name==name)return child}return null}getChildInGroup(name,group){for(var cnt=this._children.length,i=0;i<cnt;++i){var child=this._children[i];if(child.group==group&&child.name==name)return child}return null}getChildById(id){for(var cnt=this._children.length,i=0;i<cnt;++i)if(this._children[i]._id==id)return this._children[i];return null}getChildIndex(child){return this._children.indexOf(child)}setChildIndex(child,index){var oldIndex=this._children.indexOf(child);if(-1==oldIndex)throw"Not a child of this container";if(0==child.sortingOrder){var cnt=this._children.length;this._sortingChildCount>0&&index>cnt-this._sortingChildCount-1&&(index=cnt-this._sortingChildCount-1),this._setChildIndex(child,oldIndex,index)}}setChildIndexBefore(child,index){var oldIndex=this._children.indexOf(child);if(-1==oldIndex)throw"Not a child of this container";if(0!=child.sortingOrder)return oldIndex;var cnt=this._children.length;return this._sortingChildCount>0&&index>cnt-this._sortingChildCount-1&&(index=cnt-this._sortingChildCount-1),oldIndex<index?this._setChildIndex(child,oldIndex,index-1):this._setChildIndex(child,oldIndex,index)}_setChildIndex(child,oldIndex,index){var cnt=this._children.length;if(index>cnt&&(index=cnt),oldIndex==index)return oldIndex;if(this._children.splice(oldIndex,1),this._children.splice(index,0,child),child.inContainer){var i,displayIndex=0;if(this._childrenRenderOrder==fgui.ChildrenRenderOrder.Ascent){for(i=0;i<index;i++)this._children[i].inContainer&&displayIndex++;displayIndex==this._container.numChildren&&displayIndex--,this._container.setChildIndex(child.displayObject,displayIndex)}else if(this._childrenRenderOrder==fgui.ChildrenRenderOrder.Descent){for(i=cnt-1;i>index;i--)this._children[i].inContainer&&displayIndex++;displayIndex==this._container.numChildren&&displayIndex--,this._container.setChildIndex(child.displayObject,displayIndex)}else Laya.timer.callLater(this,this.buildNativeDisplayList);this.setBoundsChangedFlag()}return index}swapChildren(child1,child2){var index1=this._children.indexOf(child1),index2=this._children.indexOf(child2);if(-1==index1||-1==index2)throw"Not a child of this container";this.swapChildrenAt(index1,index2)}swapChildrenAt(index1,index2){var child1=this._children[index1],child2=this._children[index2];this.setChildIndex(child1,index2),this.setChildIndex(child2,index1)}get numChildren(){return this._children.length}isAncestorOf(child){if(null==child)return!1;for(var p=child.parent;p;){if(p==this)return!0;p=p.parent}return!1}addController(controller){this._controllers.push(controller),controller.parent=this,this.applyController(controller)}getControllerAt(index){return this._controllers[index]}getController(name){for(var cnt=this._controllers.length,i=0;i<cnt;++i){var c=this._controllers[i];if(c.name==name)return c}return null}removeController(c){var index=this._controllers.indexOf(c);if(-1==index)throw new Error("controller not exists");c.parent=null,this._controllers.splice(index,1);for(var length=this._children.length,i=0;i<length;i++)this._children[i].handleControllerChanged(c)}get controllers(){return this._controllers}childStateChanged(child){if(!this._buildingDisplayList){var cnt=this._children.length;if(child instanceof fgui.GGroup)for(var i=0;i<cnt;i++){var g=this._children[i];g.group==child&&this.childStateChanged(g)}else if(child.displayObject)if(child.internalVisible&&child.displayObject!=this._displayObject.mask){if(!child.displayObject.parent){var index=0;if(this._childrenRenderOrder==fgui.ChildrenRenderOrder.Ascent){for(i=0;i<cnt&&(g=this._children[i])!=child;i++)null!=g.displayObject&&null!=g.displayObject.parent&&index++;this._container.addChildAt(child.displayObject,index)}else if(this._childrenRenderOrder==fgui.ChildrenRenderOrder.Descent){for(i=cnt-1;i>=0&&(g=this._children[i])!=child;i--)null!=g.displayObject&&null!=g.displayObject.parent&&index++;this._container.addChildAt(child.displayObject,index)}else this._container.addChild(child.displayObject),Laya.timer.callLater(this,this.buildNativeDisplayList)}}else child.displayObject.parent&&(this._container.removeChild(child.displayObject),this._childrenRenderOrder==fgui.ChildrenRenderOrder.Arch&&Laya.timer.callLater(this,this.buildNativeDisplayList))}}buildNativeDisplayList(){if(this._displayObject){var i,child,cnt=this._children.length;if(0!=cnt)switch(this._childrenRenderOrder){case fgui.ChildrenRenderOrder.Ascent:for(i=0;i<cnt;i++)null!=(child=this._children[i]).displayObject&&child.internalVisible&&this._container.addChild(child.displayObject);break;case fgui.ChildrenRenderOrder.Descent:for(i=cnt-1;i>=0;i--)null!=(child=this._children[i]).displayObject&&child.internalVisible&&this._container.addChild(child.displayObject);break;case fgui.ChildrenRenderOrder.Arch:for(i=0;i<this._apexIndex;i++)null!=(child=this._children[i]).displayObject&&child.internalVisible&&this._container.addChild(child.displayObject);for(i=cnt-1;i>=this._apexIndex;i--)null!=(child=this._children[i]).displayObject&&child.internalVisible&&this._container.addChild(child.displayObject)}}}applyController(c){this._applyingController=c;for(var length=this._children.length,i=0;i<length;i++)this._children[i].handleControllerChanged(c);this._applyingController=null,c.runActions()}applyAllControllers(){for(var cnt=this._controllers.length,i=0;i<cnt;++i)this.applyController(this._controllers[i])}adjustRadioGroupDepth(obj,c){var i,child,cnt=this._children.length,myIndex=-1,maxIndex=-1;for(i=0;i<cnt;i++)(child=this._children[i])==obj?myIndex=i:child instanceof fgui.GButton&&child.relatedController==c&&i>maxIndex&&(maxIndex=i);myIndex<maxIndex&&(null!=this._applyingController&&this._children[maxIndex].handleControllerChanged(this._applyingController),this.swapChildrenAt(myIndex,maxIndex))}getTransitionAt(index){return this._transitions[index]}getTransition(transName){for(var cnt=this._transitions.length,i=0;i<cnt;++i){var trans=this._transitions[i];if(trans.name==transName)return trans}return null}isChildInView(child){return null!=this._displayObject.scrollRect?child.x+child.width>=0&&child.x<=this.width&&child.y+child.height>=0&&child.y<=this.height:null==this._scrollPane||this._scrollPane.isChildInView(child)}getFirstChildInView(){for(var cnt=this._children.length,i=0;i<cnt;++i){var child=this._children[i];if(this.isChildInView(child))return i}return-1}get scrollPane(){return this._scrollPane}get opaque(){return this._opaque}set opaque(value){this._opaque!=value&&(this._opaque=value,this._opaque?(null==this._displayObject.hitArea&&(this._displayObject.hitArea=new Laya.Rectangle),this._displayObject.hitArea instanceof Laya.Rectangle&&this._displayObject.hitArea.setTo(0,0,this.width,this.height),this._displayObject.mouseThrough=!1):(this._displayObject.hitArea instanceof Laya.Rectangle&&(this._displayObject.hitArea=null),this._displayObject.mouseThrough=!0))}get margin(){return this._margin}set margin(value){this._margin.copy(value),null!=this._displayObject.scrollRect&&this._container.pos(this._margin.left+this._alignOffset.x,this._margin.top+this._alignOffset.y),this.handleSizeChanged()}get childrenRenderOrder(){return this._childrenRenderOrder}set childrenRenderOrder(value){this._childrenRenderOrder!=value&&(this._childrenRenderOrder=value,this.buildNativeDisplayList())}get apexIndex(){return this._apexIndex}set apexIndex(value){this._apexIndex!=value&&(this._apexIndex=value,this._childrenRenderOrder==fgui.ChildrenRenderOrder.Arch&&this.buildNativeDisplayList())}get mask(){return this._mask}set mask(value){this.setMask(value,!1)}setMask(value,reversed){if(this._mask&&this._mask!=value&&"destination-out"==this._mask.blendMode&&(this._mask.blendMode=null),this._mask=value,!this._mask)return this._displayObject.mask=null,void(this._displayObject.hitArea instanceof fgui.ChildHitArea&&(this._displayObject.hitArea=null));this._mask.hitArea&&(this._displayObject.hitArea=new fgui.ChildHitArea(this._mask,reversed),this._displayObject.mouseThrough=!1,this._displayObject.hitTestPrior=!0),reversed?(this._displayObject.mask=null,this._displayObject.cacheAs="bitmap",this._mask.blendMode="destination-out"):this._displayObject.mask=this._mask}get baseUserData(){var buffer=this.packageItem.rawData;return buffer.seek(0,4),buffer.readS()}updateHitArea(){if(this._displayObject.hitArea instanceof fgui.PixelHitTest){var hitTest=this._displayObject.hitArea;0!=this.sourceWidth&&(hitTest.scaleX=this.width/this.sourceWidth),0!=this.sourceHeight&&(hitTest.scaleY=this.height/this.sourceHeight)}else this._displayObject.hitArea instanceof Laya.Rectangle&&this._displayObject.hitArea.setTo(0,0,this.width,this.height)}updateMask(){var rect=this._displayObject.scrollRect;null==rect&&(rect=new Laya.Rectangle),rect.x=this._margin.left,rect.y=this._margin.top,rect.width=this.width-this._margin.right,rect.height=this.height-this._margin.bottom,this._displayObject.scrollRect=rect}setupScroll(buffer){this._displayObject==this._container&&(this._container=new Laya.Sprite,this._displayObject.addChild(this._container)),this._scrollPane=new fgui.ScrollPane(this),this._scrollPane.setup(buffer)}setupOverflow(overflow){overflow==fgui.OverflowType.Hidden?(this._displayObject==this._container&&(this._container=new Laya.Sprite,this._displayObject.addChild(this._container)),this.updateMask(),this._container.pos(this._margin.left,this._margin.top)):0==this._margin.left&&0==this._margin.top||(this._displayObject==this._container&&(this._container=new Laya.Sprite,this._displayObject.addChild(this._container)),this._container.pos(this._margin.left,this._margin.top))}handleSizeChanged(){super.handleSizeChanged(),this._scrollPane?this._scrollPane.onOwnerSizeChanged():null!=this._displayObject.scrollRect&&this.updateMask(),null!=this._displayObject.hitArea&&this.updateHitArea()}handleGrayedChanged(){var c=this.getController("grayed");if(null==c)for(var v=this.grayed,cnt=this._children.length,i=0;i<cnt;++i)this._children[i].grayed=v;else c.selectedIndex=this.grayed?1:0}handleControllerChanged(c){super.handleControllerChanged(c),null!=this._scrollPane&&this._scrollPane.handleControllerChanged(c)}setBoundsChangedFlag(){(this._scrollPane||this._trackBounds)&&(this._boundsChanged||(this._boundsChanged=!0,Laya.timer.callLater(this,this.__render)))}__render(){if(this._boundsChanged){var i1=0,len=this._children.length;for(i1=0;i1<len;i1++)this._children[i1].ensureSizeCorrect();this.updateBounds()}}ensureBoundsCorrect(){var i1=0,len=this._children.length;for(i1=0;i1<len;i1++)this._children[i1].ensureSizeCorrect();this._boundsChanged&&this.updateBounds()}updateBounds(){var ax=0,ay=0,aw=0,ah=0,len=this._children.length;if(len>0){ax=Number.POSITIVE_INFINITY,ay=Number.POSITIVE_INFINITY;var ar=Number.NEGATIVE_INFINITY,ab=Number.NEGATIVE_INFINITY,tmp=0,i1=0;for(i1=0;i1<len;i1++){var child=this._children[i1];(tmp=child.x)<ax&&(ax=tmp),(tmp=child.y)<ay&&(ay=tmp),(tmp=child.x+child.actualWidth)>ar&&(ar=tmp),(tmp=child.y+child.actualHeight)>ab&&(ab=tmp)}aw=ar-ax,ah=ab-ay}this.setBounds(ax,ay,aw,ah)}setBounds(ax,ay,aw,ah){this._boundsChanged=!1,this._scrollPane&&this._scrollPane.setContentSize(Math.round(ax+aw),Math.round(ay+ah))}get viewWidth(){return null!=this._scrollPane?this._scrollPane.viewWidth:this.width-this._margin.left-this._margin.right}set viewWidth(value){null!=this._scrollPane?this._scrollPane.viewWidth=value:this.width=value+this._margin.left+this._margin.right}get viewHeight(){return null!=this._scrollPane?this._scrollPane.viewHeight:this.height-this._margin.top-this._margin.bottom}set viewHeight(value){null!=this._scrollPane?this._scrollPane.viewHeight=value:this.height=value+this._margin.top+this._margin.bottom}getSnappingPosition(xValue,yValue,resultPoint=null){return this.getSnappingPositionWithDir(xValue,yValue,0,0,resultPoint)}getSnappingPositionWithDir(xValue,yValue,xDir,yDir,resultPoint=null){resultPoint||(resultPoint=new Laya.Point);var cnt=this._children.length;if(0==cnt)return resultPoint.x=0,resultPoint.y=0,resultPoint;this.ensureBoundsCorrect();var obj=null,prev=null,i=0;if(0!=yValue){for(;i<cnt;i++)if(yValue<(obj=this._children[i]).y){if(0==i){yValue=0;break}yValue=yValue<(prev=this._children[i-1]).y+prev.actualHeight/2?prev.y:obj.y;break}i==cnt&&(yValue=obj.y)}if(0!=xValue){for(i>0&&i--;i<cnt;i++)if(xValue<(obj=this._children[i]).x){if(0==i){xValue=0;break}xValue=xValue<(prev=this._children[i-1]).x+prev.actualWidth/2?prev.x:obj.x;break}i==cnt&&(xValue=obj.x)}return resultPoint.x=xValue,resultPoint.y=yValue,resultPoint}childSortingOrderChanged(child,oldValue,newValue=0){if(0==newValue)this._sortingChildCount--,this.setChildIndex(child,this._children.length);else{0==oldValue&&this._sortingChildCount++;var oldIndex=this._children.indexOf(child),index=this.getInsertPosForSortingChild(child);oldIndex<index?this._setChildIndex(child,oldIndex,index-1):this._setChildIndex(child,oldIndex,index)}}constructFromResource(){this.constructFromResource2(null,0)}constructFromResource2(objectPool,poolIndex){var i,dataLen,curPos,nextPos,f1,f2,i1,i2;this.packageItem.decoded||(this.packageItem.decoded=!0,fgui.TranslationHelper.translateComponent(this.packageItem));var buffer=this.packageItem.rawData;buffer.seek(0,0),this._underConstruct=!0,this.sourceWidth=buffer.getInt32(),this.sourceHeight=buffer.getInt32(),this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),buffer.readBool()&&(this.minWidth=buffer.getInt32(),this.maxWidth=buffer.getInt32(),this.minHeight=buffer.getInt32(),this.maxHeight=buffer.getInt32()),buffer.readBool()&&(f1=buffer.getFloat32(),f2=buffer.getFloat32(),this.internalSetPivot(f1,f2,buffer.readBool())),buffer.readBool()&&(this._margin.top=buffer.getInt32(),this._margin.bottom=buffer.getInt32(),this._margin.left=buffer.getInt32(),this._margin.right=buffer.getInt32());var overflow=buffer.readByte();if(overflow==fgui.OverflowType.Scroll){var savedPos=buffer.pos;buffer.seek(0,7),this.setupScroll(buffer),buffer.pos=savedPos}else this.setupOverflow(overflow);buffer.readBool()&&buffer.skip(8),this._buildingDisplayList=!0,buffer.seek(0,1);var child,controllerCount=buffer.getInt16();for(i=0;i<controllerCount;i++){nextPos=buffer.getInt16(),nextPos+=buffer.pos;var controller=new fgui.Controller;this._controllers.push(controller),controller.parent=this,controller.setup(buffer),buffer.pos=nextPos}buffer.seek(0,2);var childCount=buffer.getInt16();for(i=0;i<childCount;i++){if(dataLen=buffer.getInt16(),curPos=buffer.pos,null!=objectPool)child=objectPool[poolIndex+i];else{buffer.seek(curPos,0);var pkg,type=buffer.readByte(),src=buffer.readS(),pkgId=buffer.readS(),pi=null;null!=src&&(pi=null!=(pkg=null!=pkgId?fgui.UIPackage.getById(pkgId):this.packageItem.owner)?pkg.getItemById(src):null),null!=pi?((child=fgui.UIObjectFactory.newObject(pi)).packageItem=pi,child.constructFromResource()):child=fgui.UIObjectFactory.newObject2(type)}child._underConstruct=!0,child.setup_beforeAdd(buffer,curPos),child.parent=this,this._children.push(child),buffer.pos=curPos+dataLen}for(buffer.seek(0,3),this.relations.setup(buffer,!0),buffer.seek(0,2),buffer.skip(2),i=0;i<childCount;i++)nextPos=buffer.getInt16(),nextPos+=buffer.pos,buffer.seek(buffer.pos,3),this._children[i].relations.setup(buffer,!1),buffer.pos=nextPos;for(buffer.seek(0,2),buffer.skip(2),i=0;i<childCount;i++)nextPos=buffer.getInt16(),nextPos+=buffer.pos,(child=this._children[i]).setup_afterAdd(buffer,buffer.pos),child._underConstruct=!1,buffer.pos=nextPos;buffer.seek(0,4),buffer.skip(2),this.opaque=buffer.readBool();var maskId=buffer.getInt16();-1!=maskId&&this.setMask(this.getChildAt(maskId).displayObject,buffer.readBool());var hitTestId=buffer.readS();null!=hitTestId&&null!=(pi=this.packageItem.owner.getItemById(hitTestId))&&null!=pi.pixelHitTestData&&(i1=buffer.getInt32(),i2=buffer.getInt32(),this._displayObject.hitArea=new fgui.PixelHitTest(pi.pixelHitTestData,i1,i2),this._displayObject.mouseThrough=!1,this._displayObject.hitTestPrior=!0),buffer.seek(0,5);var transitionCount=buffer.getInt16();for(i=0;i<transitionCount;i++){nextPos=buffer.getInt16(),nextPos+=buffer.pos;var trans=new fgui.Transition(this);trans.setup(buffer),this._transitions.push(trans),buffer.pos=nextPos}this._transitions.length>0&&(this.displayObject.on(Laya.Event.DISPLAY,this,this.___added),this.displayObject.on(Laya.Event.UNDISPLAY,this,this.___removed)),this.applyAllControllers(),this._buildingDisplayList=!1,this._underConstruct=!1,this.buildNativeDisplayList(),this.setBoundsChangedFlag(),this.packageItem.objectType!=fgui.ObjectType.Component&&this.constructExtension(buffer),this.constructFromXML(null)}constructExtension(buffer){}constructFromXML(xml){}setup_afterAdd(buffer,beginPos){super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,4);var pageController=buffer.getInt16();-1!=pageController&&null!=this._scrollPane&&(this._scrollPane.pageController=this._parent.getControllerAt(pageController));for(var cnt=buffer.getInt16(),i=0;i<cnt;i++){var cc=this.getController(buffer.readS()),pageId=buffer.readS();cc&&(cc.selectedPageId=pageId)}}___added(){for(var cnt=this._transitions.length,i=0;i<cnt;++i)this._transitions[i].onOwnerAddedToStage()}___removed(){for(var cnt=this._transitions.length,i=0;i<cnt;++i)this._transitions[i].onOwnerRemovedFromStage()}}}(fgui||(fgui={})),function(fgui){class GButton extends fgui.GComponent{constructor(){super(),this._soundVolumeScale=0,this._downEffect=0,this._downEffectValue=0,this._downScaled=!1,this._mode=fgui.ButtonMode.Common,this._title="",this._icon="",this._sound=fgui.UIConfig.buttonSound,this._soundVolumeScale=fgui.UIConfig.buttonSoundVolumeScale,this._changeStateOnClick=!0,this._downEffectValue=.8}get icon(){return this._icon}set icon(value){this._icon=value,value=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,null!=this._iconObject&&(this._iconObject.icon=value),this.updateGear(7)}get selectedIcon(){return this._selectedIcon}set selectedIcon(value){this._selectedIcon=value,value=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,null!=this._iconObject&&(this._iconObject.icon=value)}get title(){return this._title}set title(value){this._title=value,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title),this.updateGear(6)}get text(){return this.title}set text(value){this.title=value}get selectedTitle(){return this._selectedTitle}set selectedTitle(value){this._selectedTitle=value,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title)}get titleColor(){var tf=this.getTextField();return null!=tf?tf.color:"#000000"}set titleColor(value){var tf=this.getTextField();null!=tf&&(tf.color=value),this.updateGear(4)}get titleFontSize(){var tf=this.getTextField();return null!=tf?tf.fontSize:0}set titleFontSize(value){var tf=this.getTextField();null!=tf&&(tf.fontSize=value)}get sound(){return this._sound}set sound(val){this._sound=val}get soundVolumeScale(){return this._soundVolumeScale}set soundVolumeScale(value){this._soundVolumeScale=value}set selected(val){if(this._mode!=fgui.ButtonMode.Common&&this._selected!=val){if(this._selected=val,this.grayed&&this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this._selected?this.setState(GButton.SELECTED_DISABLED):this.setState(GButton.DISABLED):this._selected?this.setState(this._over?GButton.SELECTED_OVER:GButton.DOWN):this.setState(this._over?GButton.OVER:GButton.UP),this._selectedTitle&&this._titleObject&&(this._titleObject.text=this._selected?this._selectedTitle:this._title),this._selectedIcon){var str=this._selected?this._selectedIcon:this._icon;null!=this._iconObject&&(this._iconObject.icon=str)}this._relatedController&&this._parent&&!this._parent._buildingDisplayList&&(this._selected?(this._relatedController.selectedPageId=this._relatedPageId,this._relatedController.autoRadioGroupDepth&&this._parent.adjustRadioGroupDepth(this,this._relatedController)):this._mode==fgui.ButtonMode.Check&&this._relatedController.selectedPageId==this._relatedPageId&&(this._relatedController.oppositePageId=this._relatedPageId))}}get selected(){return this._selected}get mode(){return this._mode}set mode(value){this._mode!=value&&(value==fgui.ButtonMode.Common&&(this.selected=!1),this._mode=value)}get relatedController(){return this._relatedController}set relatedController(val){val!=this._relatedController&&(this._relatedController=val,this._relatedPageId=null)}get relatedPageId(){return this._relatedPageId}set relatedPageId(val){this._relatedPageId=val}get changeStateOnClick(){return this._changeStateOnClick}set changeStateOnClick(value){this._changeStateOnClick=value}get linkedPopup(){return this._linkedPopup}set linkedPopup(value){this._linkedPopup=value}getTextField(){return this._titleObject instanceof fgui.GTextField?this._titleObject:this._titleObject instanceof fgui.GLabel?this._titleObject.getTextField():this._titleObject instanceof GButton?this._titleObject.getTextField():null}fireClick(downEffect=!0){downEffect&&this._mode==fgui.ButtonMode.Common&&(this.setState(GButton.OVER),Laya.timer.once(100,this,this.setState,[GButton.DOWN],!1),Laya.timer.once(200,this,this.setState,[GButton.UP],!1)),this.__click(fgui.Events.createEvent(Laya.Event.CLICK,this.displayObject))}setState(val){if(this._buttonController&&(this._buttonController.selectedPage=val),1==this._downEffect){var cnt=this.numChildren;if(val==GButton.DOWN||val==GButton.SELECTED_OVER||val==GButton.SELECTED_DISABLED)for(var r=255*this._downEffectValue,color=Laya.Utils.toHexColor((r<<16)+(r<<8)+r),i=0;i<cnt;i++){var obj=this.getChildAt(i);(obj instanceof fgui.GImage||obj instanceof fgui.GLoader||obj instanceof fgui.GMovieClip)&&(obj.color=color)}else for(i=0;i<cnt;i++)((obj=this.getChildAt(i))instanceof fgui.GImage||obj instanceof fgui.GLoader||obj instanceof fgui.GMovieClip)&&(obj.color="#FFFFFF")}else 2==this._downEffect&&(val==GButton.DOWN||val==GButton.SELECTED_OVER||val==GButton.SELECTED_DISABLED?this._downScaled||(this.setScale(this.scaleX*this._downEffectValue,this.scaleY*this._downEffectValue),this._downScaled=!0):this._downScaled&&(this.setScale(this.scaleX/this._downEffectValue,this.scaleY/this._downEffectValue),this._downScaled=!1))}handleControllerChanged(c){super.handleControllerChanged(c),this._relatedController==c&&(this.selected=this._relatedPageId==c.selectedPageId)}handleGrayedChanged(){this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this.grayed?this._selected&&this._buttonController.hasPage(GButton.SELECTED_DISABLED)?this.setState(GButton.SELECTED_DISABLED):this.setState(GButton.DISABLED):this._selected?this.setState(GButton.DOWN):this.setState(GButton.UP):super.handleGrayedChanged()}getProp(index){switch(index){case fgui.ObjectPropID.Color:return this.titleColor;case fgui.ObjectPropID.OutlineColor:var tf=this.getTextField();return tf?tf.strokeColor:0;case fgui.ObjectPropID.FontSize:return this.titleFontSize;case fgui.ObjectPropID.Selected:return this.selected;default:return super.getProp(index)}}setProp(index,value){switch(index){case fgui.ObjectPropID.Color:this.titleColor=value;break;case fgui.ObjectPropID.OutlineColor:var tf=this.getTextField();tf&&(tf.strokeColor=value);break;case fgui.ObjectPropID.FontSize:this.titleFontSize=value;break;case fgui.ObjectPropID.Selected:this.selected=value;break;default:super.setProp(index,value)}}constructExtension(buffer){buffer.seek(0,6),this._mode=buffer.readByte();var str=buffer.readS();str&&(this._sound=str),this._soundVolumeScale=buffer.getFloat32(),this._downEffect=buffer.readByte(),this._downEffectValue=buffer.getFloat32(),2==this._downEffect&&this.setPivot(.5,.5,this.pivotAsAnchor),this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),null!=this._titleObject&&(this._title=this._titleObject.text),null!=this._iconObject&&(this._icon=this._iconObject.icon),this._mode==fgui.ButtonMode.Common&&this.setState(GButton.UP),this.on(Laya.Event.ROLL_OVER,this,this.__rollover),this.on(Laya.Event.ROLL_OUT,this,this.__rollout),this.on(Laya.Event.MOUSE_DOWN,this,this.__mousedown),this.on(Laya.Event.CLICK,this,this.__click)}setup_afterAdd(buffer,beginPos){var str,iv;(super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6))&&(buffer.readByte()==this.packageItem.objectType&&(null!=(str=buffer.readS())&&(this.title=str),null!=(str=buffer.readS())&&(this.selectedTitle=str),null!=(str=buffer.readS())&&(this.icon=str),null!=(str=buffer.readS())&&(this.selectedIcon=str),buffer.readBool()&&(this.titleColor=buffer.readColorS()),0!=(iv=buffer.getInt32())&&(this.titleFontSize=iv),(iv=buffer.getInt16())>=0&&(this._relatedController=this.parent.getControllerAt(iv)),this._relatedPageId=buffer.readS(),null!=(str=buffer.readS())&&(this._sound=str),buffer.readBool()&&(this._soundVolumeScale=buffer.getFloat32()),this.selected=buffer.readBool()))}__rollover(){this._buttonController&&this._buttonController.hasPage(GButton.OVER)&&(this._over=!0,this._down||this.grayed&&this._buttonController.hasPage(GButton.DISABLED)||this.setState(this._selected?GButton.SELECTED_OVER:GButton.OVER))}__rollout(){this._buttonController&&this._buttonController.hasPage(GButton.OVER)&&(this._over=!1,this._down||this.grayed&&this._buttonController.hasPage(GButton.DISABLED)||this.setState(this._selected?GButton.DOWN:GButton.UP))}__mousedown(evt){this._down=!0,fgui.GRoot.inst.checkPopups(evt.target),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__mouseup),this._mode==fgui.ButtonMode.Common&&(this.grayed&&this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this.setState(GButton.SELECTED_DISABLED):this.setState(GButton.DOWN)),null!=this._linkedPopup&&(this._linkedPopup instanceof fgui.Window?this._linkedPopup.toggleStatus():this.root.togglePopup(this._linkedPopup,this))}__mouseup(){if(this._down){if(Laya.stage.off(Laya.Event.MOUSE_UP,this,this.__mouseup),this._down=!1,null==this._displayObject)return;this._mode==fgui.ButtonMode.Common&&(this.grayed&&this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this.setState(GButton.DISABLED):this._over?this.setState(GButton.OVER):this.setState(GButton.UP))}}__click(evt){if(this._sound){var pi=fgui.UIPackage.getItemByURL(this._sound);pi?fgui.GRoot.inst.playOneShotSound(pi.file):fgui.GRoot.inst.playOneShotSound(this._sound)}this._mode==fgui.ButtonMode.Check?this._changeStateOnClick&&(this.selected=!this._selected,fgui.Events.dispatch(fgui.Events.STATE_CHANGED,this.displayObject,evt)):this._mode==fgui.ButtonMode.Radio?this._changeStateOnClick&&!this._selected&&(this.selected=!0,fgui.Events.dispatch(fgui.Events.STATE_CHANGED,this.displayObject,evt)):this._relatedController&&(this._relatedController.selectedPageId=this._relatedPageId)}}GButton.UP="up",GButton.DOWN="down",GButton.OVER="over",GButton.SELECTED_OVER="selectedOver",GButton.DISABLED="disabled",GButton.SELECTED_DISABLED="selectedDisabled",fgui.GButton=GButton}(fgui||(fgui={})),function(fgui){fgui.GComboBox=class extends fgui.GComponent{constructor(){super(),this._visibleItemCount=fgui.UIConfig.defaultComboBoxVisibleItemCount,this._itemsUpdated=!0,this._selectedIndex=-1,this._popupDirection=0,this._items=[],this._values=[]}get text(){return this._titleObject?this._titleObject.text:null}set text(value){this._titleObject&&(this._titleObject.text=value),this.updateGear(6)}get titleColor(){var tf=this.getTextField();return null!=tf?tf.color:"#000000"}set titleColor(value){var tf=this.getTextField();null!=tf&&(tf.color=value),this.updateGear(4)}get titleFontSize(){var tf=this.getTextField();return null!=tf?tf.fontSize:0}set titleFontSize(value){var tf=this.getTextField();null!=tf&&(tf.fontSize=value)}get icon(){return this._iconObject?this._iconObject.icon:null}set icon(value){this._iconObject&&(this._iconObject.icon=value),this.updateGear(7)}get visibleItemCount(){return this._visibleItemCount}set visibleItemCount(value){this._visibleItemCount=value}get popupDirection(){return this._popupDirection}set popupDirection(value){this._popupDirection=value}get items(){return this._items}set items(value){value?this._items=value.concat():this._items.length=0,this._items.length>0?(this._selectedIndex>=this._items.length?this._selectedIndex=this._items.length-1:-1==this._selectedIndex&&(this._selectedIndex=0),this.text=this._items[this._selectedIndex],null!=this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",null!=this._icons&&(this.icon=null),this._selectedIndex=-1),this._itemsUpdated=!0}get icons(){return this._icons}set icons(value){this._icons=value,null!=this._icons&&-1!=this._selectedIndex&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])}get values(){return this._values}set values(value){value?this._values=value.concat():this._values.length=0}get selectedIndex(){return this._selectedIndex}set selectedIndex(val){this._selectedIndex!=val&&(this._selectedIndex=val,this._selectedIndex>=0&&this._selectedIndex<this._items.length?(this.text=this._items[this._selectedIndex],null!=this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",null!=this._icons&&(this.icon=null)),this.updateSelectionController())}get value(){return this._values[this._selectedIndex]}set value(val){this.selectedIndex=this._values.indexOf(val)}getTextField(){return this._titleObject instanceof fgui.GTextField?this._titleObject:this._titleObject instanceof fgui.GLabel?this._titleObject.getTextField():this._titleObject instanceof fgui.GButton?this._titleObject.getTextField():null}setState(val){this._buttonController&&(this._buttonController.selectedPage=val)}get selectionController(){return this._selectionController}set selectionController(value){this._selectionController=value}handleControllerChanged(c){super.handleControllerChanged(c),this._selectionController==c&&(this.selectedIndex=c.selectedIndex)}updateSelectionController(){if(null!=this._selectionController&&!this._selectionController.changing&&this._selectedIndex<this._selectionController.pageCount){var c=this._selectionController;this._selectionController=null,c.selectedIndex=this._selectedIndex,this._selectionController=c}}dispose(){this.dropdown&&(this.dropdown.dispose(),this.dropdown=null),this._selectionController=null,super.dispose()}getProp(index){switch(index){case fgui.ObjectPropID.Color:return this.titleColor;case fgui.ObjectPropID.OutlineColor:var tf=this.getTextField();return tf?tf.strokeColor:0;case fgui.ObjectPropID.FontSize:return(tf=this.getTextField())?tf.fontSize:0;default:return super.getProp(index)}}setProp(index,value){switch(index){case fgui.ObjectPropID.Color:this.titleColor=value;break;case fgui.ObjectPropID.OutlineColor:var tf=this.getTextField();tf&&(tf.strokeColor=value);break;case fgui.ObjectPropID.FontSize:(tf=this.getTextField())&&(tf.fontSize=value);break;default:super.setProp(index,value)}}constructExtension(buffer){var str;if(this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),str=buffer.readS()){if(this.dropdown=fgui.UIPackage.createObjectFromURL(str),!this.dropdown)return void Laya.Log.print("");if(this.dropdown.name="this._dropdownObject",this._list=this.dropdown.getChild("list").asList,null==this._list)return void Laya.Log.print(this.resourceURL+": list");this._list.on(fgui.Events.CLICK_ITEM,this,this.__clickItem),this._list.addRelation(this.dropdown,fgui.RelationType.Width),this._list.removeRelation(this.dropdown,fgui.RelationType.Height),this.dropdown.addRelation(this._list,fgui.RelationType.Height),this.dropdown.removeRelation(this._list,fgui.RelationType.Width),this.dropdown.displayObject.on(Laya.Event.UNDISPLAY,this,this.__popupWinClosed)}this.on(Laya.Event.ROLL_OVER,this,this.__rollover),this.on(Laya.Event.ROLL_OUT,this,this.__rollout),this.on(Laya.Event.MOUSE_DOWN,this,this.__mousedown)}setup_afterAdd(buffer,beginPos){if(super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6)&&buffer.readByte()==this.packageItem.objectType){var i,iv,nextPos,str,itemCount=buffer.getInt16();for(i=0;i<itemCount;i++)nextPos=buffer.getInt16(),nextPos+=buffer.pos,this._items[i]=buffer.readS(),this._values[i]=buffer.readS(),null!=(str=buffer.readS())&&(null==this._icons&&(this._icons=[]),this._icons[i]=str),buffer.pos=nextPos;null!=(str=buffer.readS())?(this.text=str,this._selectedIndex=this._items.indexOf(str)):this._items.length>0?(this._selectedIndex=0,this.text=this._items[0]):this._selectedIndex=-1,null!=(str=buffer.readS())&&(this.icon=str),buffer.readBool()&&(this.titleColor=buffer.readColorS()),(iv=buffer.getInt32())>0&&(this._visibleItemCount=iv),this._popupDirection=buffer.readByte(),(iv=buffer.getInt16())>=0&&(this._selectionController=this.parent.getControllerAt(iv))}}showDropdown(){if(this._itemsUpdated){this._itemsUpdated=!1,this._list.removeChildrenToPool();for(var cnt=this._items.length,i=0;i<cnt;i++){var item=this._list.addItemFromPool();item.name=i<this._values.length?this._values[i]:"",item.text=this._items[i],item.icon=null!=this._icons&&i<this._icons.length?this._icons[i]:null}this._list.resizeToFit(this._visibleItemCount)}this._list.selectedIndex=-1,this.dropdown.width=this.width;var downward=null;this._popupDirection==fgui.PopupDirection.Down?downward=!0:this._popupDirection==fgui.PopupDirection.Up&&(downward=!1),this.root.togglePopup(this.dropdown,this,downward),this.dropdown.parent&&this.setState(fgui.GButton.DOWN)}__popupWinClosed(){this._over?this.setState(fgui.GButton.OVER):this.setState(fgui.GButton.UP)}__clickItem(itemObject,evt){Laya.timer.callLater(this,this.__clickItem2,[this._list.getChildIndex(itemObject),evt])}__clickItem2(index,evt){this.dropdown.parent instanceof fgui.GRoot&&this.dropdown.parent.hidePopup(),this._selectedIndex=-1,this.selectedIndex=index,fgui.Events.dispatch(fgui.Events.STATE_CHANGED,this.displayObject,evt)}__rollover(){this._over=!0,this._down||this.dropdown&&this.dropdown.parent||this.setState(fgui.GButton.OVER)}__rollout(){this._over=!1,this._down||this.dropdown&&this.dropdown.parent||this.setState(fgui.GButton.UP)}__mousedown(evt){evt.target instanceof Laya.Input||(this._down=!0,fgui.GRoot.inst.checkPopups(evt.target),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__mouseup),this.dropdown&&this.showDropdown())}__mouseup(){this._down&&(this._down=!1,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.__mouseup),this.dropdown&&!this.dropdown.parent&&(this._over?this.setState(fgui.GButton.OVER):this.setState(fgui.GButton.UP)))}}}(fgui||(fgui={})),function(fgui){class GScrollBar extends fgui.GComponent{constructor(){super(),this._scrollPerc=0,this._dragOffset=new Laya.Point,this._scrollPerc=0}setScrollPane(target,vertical){this._target=target,this._vertical=vertical}set displayPerc(val){this._vertical?(this._fixedGripSize||(this._grip.height=val*this._bar.height),this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc):(this._fixedGripSize||(this._grip.width=val*this._bar.width),this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc)}set scrollPerc(val){this._scrollPerc=val,this._vertical?this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc:this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc}get minSize(){return this._vertical?(null!=this._arrowButton1?this._arrowButton1.height:0)+(null!=this._arrowButton2?this._arrowButton2.height:0):(null!=this._arrowButton1?this._arrowButton1.width:0)+(null!=this._arrowButton2?this._arrowButton2.width:0)}constructExtension(buffer){buffer.seek(0,6),this._fixedGripSize=buffer.readBool(),this._grip=this.getChild("grip"),this._grip?(this._bar=this.getChild("bar"),this._bar?(this._arrowButton1=this.getChild("arrow1"),this._arrowButton2=this.getChild("arrow2"),this._grip.on(Laya.Event.MOUSE_DOWN,this,this.__gripMouseDown),this._arrowButton1&&this._arrowButton1.on(Laya.Event.MOUSE_DOWN,this,this.__arrowButton1Click),this._arrowButton2&&this._arrowButton2.on(Laya.Event.MOUSE_DOWN,this,this.__arrowButton2Click),this.on(Laya.Event.MOUSE_DOWN,this,this.__barMouseDown)):Laya.Log.print("bar")):Laya.Log.print("grip")}__gripMouseDown(evt){this._bar&&(evt.stopPropagation(),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.__gripMouseMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__gripMouseUp),this.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,this._dragOffset),this._dragOffset.x-=this._grip.x,this._dragOffset.y-=this._grip.y)}__gripMouseMove(){var pt=this.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,GScrollBar.sScrollbarHelperPoint);if(this._vertical){var curY=pt.y-this._dragOffset.y;this._target.setPercY((curY-this._bar.y)/(this._bar.height-this._grip.height),!1)}else{var curX=pt.x-this._dragOffset.x;this._target.setPercX((curX-this._bar.x)/(this._bar.width-this._grip.width),!1)}}__gripMouseUp(evt){this._bar&&(Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.__gripMouseMove),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.__gripMouseUp))}__arrowButton1Click(evt){evt.stopPropagation(),this._vertical?this._target.scrollUp():this._target.scrollLeft()}__arrowButton2Click(evt){evt.stopPropagation(),this._vertical?this._target.scrollDown():this._target.scrollRight()}__barMouseDown(evt){var pt=this._grip.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,GScrollBar.sScrollbarHelperPoint);this._vertical?pt.y<0?this._target.scrollUp(4):this._target.scrollDown(4):pt.x<0?this._target.scrollLeft(4):this._target.scrollRight(4)}}GScrollBar.sScrollbarHelperPoint=new Laya.Point,fgui.GScrollBar=GScrollBar}(fgui||(fgui={})),function(fgui){class GSlider extends fgui.GComponent{constructor(){super(),this._max=0,this._value=0,this._reverse=!1,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._clickPercent=0,this._barStartX=0,this._barStartY=0,this.changeOnClick=!0,this.canDrag=!0,this._titleType=fgui.ProgressTitleType.Percent,this._value=50,this._max=100,this._clickPos=new Laya.Point}get titleType(){return this._titleType}set titleType(value){this._titleType=value}get max(){return this._max}set max(value){this._max!=value&&(this._max=value,this.update())}get value(){return this._value}set value(value){this._value!=value&&(this._value=value,this.update())}update(){var percent=Math.min(this._value/this._max,1);this.updateWidthPercent(percent)}updateWidthPercent(percent){if(this._titleObject)switch(this._titleType){case fgui.ProgressTitleType.Percent:this._titleObject.text=Math.round(100*percent)+"%";break;case fgui.ProgressTitleType.ValueAndMax:this._titleObject.text=this._value+"/"+this._max;break;case fgui.ProgressTitleType.Value:this._titleObject.text=""+this._value;break;case fgui.ProgressTitleType.Max:this._titleObject.text=""+this._max}var fullWidth=this.width-this._barMaxWidthDelta,fullHeight=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH.width=Math.round(fullWidth*percent),this._barObjectH.x=this._barStartX+(fullWidth-this._barObjectH.width)),this._barObjectV&&(this._barObjectV.height=Math.round(fullHeight*percent),this._barObjectV.y=this._barStartY+(fullHeight-this._barObjectV.height))):(this._barObjectH&&(this._barObjectH.width=Math.round(fullWidth*percent)),this._barObjectV&&(this._barObjectV.height=Math.round(fullHeight*percent)))}constructExtension(buffer){buffer.seek(0,6),this._titleType=buffer.readByte(),this._reverse=buffer.readBool(),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._gripObject=this.getChild("grip"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y),this._gripObject&&this._gripObject.on(Laya.Event.MOUSE_DOWN,this,this.__gripMouseDown),this.displayObject.on(Laya.Event.MOUSE_DOWN,this,this.__barMouseDown)}handleSizeChanged(){super.handleSizeChanged(),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update()}setup_afterAdd(buffer,beginPos){super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6)&&buffer.readByte()==this.packageItem.objectType?(this._value=buffer.getInt32(),this._max=buffer.getInt32(),this.update()):this.update()}__gripMouseDown(evt){this.canDrag=!0,evt.stopPropagation(),this._clickPos=this.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY),this._clickPercent=this._value/this._max,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.__gripMouseMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__gripMouseUp)}__gripMouseMove(evt){if(this.canDrag){var percent,pt=this.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,GSlider.sSilderHelperPoint),deltaX=pt.x-this._clickPos.x,deltaY=pt.y-this._clickPos.y;this._reverse&&(deltaX=-deltaX,deltaY=-deltaY),(percent=this._barObjectH?this._clickPercent+deltaX/this._barMaxWidth:this._clickPercent+deltaY/this._barMaxHeight)>1?percent=1:percent<0&&(percent=0);var newValue=Math.round(this._max*percent);newValue!=this._value&&(this._value=newValue,fgui.Events.dispatch(fgui.Events.STATE_CHANGED,this.displayObject,evt)),this.updateWidthPercent(percent)}}__gripMouseUp(evt){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.__gripMouseMove),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.__gripMouseUp)}__barMouseDown(evt){if(this.changeOnClick){var delta,pt=this._gripObject.globalToLocal(evt.stageX,evt.stageY,GSlider.sSilderHelperPoint),percent=this._value/this._max;this._barObjectH&&(delta=(pt.x-this._gripObject.width/2)/this._barMaxWidth),this._barObjectV&&(delta=(pt.y-this._gripObject.height/2)/this._barMaxHeight),this._reverse?percent-=delta:percent+=delta,percent>1?percent=1:percent<0&&(percent=0);var newValue=Math.round(this._max*percent);newValue!=this._value&&(this._value=newValue,fgui.Events.dispatch(fgui.Events.STATE_CHANGED,this.displayObject,evt)),this.updateWidthPercent(percent)}}}GSlider.sSilderHelperPoint=new Laya.Point,fgui.GSlider=GSlider}(fgui||(fgui={})),function(fgui){fgui.GGraph=class extends fgui.GObject{constructor(){super(),this._type=0,this._lineSize=1,this._lineColor="#000000",this._fillColor="#FFFFFF",this._cornerRadius=null}drawRect(lineSize,lineColor,fillColor,cornerRadius=null){this._type=1,this._lineSize=lineSize,this._lineColor=lineColor,this._fillColor=fillColor,this._cornerRadius=cornerRadius,this.drawCommon()}drawEllipse(lineSize,lineColor,fillColor){this._type=2,this._lineSize=lineSize,this._lineColor=lineColor,this._fillColor=fillColor,this.drawCommon()}get color(){return this._fillColor}set color(value){this._fillColor=value,0!=this._type&&this.drawCommon()}drawCommon(){this._displayObject.mouseEnabled=this.touchable;var gr=this._displayObject.graphics;gr.clear();var w=this.width,h=this.height;if(0!=w&&0!=h){var fillColor=this._fillColor,lineColor=this._lineColor;if(fgui.ToolSet.startsWith(fillColor,"rgba")){var arr=fillColor.substring(5,fillColor.lastIndexOf(")")).split(","),a=parseFloat(arr[3]);0==a?fillColor=null:(fillColor=Laya.Utils.toHexColor((parseInt(arr[0])<<16)+(parseInt(arr[1])<<8)+parseInt(arr[2])),this.alpha=a)}if(1==this._type)if(null!=this._cornerRadius){var paths=[["moveTo",this._cornerRadius[0],0],["lineTo",w-this._cornerRadius[1],0],["arcTo",w,0,w,this._cornerRadius[1],this._cornerRadius[1]],["lineTo",w,h-this._cornerRadius[3]],["arcTo",w,h,w-this._cornerRadius[3],h,this._cornerRadius[3]],["lineTo",this._cornerRadius[2],h],["arcTo",0,h,0,h-this._cornerRadius[2],this._cornerRadius[2]],["lineTo",0,this._cornerRadius[0]],["arcTo",0,0,this._cornerRadius[0],0,this._cornerRadius[0]],["closePath"]];gr.drawPath(0,0,paths,{fillStyle:fillColor},this._lineSize>0?{strokeStyle:lineColor,lineWidth:this._lineSize}:null)}else gr.drawRect(0,0,w,h,fillColor,this._lineSize>0?lineColor:null,this._lineSize);else gr.drawCircle(w/2,h/2,w/2,fillColor,this._lineSize>0?lineColor:null,this._lineSize);this._displayObject.repaint()}}replaceMe(target){if(!this._parent)throw"parent not set";target.name=this.name,target.alpha=this.alpha,target.rotation=this.rotation,target.visible=this.visible,target.touchable=this.touchable,target.grayed=this.grayed,target.setXY(this.x,this.y),target.setSize(this.width,this.height);var index=this._parent.getChildIndex(this);this._parent.addChildAt(target,index),target.relations.copyFrom(this.relations),this._parent.removeChild(this,!0)}addBeforeMe(target){if(null==this._parent)throw"parent not set";var index=this._parent.getChildIndex(this);this._parent.addChildAt(target,index)}addAfterMe(target){if(null==this._parent)throw"parent not set";var index=this._parent.getChildIndex(this);index++,this._parent.addChildAt(target,index)}setNativeObject(obj){this._type=0,this._displayObject.mouseEnabled=this.touchable,this._displayObject.graphics.clear(),this._displayObject.addChild(obj)}createDisplayObject(){super.createDisplayObject(),this._displayObject.mouseEnabled=!1,this._hitArea=new Laya.HitArea,this._hitArea.hit=this._displayObject.graphics,this._displayObject.hitArea=this._hitArea}getProp(index){return index==fgui.ObjectPropID.Color?this.color:super.getProp(index)}setProp(index,value){index==fgui.ObjectPropID.Color?this.color=value:super.setProp(index,value)}handleSizeChanged(){super.handleSizeChanged(),0!=this._type&&this.drawCommon()}setup_beforeAdd(buffer,beginPos){if(super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),this._type=buffer.readByte(),0!=this._type){if(this._lineSize=buffer.getInt32(),this._lineColor=buffer.readColorS(!0),this._fillColor=buffer.readColorS(!0),buffer.readBool()){this._cornerRadius=[];for(var i=0;i<4;i++)this._cornerRadius[i]=buffer.getFloat32()}this.drawCommon()}}}}(fgui||(fgui={})),function(fgui){fgui.GGroup=class extends fgui.GObject{constructor(){super()}get layout(){return this._layout}set layout(value){this._layout!=value&&(this._layout=value,this.setBoundsChangedFlag(!0))}get lineGap(){return this._lineGap}set lineGap(value){this._lineGap!=value&&(this._lineGap=value,this.setBoundsChangedFlag())}get columnGap(){return this._columnGap}set columnGap(value){this._columnGap!=value&&(this._columnGap=value,this.setBoundsChangedFlag())}setBoundsChangedFlag(childSizeChanged=!1){0==this._updating&&null!=this._parent&&(childSizeChanged&&(this._percentReady=!1),this._boundsChanged||(this._boundsChanged=!0,this._layout!=fgui.GroupLayoutType.None&&Laya.timer.callLater(this,this.ensureBoundsCorrect)))}ensureBoundsCorrect(){this._boundsChanged&&this.updateBounds()}updateBounds(){if(Laya.timer.clear(this,this.ensureBoundsCorrect),this._boundsChanged=!1,null!=parent){this.handleLayout();var i,child,tmp,cnt=this._parent.numChildren,ax=Number.POSITIVE_INFINITY,ay=Number.POSITIVE_INFINITY,ar=Number.NEGATIVE_INFINITY,ab=Number.NEGATIVE_INFINITY,empty=!0;for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&((tmp=child.x)<ax&&(ax=tmp),(tmp=child.y)<ay&&(ay=tmp),(tmp=child.x+child.width)>ar&&(ar=tmp),(tmp=child.y+child.height)>ab&&(ab=tmp),empty=!1);empty?(this._updating=2,this.setSize(0,0)):(this._updating=1,this.setXY(ax,ay),this._updating=2,this.setSize(ar-ax,ab-ay)),this._updating=0}}handleLayout(){var child,i,cnt;if(this._updating|=1,this._layout==fgui.GroupLayoutType.Horizontal){var curX=NaN;for(cnt=this._parent.numChildren,i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(isNaN(curX)?curX=Math.floor(child.x):child.x=curX,0!=child.width&&(curX+=Math.floor(child.width+this._columnGap)));this._percentReady||this.updatePercent()}else if(this._layout==fgui.GroupLayoutType.Vertical){var curY=NaN;for(cnt=this._parent.numChildren,i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(isNaN(curY)?curY=Math.floor(child.y):child.y=curY,0!=child.height&&(curY+=Math.floor(child.height+this._lineGap)));this._percentReady||this.updatePercent()}this._updating&=2}updatePercent(){this._percentReady=!0;var i,child,cnt=this._parent.numChildren,size=0;if(this._layout==fgui.GroupLayoutType.Horizontal){for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(size+=child.width);for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(child._sizePercentInGroup=size>0?child.width/size:0)}else{for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(size+=child.height);for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(child._sizePercentInGroup=size>0?child.height/size:0)}}moveChildren(dx,dy){if(0==(1&this._updating)&&null!=this._parent){this._updating|=1;var i,child,cnt=this._parent.numChildren;for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&child.setXY(child.x+dx,child.y+dy);this._updating&=2}}resizeChildren(dw,dh){if(this._layout!=fgui.GroupLayoutType.None&&0==(2&this._updating)&&null!=this._parent){this._updating|=2,this._percentReady||this.updatePercent();var i,j,child,cnt=this._parent.numChildren,last=-1,numChildren=0,lineSize=0,remainSize=0,found=!1;for(i=0;i<cnt;i++)(child=this._parent.getChildAt(i)).group==this&&(last=i,numChildren++);if(this._layout==fgui.GroupLayoutType.Horizontal){remainSize=lineSize=this.width-(numChildren-1)*this._columnGap;var nw,curX=NaN;for(i=0;i<cnt;i++)if((child=this._parent.getChildAt(i)).group==this)if(isNaN(curX)?curX=Math.floor(child.x):child.x=curX,nw=last==i?remainSize:Math.round(child._sizePercentInGroup*lineSize),child.setSize(nw,child._rawHeight+dh,!0),remainSize-=child.width,last==i){if(remainSize>=1)for(j=0;j<=i;j++)(child=this._parent.getChildAt(j)).group==this&&(found?child.x+=remainSize:(nw=child.width+remainSize,(0==child.maxWidth||nw<child.maxWidth)&&(0==child.minWidth||nw>child.minWidth)&&(child.setSize(nw,child.height,!0),found=!0)))}else curX+=child.width+this._columnGap}else if(this._layout==fgui.GroupLayoutType.Vertical){remainSize=lineSize=this.height-(numChildren-1)*this._lineGap;var nh,curY=NaN;for(i=0;i<cnt;i++)if((child=this._parent.getChildAt(i)).group==this)if(isNaN(curY)?curY=Math.floor(child.y):child.y=curY,nh=last==i?remainSize:Math.round(child._sizePercentInGroup*lineSize),child.setSize(child._rawWidth+dw,nh,!0),remainSize-=child.height,last==i){if(remainSize>=1)for(j=0;j<=i;j++)(child=this._parent.getChildAt(j)).group==this&&(found?child.y+=remainSize:(nh=child.height+remainSize,(0==child.maxHeight||nh<child.maxHeight)&&(0==child.minHeight||nh>child.minHeight)&&(child.setSize(child.width,nh,!0),found=!0)))}else curY+=child.height+this._lineGap}this._updating&=1}}handleAlphaChanged(){if(!this._underConstruct)for(var cnt=this._parent.numChildren,i=0;i<cnt;i++){var child=this._parent.getChildAt(i);child.group==this&&(child.alpha=this.alpha)}}handleVisibleChanged(){if(this._parent)for(var cnt=this._parent.numChildren,i=0;i<cnt;i++){var child=this._parent.getChildAt(i);child.group==this&&child.handleVisibleChanged()}}setup_beforeAdd(buffer,beginPos){super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),this._layout=buffer.readByte(),this._lineGap=buffer.getInt32(),this._columnGap=buffer.getInt32()}setup_afterAdd(buffer,beginPos){super.setup_afterAdd(buffer,beginPos),this.visible||this.handleVisibleChanged()}}}(fgui||(fgui={})),function(fgui){fgui.GImage=class extends fgui.GObject{constructor(){super()}get color(){return this.image.color}set color(value){this.image.color!=value&&(this.image.color=value,this.updateGear(4))}get flip(){return this._flip}set flip(value){if(this._flip!=value){this._flip=value;var sx=1,sy=1;this._flip!=fgui.FlipType.Horizontal&&this._flip!=fgui.FlipType.Both||(sx=-1),this._flip!=fgui.FlipType.Vertical&&this._flip!=fgui.FlipType.Both||(sy=-1),this.setScale(sx,sy),this.handleXYChanged()}}get fillMethod(){return this.image.fillMethod}set fillMethod(value){this.image.fillMethod=value}get fillOrigin(){return this.image.fillOrigin}set fillOrigin(value){this.image.fillOrigin=value}get fillClockwise(){return this.image.fillClockwise}set fillClockwise(value){this.image.fillClockwise=value}get fillAmount(){return this.image.fillAmount}set fillAmount(value){this.image.fillAmount=value}createDisplayObject(){this._displayObject=this.image=new fgui.Image,this.image.mouseEnabled=!1,this._displayObject.$owner=this}constructFromResource(){this.packageItem.load(),this.sourceWidth=this.packageItem.width,this.sourceHeight=this.packageItem.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.image.scale9Grid=this.packageItem.scale9Grid,this.image.scaleByTile=this.packageItem.scaleByTile,this.image.tileGridIndice=this.packageItem.tileGridIndice,this.image.texture=this.packageItem.texture,this.setSize(this.sourceWidth,this.sourceHeight)}handleXYChanged(){super.handleXYChanged(),this._flip!=fgui.FlipType.None&&(-1==this.scaleX&&(this.image.x+=this.width),-1==this.scaleY&&(this.image.y+=this.height))}getProp(index){return index==fgui.ObjectPropID.Color?this.color:super.getProp(index)}setProp(index,value){index==fgui.ObjectPropID.Color?this.color=value:super.setProp(index,value)}setup_beforeAdd(buffer,beginPos){super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),buffer.readBool()&&(this.color=buffer.readColorS()),this.flip=buffer.readByte(),this.image.fillMethod=buffer.readByte(),0!=this.image.fillMethod&&(this.image.fillOrigin=buffer.readByte(),this.image.fillClockwise=buffer.readBool(),this.image.fillAmount=buffer.getFloat32())}}}(fgui||(fgui={})),function(fgui){class GLabel extends fgui.GComponent{constructor(){super()}get icon(){return null!=this._iconObject?this._iconObject.icon:null}set icon(value){null!=this._iconObject&&(this._iconObject.icon=value),this.updateGear(7)}get title(){return this._titleObject?this._titleObject.text:null}set title(value){this._titleObject&&(this._titleObject.text=value),this.updateGear(6)}get text(){return this.title}set text(value){this.title=value}get titleColor(){var tf=this.getTextField();return null!=tf?tf.color:"#000000"}set titleColor(value){var tf=this.getTextField();null!=tf&&(tf.color=value),this.updateGear(4)}get titleFontSize(){var tf=this.getTextField();return null!=tf?tf.fontSize:0}set titleFontSize(value){var tf=this.getTextField();null!=tf&&(tf.fontSize=value)}get color(){return this.titleColor}set color(value){this.titleColor=value}set editable(val){this._titleObject&&(this._titleObject.asTextInput.editable=val)}get editable(){return!!(this._titleObject&&this._titleObject instanceof fgui.GTextInput)&&this._titleObject.asTextInput.editable}getTextField(){return this._titleObject instanceof fgui.GTextField?this._titleObject:this._titleObject instanceof GLabel?this._titleObject.getTextField():this._titleObject instanceof fgui.GButton?this._titleObject.getTextField():null}getProp(index){switch(index){case fgui.ObjectPropID.Color:return this.titleColor;case fgui.ObjectPropID.OutlineColor:var tf=this.getTextField();return tf?tf.strokeColor:0;case fgui.ObjectPropID.FontSize:return this.titleFontSize;default:return super.getProp(index)}}setProp(index,value){switch(index){case fgui.ObjectPropID.Color:this.titleColor=value;break;case fgui.ObjectPropID.OutlineColor:var tf=this.getTextField();tf&&(tf.strokeColor=value);break;case fgui.ObjectPropID.FontSize:this.titleFontSize=value;break;default:super.setProp(index,value)}}constructExtension(buffer){this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon")}setup_afterAdd(buffer,beginPos){if(super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6)&&buffer.readByte()==this.packageItem.objectType){var str;null!=(str=buffer.readS())&&(this.title=str),null!=(str=buffer.readS())&&(this.icon=str),buffer.readBool()&&(this.titleColor=buffer.readColorS());var iv=buffer.getInt32();if(0!=iv&&(this.titleFontSize=iv),buffer.readBool()){var input=this.getTextField();null!=input?(null!=(str=buffer.readS())&&(input.promptText=str),null!=(str=buffer.readS())&&(input.restrict=str),0!=(iv=buffer.getInt32())&&(input.maxLength=iv),0!=(iv=buffer.getInt32())&&(4==iv?input.keyboardType=Laya.Input.TYPE_NUMBER:3==iv&&(input.keyboardType=Laya.Input.TYPE_URL)),buffer.readBool()&&(input.password=!0)):buffer.skip(13)}}}}fgui.GLabel=GLabel}(fgui||(fgui={})),function(fgui){class GList extends fgui.GComponent{constructor(){super(),this._lineCount=0,this._columnCount=0,this._lineGap=0,this._columnGap=0,this._lastSelectedIndex=0,this._numItems=0,this._firstIndex=0,this._curLineItemCount=0,this._virtualListChanged=0,this.itemInfoVer=0,this._trackBounds=!0,this._pool=new fgui.GObjectPool,this._layout=fgui.ListLayoutType.SingleColumn,this._autoResizeItem=!0,this._lastSelectedIndex=-1,this._selectionMode=fgui.ListSelectionMode.Single,this.opaque=!0,this.scrollItemToViewOnClick=!0,this._align="left",this._verticalAlign="top",this._container=new Laya.Sprite,this._displayObject.addChild(this._container)}dispose(){this._pool.clear(),super.dispose()}get layout(){return this._layout}set layout(value){this._layout!=value&&(this._layout=value,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get lineCount(){return this._lineCount}set lineCount(value){this._lineCount!=value&&(this._lineCount=value,this._layout!=fgui.ListLayoutType.FlowVertical&&this._layout!=fgui.ListLayoutType.Pagination||(this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)))}get columnCount(){return this._columnCount}set columnCount(value){this._columnCount!=value&&(this._columnCount=value,this._layout!=fgui.ListLayoutType.FlowHorizontal&&this._layout!=fgui.ListLayoutType.Pagination||(this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)))}get lineGap(){return this._lineGap}set lineGap(value){this._lineGap!=value&&(this._lineGap=value,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get columnGap(){return this._columnGap}set columnGap(value){this._columnGap!=value&&(this._columnGap=value,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get align(){return this._align}set align(value){this._align!=value&&(this._align=value,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get verticalAlign(){return this._verticalAlign}set verticalAlign(value){this._verticalAlign!=value&&(this._verticalAlign=value,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get virtualItemSize(){return this._itemSize}set virtualItemSize(value){this._virtual&&(null==this._itemSize&&(this._itemSize=new Laya.Point),this._itemSize.setTo(value.x,value.y),this.setVirtualListChangedFlag(!0))}get defaultItem(){return this._defaultItem}set defaultItem(val){this._defaultItem=val}get autoResizeItem(){return this._autoResizeItem}set autoResizeItem(value){this._autoResizeItem!=value&&(this._autoResizeItem=value,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get selectionMode(){return this._selectionMode}set selectionMode(value){this._selectionMode=value}get selectionController(){return this._selectionController}set selectionController(value){this._selectionController=value}get itemPool(){return this._pool}getFromPool(url){url||(url=this._defaultItem);var obj=this._pool.getObject(url);return null!=obj&&(obj.visible=!0),obj}returnToPool(obj){obj.displayObject.cacheAs="none",this._pool.returnObject(obj)}addChildAt(child,index){if(super.addChildAt(child,index),child instanceof fgui.GButton){var button=child;button.selected=!1,button.changeStateOnClick=!1}return child.on(Laya.Event.CLICK,this,this.__clickItem),child}addItem(url){return url||(url=this._defaultItem),this.addChild(fgui.UIPackage.createObjectFromURL(url))}addItemFromPool(url){return this.addChild(this.getFromPool(url))}removeChildAt(index,dispose){var child=super.removeChildAt(index);return dispose?child.dispose():child.off(Laya.Event.CLICK,this,this.__clickItem),child}removeChildToPoolAt(index){var child=super.removeChildAt(index);this.returnToPool(child)}removeChildToPool(child){super.removeChild(child),this.returnToPool(child)}removeChildrenToPool(beginIndex=0,endIndex=-1){(endIndex<0||endIndex>=this._children.length)&&(endIndex=this._children.length-1);for(var i=beginIndex;i<=endIndex;++i)this.removeChildToPoolAt(beginIndex)}get selectedIndex(){var i;if(this._virtual)for(i=0;i<this._realNumItems;i++){var ii=this._virtualItems[i];if(ii.obj instanceof fgui.GButton&&ii.obj.selected||null==ii.obj&&ii.selected)return this._loop?i%this._numItems:i}else{var cnt=this._children.length;for(i=0;i<cnt;i++){var obj=this._children[i].asButton;if(null!=obj&&obj.selected)return i}}return-1}set selectedIndex(value){value>=0&&value<this.numItems?(this._selectionMode!=fgui.ListSelectionMode.Single&&this.clearSelection(),this.addSelection(value)):this.clearSelection()}getSelection(){var i,ret=[];if(this._virtual)for(i=0;i<this._realNumItems;i++){var ii=this._virtualItems[i];if(ii.obj instanceof fgui.GButton&&ii.obj.selected||null==ii.obj&&ii.selected){var j=i;if(this._loop&&(j=i%this._numItems,-1!=ret.indexOf(j)))continue;ret.push(j)}}else{var cnt=this._children.length;for(i=0;i<cnt;i++){var obj=this._children[i].asButton;null!=obj&&obj.selected&&ret.push(i)}}return ret}addSelection(index,scrollItToView){if(this._selectionMode!=fgui.ListSelectionMode.None){this.checkVirtualList(),this._selectionMode==fgui.ListSelectionMode.Single&&this.clearSelection(),scrollItToView&&this.scrollToView(index),this._lastSelectedIndex=index;var obj=null;if(this._virtual){var ii=this._virtualItems[index];null!=ii.obj&&(obj=ii.obj.asButton),ii.selected=!0}else obj=this.getChildAt(index).asButton;null==obj||obj.selected||(obj.selected=!0,this.updateSelectionController(index))}}removeSelection(index){if(this._selectionMode!=fgui.ListSelectionMode.None){var obj=null;if(this._virtual){var ii=this._virtualItems[index];null!=ii.obj&&(obj=ii.obj.asButton),ii.selected=!1}else obj=this.getChildAt(index).asButton;null!=obj&&(obj.selected=!1)}}clearSelection(){var i;if(this._virtual)for(i=0;i<this._realNumItems;i++){var ii=this._virtualItems[i];ii.obj instanceof fgui.GButton&&(ii.obj.selected=!1),ii.selected=!1}else{var cnt=this._children.length;for(i=0;i<cnt;i++){var obj=this._children[i].asButton;null!=obj&&(obj.selected=!1)}}}clearSelectionExcept(g){var i;if(this._virtual)for(i=0;i<this._realNumItems;i++){var ii=this._virtualItems[i];ii.obj!=g&&(ii.obj instanceof fgui.GButton&&(ii.obj.selected=!1),ii.selected=!1)}else{var cnt=this._children.length;for(i=0;i<cnt;i++){var obj=this._children[i].asButton;null!=obj&&obj!=g&&(obj.selected=!1)}}}selectAll(){this.checkVirtualList();var i,last=-1;if(this._virtual)for(i=0;i<this._realNumItems;i++){var ii=this._virtualItems[i];ii.obj instanceof fgui.GButton&&!ii.obj.selected&&(ii.obj.selected=!0,last=i),ii.selected=!0}else{var cnt=this._children.length;for(i=0;i<cnt;i++){var obj=this._children[i].asButton;null==obj||obj.selected||(obj.selected=!0,last=i)}}-1!=last&&this.updateSelectionController(last)}selectNone(){this.clearSelection()}selectReverse(){this.checkVirtualList();var i,last=-1;if(this._virtual)for(i=0;i<this._realNumItems;i++){var ii=this._virtualItems[i];ii.obj instanceof fgui.GButton&&(ii.obj.selected=!ii.obj.selected,ii.obj.selected&&(last=i)),ii.selected=!ii.selected}else{var cnt=this._children.length;for(i=0;i<cnt;i++){var obj=this._children[i].asButton;null!=obj&&(obj.selected=!obj.selected,obj.selected&&(last=i))}}-1!=last&&this.updateSelectionController(last)}handleArrowKey(dir){var index=this.selectedIndex;if(-1!=index)switch(dir){case 1:if(this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowVertical)--index>=0&&(this.clearSelection(),this.addSelection(index,!0));else if(this._layout==fgui.ListLayoutType.FlowHorizontal||this._layout==fgui.ListLayoutType.Pagination){for(var current=this._children[index],k=0,i=index-1;i>=0;i--){var obj=this._children[i];if(obj.y!=current.y){current=obj;break}k++}for(;i>=0;i--)if((obj=this._children[i]).y!=current.y){this.clearSelection(),this.addSelection(i+k+1,!0);break}}break;case 3:if(this._layout==fgui.ListLayoutType.SingleRow||this._layout==fgui.ListLayoutType.FlowHorizontal||this._layout==fgui.ListLayoutType.Pagination)++index<this._children.length&&(this.clearSelection(),this.addSelection(index,!0));else if(this._layout==fgui.ListLayoutType.FlowVertical){current=this._children[index],k=0;var cnt=this._children.length;for(i=index+1;i<cnt;i++){if((obj=this._children[i]).x!=current.x){current=obj;break}k++}for(;i<cnt;i++)if((obj=this._children[i]).x!=current.x){this.clearSelection(),this.addSelection(i-k-1,!0);break}}break;case 5:if(this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowVertical)++index<this._children.length&&(this.clearSelection(),this.addSelection(index,!0));else if(this._layout==fgui.ListLayoutType.FlowHorizontal||this._layout==fgui.ListLayoutType.Pagination){for(current=this._children[index],k=0,cnt=this._children.length,i=index+1;i<cnt;i++){if((obj=this._children[i]).y!=current.y){current=obj;break}k++}for(;i<cnt;i++)if((obj=this._children[i]).y!=current.y){this.clearSelection(),this.addSelection(i-k-1,!0);break}}break;case 7:if(this._layout==fgui.ListLayoutType.SingleRow||this._layout==fgui.ListLayoutType.FlowHorizontal||this._layout==fgui.ListLayoutType.Pagination)--index>=0&&(this.clearSelection(),this.addSelection(index,!0));else if(this._layout==fgui.ListLayoutType.FlowVertical){for(current=this._children[index],k=0,i=index-1;i>=0;i--){if((obj=this._children[i]).x!=current.x){current=obj;break}k++}for(;i>=0;i--)if((obj=this._children[i]).x!=current.x){this.clearSelection(),this.addSelection(i+k+1,!0);break}}}}__clickItem(evt){if(null==this._scrollPane||!this._scrollPane.isDragged){var item=fgui.GObject.cast(evt.currentTarget);this.setSelectionOnEvent(item,evt),this._scrollPane&&this.scrollItemToViewOnClick&&this._scrollPane.scrollToView(item,!0),this.displayObject.event(fgui.Events.CLICK_ITEM,[item,fgui.Events.createEvent(fgui.Events.CLICK_ITEM,this.displayObject,evt)])}}setSelectionOnEvent(item,evt){if(item instanceof fgui.GButton&&this._selectionMode!=fgui.ListSelectionMode.None){var dontChangeLastIndex=!1,button=item,index=this.childIndexToItemIndex(this.getChildIndex(item));if(this._selectionMode==fgui.ListSelectionMode.Single)button.selected||(this.clearSelectionExcept(button),button.selected=!0);else if(evt.shiftKey){if(!button.selected)if(-1!=this._lastSelectedIndex){var i,min=Math.min(this._lastSelectedIndex,index),max=Math.max(this._lastSelectedIndex,index);if(max=Math.min(max,this.numItems-1),this._virtual)for(i=min;i<=max;i++){var ii=this._virtualItems[i];ii.obj instanceof fgui.GButton&&(ii.obj.selected=!0),ii.selected=!0}else for(i=min;i<=max;i++){var obj=this.getChildAt(i).asButton;null!=obj&&(obj.selected=!0)}dontChangeLastIndex=!0}else button.selected=!0}else evt.ctrlKey||this._selectionMode==fgui.ListSelectionMode.Multiple_SingleClick?button.selected=!button.selected:button.selected?this.clearSelectionExcept(button):(this.clearSelectionExcept(button),button.selected=!0);dontChangeLastIndex||(this._lastSelectedIndex=index),button.selected&&this.updateSelectionController(index)}}resizeToFit(itemCount=1e6,minSize=0){this.ensureBoundsCorrect();var curCount=this.numItems;if(itemCount>curCount&&(itemCount=curCount),this._virtual){Math.ceil(itemCount/this._curLineItemCount);this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal?this.viewHeight=this.lineCount*this._itemSize.y+Math.max(0,this.lineCount-1)*this._lineGap:this.viewWidth=this.lineCount*this._itemSize.x+Math.max(0,this.lineCount-1)*this._columnGap}else if(0==itemCount)this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal?this.viewHeight=minSize:this.viewWidth=minSize;else{for(var i=itemCount-1,obj=null;i>=0&&(obj=this.getChildAt(i),this.foldInvisibleItems&&!obj.visible);)i--;if(i<0)this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal?this.viewHeight=minSize:this.viewWidth=minSize;else{var size=0;this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal?((size=obj.y+obj.height)<minSize&&(size=minSize),this.viewHeight=size):((size=obj.x+obj.width)<minSize&&(size=minSize),this.viewWidth=size)}}}getMaxItemWidth(){for(var cnt=this._children.length,max=0,i=0;i<cnt;i++){var child=this.getChildAt(i);child.width>max&&(max=child.width)}return max}handleSizeChanged(){super.handleSizeChanged(),this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)}handleControllerChanged(c){super.handleControllerChanged(c),this._selectionController==c&&(this.selectedIndex=c.selectedIndex)}updateSelectionController(index){if(null!=this._selectionController&&!this._selectionController.changing&&index<this._selectionController.pageCount){var c=this._selectionController;this._selectionController=null,c.selectedIndex=index,this._selectionController=c}}shouldSnapToNext(dir,delta,size){return dir<0&&delta>fgui.UIConfig.defaultScrollSnappingThreshold*size||dir>0&&delta>(1-fgui.UIConfig.defaultScrollSnappingThreshold)*size||0==dir&&delta>size/2}getSnappingPositionWithDir(xValue,yValue,xDir,yDir,resultPoint=null){var saved,index,size;return this._virtual?(resultPoint||(resultPoint=new Laya.Point),this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal?(saved=yValue,GList.pos_param=yValue,index=this.getIndexOnPos1(!1),yValue=GList.pos_param,index<this._virtualItems.length&&index<this._realNumItems&&(size=this._virtualItems[index].height,this.shouldSnapToNext(yDir,saved-yValue,size)&&(yValue+=size+this._lineGap))):this._layout==fgui.ListLayoutType.SingleRow||this._layout==fgui.ListLayoutType.FlowVertical?(saved=xValue,GList.pos_param=xValue,index=this.getIndexOnPos2(!1),xValue=GList.pos_param,index<this._virtualItems.length&&index<this._realNumItems&&(size=this._virtualItems[index].width,this.shouldSnapToNext(xDir,saved-xValue,size)&&(xValue+=size+this._columnGap))):(saved=xValue,GList.pos_param=xValue,index=this.getIndexOnPos3(!1),xValue=GList.pos_param,index<this._virtualItems.length&&index<this._realNumItems&&(size=this._virtualItems[index].width,this.shouldSnapToNext(xDir,saved-xValue,size)&&(xValue+=size+this._columnGap))),resultPoint.x=xValue,resultPoint.y=yValue,resultPoint):super.getSnappingPositionWithDir(xValue,yValue,xDir,yDir,resultPoint)}scrollToView(index,ani=!1,setFirst=!1){if(this._virtual){if(0==this._numItems)return;if(this.checkVirtualList(),index>=this._virtualItems.length)throw new Error("Invalid child index: "+index+">"+this._virtualItems.length);var rect;this._loop&&(index=Math.floor(this._firstIndex/this._numItems)*this._numItems+index);var i,ii=this._virtualItems[index],pos=0;if(this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal){for(i=this._curLineItemCount-1;i<index;i+=this._curLineItemCount)pos+=this._virtualItems[i].height+this._lineGap;rect=new Laya.Rectangle(0,pos,this._itemSize.x,ii.height)}else if(this._layout==fgui.ListLayoutType.SingleRow||this._layout==fgui.ListLayoutType.FlowVertical){for(i=this._curLineItemCount-1;i<index;i+=this._curLineItemCount)pos+=this._virtualItems[i].width+this._columnGap;rect=new Laya.Rectangle(pos,0,ii.width,this._itemSize.y)}else{var page=index/(this._curLineItemCount*this._curLineItemCount2);rect=new Laya.Rectangle(page*this.viewWidth+index%this._curLineItemCount*(ii.width+this._columnGap),index/this._curLineItemCount%this._curLineItemCount2*(ii.height+this._lineGap),ii.width,ii.height)}setFirst=!0,null!=this._scrollPane&&this._scrollPane.scrollToView(rect,ani,setFirst)}else{var obj=this.getChildAt(index);null!=this._scrollPane?this._scrollPane.scrollToView(obj,ani,setFirst):null!=this._parent&&null!=this._parent.scrollPane&&this._parent.scrollPane.scrollToView(obj,ani,setFirst)}}getFirstChildInView(){return this.childIndexToItemIndex(super.getFirstChildInView())}childIndexToItemIndex(index){if(!this._virtual)return index;if(this._layout==fgui.ListLayoutType.Pagination){for(var i=this._firstIndex;i<this._realNumItems;i++)if(null!=this._virtualItems[i].obj&&--index<0)return i;return index}return index+=this._firstIndex,this._loop&&this._numItems>0&&(index%=this._numItems),index}itemIndexToChildIndex(index){if(!this._virtual)return index;if(this._layout==fgui.ListLayoutType.Pagination)return this.getChildIndex(this._virtualItems[index].obj);if(this._loop&&this._numItems>0){var j=this._firstIndex%this._numItems;index>=j?index-=j:index=this._numItems-j+index}else index-=this._firstIndex;return index}setVirtual(){this._setVirtual(!1)}setVirtualAndLoop(){this._setVirtual(!0)}_setVirtual(loop){if(!this._virtual){if(null==this._scrollPane)throw new Error("Virtual list must be scrollable!");if(loop){if(this._layout==fgui.ListLayoutType.FlowHorizontal||this._layout==fgui.ListLayoutType.FlowVertical)throw new Error("Loop list instanceof not supported for FlowHorizontal or FlowVertical this.layout!");this._scrollPane.bouncebackEffect=!1}if(this._virtual=!0,this._loop=loop,this._virtualItems=new Array,this.removeChildrenToPool(),null==this._itemSize){this._itemSize=new Laya.Point;var obj=this.getFromPool(null);if(null==obj)throw new Error("Virtual List must have a default list item resource.");this._itemSize.x=obj.width,this._itemSize.y=obj.height,this.returnToPool(obj)}this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal?(this._scrollPane.scrollStep=this._itemSize.y,this._loop&&(this._scrollPane._loop=2)):(this._scrollPane.scrollStep=this._itemSize.x,this._loop&&(this._scrollPane._loop=1)),this.on(fgui.Events.SCROLL,this,this.__scrolled),this.setVirtualListChangedFlag(!0)}}get numItems(){return this._virtual?this._numItems:this._children.length}set numItems(value){var i;if(this._virtual){if(null==this.itemRenderer)throw new Error("set itemRenderer first!");this._numItems=value,this._loop?this._realNumItems=6*this._numItems:this._realNumItems=this._numItems;var oldCount=this._virtualItems.length;if(this._realNumItems>oldCount)for(i=oldCount;i<this._realNumItems;i++){var ii=new ItemInfo;ii.width=this._itemSize.x,ii.height=this._itemSize.y,this._virtualItems.push(ii)}else for(i=this._realNumItems;i<oldCount;i++)this._virtualItems[i].selected=!1;0!=this._virtualListChanged&&Laya.timer.clear(this,this._refreshVirtualList),this._refreshVirtualList()}else{var cnt=this._children.length;if(value>cnt)for(i=cnt;i<value;i++)null==this.itemProvider?this.addItemFromPool():this.addItemFromPool(this.itemProvider.runWith(i));else this.removeChildrenToPool(value,cnt);if(null!=this.itemRenderer)for(i=0;i<value;i++)this.itemRenderer.runWith([i,this.getChildAt(i)])}}refreshVirtualList(){this.setVirtualListChangedFlag(!1)}checkVirtualList(){0!=this._virtualListChanged&&(this._refreshVirtualList(),Laya.timer.clear(this,this._refreshVirtualList))}setVirtualListChangedFlag(layoutChanged=!1){layoutChanged?this._virtualListChanged=2:0==this._virtualListChanged&&(this._virtualListChanged=1),Laya.timer.callLater(this,this._refreshVirtualList)}_refreshVirtualList(){if(this._displayObject){var layoutChanged=2==this._virtualListChanged;this._virtualListChanged=0,this._eventLocked=!0,layoutChanged&&(this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.SingleRow?this._curLineItemCount=1:this._layout==fgui.ListLayoutType.FlowHorizontal?this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):this._layout==fgui.ListLayoutType.FlowVertical?this._lineCount>0?this._curLineItemCount=this._lineCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.y+this._lineGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):(this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)),this._lineCount>0?this._curLineItemCount2=this._lineCount:(this._curLineItemCount2=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.y+this._lineGap)),this._curLineItemCount2<=0&&(this._curLineItemCount2=1))));var ch=0,cw=0;if(this._realNumItems>0){var i,len=Math.ceil(this._realNumItems/this._curLineItemCount)*this._curLineItemCount,len2=Math.min(this._curLineItemCount,this._realNumItems);if(this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal){for(i=0;i<len;i+=this._curLineItemCount)ch+=this._virtualItems[i].height+this._lineGap;if(ch>0&&(ch-=this._lineGap),this._autoResizeItem)cw=this._scrollPane.viewWidth;else{for(i=0;i<len2;i++)cw+=this._virtualItems[i].width+this._columnGap;cw>0&&(cw-=this._columnGap)}}else if(this._layout==fgui.ListLayoutType.SingleRow||this._layout==fgui.ListLayoutType.FlowVertical){for(i=0;i<len;i+=this._curLineItemCount)cw+=this._virtualItems[i].width+this._columnGap;if(cw>0&&(cw-=this._columnGap),this._autoResizeItem)ch=this._scrollPane.viewHeight;else{for(i=0;i<len2;i++)ch+=this._virtualItems[i].height+this._lineGap;ch>0&&(ch-=this._lineGap)}}else{cw=Math.ceil(len/(this._curLineItemCount*this._curLineItemCount2))*this.viewWidth,ch=this.viewHeight}}this.handleAlign(cw,ch),this._scrollPane.setContentSize(cw,ch),this._eventLocked=!1,this.handleScroll(!0)}}__scrolled(evt){this.handleScroll(!1)}getIndexOnPos1(forceUpdate){if(this._realNumItems<this._curLineItemCount)return GList.pos_param=0,0;var i,pos2,pos3;if(this.numChildren>0&&!forceUpdate){if((pos2=this.getChildAt(0).y)>GList.pos_param){for(i=this._firstIndex-this._curLineItemCount;i>=0;i-=this._curLineItemCount)if((pos2-=this._virtualItems[i].height+this._lineGap)<=GList.pos_param)return GList.pos_param=pos2,i;return GList.pos_param=0,0}for(i=this._firstIndex;i<this._realNumItems;i+=this._curLineItemCount){if((pos3=pos2+this._virtualItems[i].height+this._lineGap)>GList.pos_param)return GList.pos_param=pos2,i;pos2=pos3}return GList.pos_param=pos2,this._realNumItems-this._curLineItemCount}for(pos2=0,i=0;i<this._realNumItems;i+=this._curLineItemCount){if((pos3=pos2+this._virtualItems[i].height+this._lineGap)>GList.pos_param)return GList.pos_param=pos2,i;pos2=pos3}return GList.pos_param=pos2,this._realNumItems-this._curLineItemCount}getIndexOnPos2(forceUpdate){if(this._realNumItems<this._curLineItemCount)return GList.pos_param=0,0;var i,pos2,pos3;if(this.numChildren>0&&!forceUpdate){if((pos2=this.getChildAt(0).x)>GList.pos_param){for(i=this._firstIndex-this._curLineItemCount;i>=0;i-=this._curLineItemCount)if((pos2-=this._virtualItems[i].width+this._columnGap)<=GList.pos_param)return GList.pos_param=pos2,i;return GList.pos_param=0,0}for(i=this._firstIndex;i<this._realNumItems;i+=this._curLineItemCount){if((pos3=pos2+this._virtualItems[i].width+this._columnGap)>GList.pos_param)return GList.pos_param=pos2,i;pos2=pos3}return GList.pos_param=pos2,this._realNumItems-this._curLineItemCount}for(pos2=0,i=0;i<this._realNumItems;i+=this._curLineItemCount){if((pos3=pos2+this._virtualItems[i].width+this._columnGap)>GList.pos_param)return GList.pos_param=pos2,i;pos2=pos3}return GList.pos_param=pos2,this._realNumItems-this._curLineItemCount}getIndexOnPos3(forceUpdate){if(this._realNumItems<this._curLineItemCount)return GList.pos_param=0,0;var i,pos3,viewWidth=this.viewWidth,page=Math.floor(GList.pos_param/viewWidth),startIndex=page*(this._curLineItemCount*this._curLineItemCount2),pos2=page*viewWidth;for(i=0;i<this._curLineItemCount;i++){if((pos3=pos2+this._virtualItems[startIndex+i].width+this._columnGap)>GList.pos_param)return GList.pos_param=pos2,startIndex+i;pos2=pos3}return GList.pos_param=pos2,startIndex+this._curLineItemCount-1}handleScroll(forceUpdate){if(!this._eventLocked){if(this._layout==fgui.ListLayoutType.SingleColumn||this._layout==fgui.ListLayoutType.FlowHorizontal){for(var enterCounter=0;this.handleScroll1(forceUpdate);)if(forceUpdate=!1,++enterCounter>20){console.log("FairyGUI: list will never be <the> filled item renderer function always returns a different size.");break}this.handleArchOrder1()}else if(this._layout==fgui.ListLayoutType.SingleRow||this._layout==fgui.ListLayoutType.FlowVertical){for(enterCounter=0;this.handleScroll2(forceUpdate);)if(forceUpdate=!1,++enterCounter>20){console.log("FairyGUI: list will never be <the> filled item renderer function always returns a different size.");break}this.handleArchOrder2()}else this.handleScroll3(forceUpdate);this._boundsChanged=!1}}handleScroll1(forceUpdate){var pos=this._scrollPane.scrollingPosY,max=pos+this._scrollPane.viewHeight,end=max==this._scrollPane.contentHeight;GList.pos_param=pos;var newFirstIndex=this.getIndexOnPos1(forceUpdate);if(pos=GList.pos_param,newFirstIndex==this._firstIndex&&!forceUpdate)return!1;var oldFirstIndex=this._firstIndex;this._firstIndex=newFirstIndex;var needRender,ii,ii2,i,j,curIndex=newFirstIndex,forward=oldFirstIndex>newFirstIndex,childCount=this.numChildren,lastIndex=oldFirstIndex+childCount-1,reuseIndex=forward?lastIndex:oldFirstIndex,curX=0,curY=pos,deltaSize=0,firstItemDeltaSize=0,url=this.defaultItem,partSize=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;curIndex<this._realNumItems&&(end||curY<max);){if((null==(ii=this._virtualItems[curIndex]).obj||forceUpdate)&&(null!=this.itemProvider&&(null==(url=this.itemProvider.runWith(curIndex%this._numItems))&&(url=this._defaultItem),url=fgui.UIPackage.normalizeURL(url)),null!=ii.obj&&ii.obj.resourceURL!=url&&(ii.obj instanceof fgui.GButton&&(ii.selected=ii.obj.selected),this.removeChildToPool(ii.obj),ii.obj=null)),null==ii.obj){if(forward){for(j=reuseIndex;j>=oldFirstIndex;j--)if(null!=(ii2=this._virtualItems[j]).obj&&ii2.updateFlag!=this.itemInfoVer&&ii2.obj.resourceURL==url){ii2.obj instanceof fgui.GButton&&(ii2.selected=ii2.obj.selected),ii.obj=ii2.obj,ii2.obj=null,j==reuseIndex&&reuseIndex--;break}}else for(j=reuseIndex;j<=lastIndex;j++)if(null!=(ii2=this._virtualItems[j]).obj&&ii2.updateFlag!=this.itemInfoVer&&ii2.obj.resourceURL==url){ii2.obj instanceof fgui.GButton&&(ii2.selected=ii2.obj.selected),ii.obj=ii2.obj,ii2.obj=null,j==reuseIndex&&reuseIndex++;break}null!=ii.obj?this.setChildIndex(ii.obj,forward?curIndex-newFirstIndex:this.numChildren):(ii.obj=this._pool.getObject(url),forward?this.addChildAt(ii.obj,curIndex-newFirstIndex):this.addChild(ii.obj)),ii.obj instanceof fgui.GButton&&(ii.obj.selected=ii.selected),needRender=!0}else needRender=forceUpdate;needRender&&(this._autoResizeItem&&(this._layout==fgui.ListLayoutType.SingleColumn||this._columnCount>0)&&ii.obj.setSize(partSize,ii.obj.height,!0),this.itemRenderer.runWith([curIndex%this._numItems,ii.obj]),curIndex%this._curLineItemCount==0&&(deltaSize+=Math.ceil(ii.obj.height)-ii.height,curIndex==newFirstIndex&&oldFirstIndex>newFirstIndex&&(firstItemDeltaSize=Math.ceil(ii.obj.height)-ii.height)),ii.width=Math.ceil(ii.obj.width),ii.height=Math.ceil(ii.obj.height)),ii.updateFlag=this.itemInfoVer,ii.obj.setXY(curX,curY),curIndex==newFirstIndex&&(max+=ii.height),curX+=ii.width+this._columnGap,curIndex%this._curLineItemCount==this._curLineItemCount-1&&(curX=0,curY+=ii.height+this._lineGap),curIndex++}for(i=0;i<childCount;i++)(ii=this._virtualItems[oldFirstIndex+i]).updateFlag!=this.itemInfoVer&&null!=ii.obj&&(ii.obj instanceof fgui.GButton&&(ii.selected=ii.obj.selected),this.removeChildToPool(ii.obj),ii.obj=null);for(childCount=this._children.length,i=0;i<childCount;i++){var obj=this._virtualItems[newFirstIndex+i].obj;this._children[i]!=obj&&this.setChildIndex(obj,i)}return 0==deltaSize&&0==firstItemDeltaSize||this._scrollPane.changeContentSizeOnScrolling(0,deltaSize,0,firstItemDeltaSize),curIndex>0&&this.numChildren>0&&this._container.y<0&&this.getChildAt(0).y>-this._container.y}handleScroll2(forceUpdate){var pos=this._scrollPane.scrollingPosX,max=pos+this._scrollPane.viewWidth,end=pos==this._scrollPane.contentWidth;GList.pos_param=pos;var newFirstIndex=this.getIndexOnPos2(forceUpdate);if(pos=GList.pos_param,newFirstIndex==this._firstIndex&&!forceUpdate)return!1;var oldFirstIndex=this._firstIndex;this._firstIndex=newFirstIndex;var needRender,ii,ii2,i,j,curIndex=newFirstIndex,forward=oldFirstIndex>newFirstIndex,childCount=this.numChildren,lastIndex=oldFirstIndex+childCount-1,reuseIndex=forward?lastIndex:oldFirstIndex,curX=pos,curY=0,deltaSize=0,firstItemDeltaSize=0,url=this.defaultItem,partSize=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;curIndex<this._realNumItems&&(end||curX<max);){if((null==(ii=this._virtualItems[curIndex]).obj||forceUpdate)&&(null!=this.itemProvider&&(null==(url=this.itemProvider.runWith(curIndex%this._numItems))&&(url=this._defaultItem),url=fgui.UIPackage.normalizeURL(url)),null!=ii.obj&&ii.obj.resourceURL!=url&&(ii.obj instanceof fgui.GButton&&(ii.selected=ii.obj.selected),this.removeChildToPool(ii.obj),ii.obj=null)),null==ii.obj){if(forward){for(j=reuseIndex;j>=oldFirstIndex;j--)if(null!=(ii2=this._virtualItems[j]).obj&&ii2.updateFlag!=this.itemInfoVer&&ii2.obj.resourceURL==url){ii2.obj instanceof fgui.GButton&&(ii2.selected=ii2.obj.selected),ii.obj=ii2.obj,ii2.obj=null,j==reuseIndex&&reuseIndex--;break}}else for(j=reuseIndex;j<=lastIndex;j++)if(null!=(ii2=this._virtualItems[j]).obj&&ii2.updateFlag!=this.itemInfoVer&&ii2.obj.resourceURL==url){ii2.obj instanceof fgui.GButton&&(ii2.selected=ii2.obj.selected),ii.obj=ii2.obj,ii2.obj=null,j==reuseIndex&&reuseIndex++;break}null!=ii.obj?this.setChildIndex(ii.obj,forward?curIndex-newFirstIndex:this.numChildren):(ii.obj=this._pool.getObject(url),forward?this.addChildAt(ii.obj,curIndex-newFirstIndex):this.addChild(ii.obj)),ii.obj instanceof fgui.GButton&&(ii.obj.selected=ii.selected),needRender=!0}else needRender=forceUpdate;needRender&&(this._autoResizeItem&&(this._layout==fgui.ListLayoutType.SingleRow||this._lineCount>0)&&ii.obj.setSize(ii.obj.width,partSize,!0),this.itemRenderer.runWith([curIndex%this._numItems,ii.obj]),curIndex%this._curLineItemCount==0&&(deltaSize+=Math.ceil(ii.obj.width)-ii.width,curIndex==newFirstIndex&&oldFirstIndex>newFirstIndex&&(firstItemDeltaSize=Math.ceil(ii.obj.width)-ii.width)),ii.width=Math.ceil(ii.obj.width),ii.height=Math.ceil(ii.obj.height)),ii.updateFlag=this.itemInfoVer,ii.obj.setXY(curX,curY),curIndex==newFirstIndex&&(max+=ii.width),curY+=ii.height+this._lineGap,curIndex%this._curLineItemCount==this._curLineItemCount-1&&(curY=0,curX+=ii.width+this._columnGap),curIndex++}for(i=0;i<childCount;i++)(ii=this._virtualItems[oldFirstIndex+i]).updateFlag!=this.itemInfoVer&&null!=ii.obj&&(ii.obj instanceof fgui.GButton&&(ii.selected=ii.obj.selected),this.removeChildToPool(ii.obj),ii.obj=null);for(childCount=this._children.length,i=0;i<childCount;i++){var obj=this._virtualItems[newFirstIndex+i].obj;this._children[i]!=obj&&this.setChildIndex(obj,i)}return 0==deltaSize&&0==firstItemDeltaSize||this._scrollPane.changeContentSizeOnScrolling(deltaSize,0,firstItemDeltaSize,0),curIndex>0&&this.numChildren>0&&this._container.x<0&&this.getChildAt(0).x>-this._container.x}handleScroll3(forceUpdate){var pos=this._scrollPane.scrollingPosX;GList.pos_param=pos;var newFirstIndex=this.getIndexOnPos3(forceUpdate);if(pos=GList.pos_param,newFirstIndex!=this._firstIndex||forceUpdate){var oldFirstIndex=this._firstIndex;this._firstIndex=newFirstIndex;var needRender,i,ii,ii2,col,reuseIndex=oldFirstIndex,virtualItemCount=this._virtualItems.length,pageSize=this._curLineItemCount*this._curLineItemCount2,startCol=newFirstIndex%this._curLineItemCount,viewWidth=this.viewWidth,startIndex=Math.floor(newFirstIndex/pageSize)*pageSize,lastIndex=startIndex+2*pageSize,url=this._defaultItem,partWidth=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount,partHeight=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount2-1))/this._curLineItemCount2;for(this.itemInfoVer++,i=startIndex;i<lastIndex;i++)if(!(i>=this._realNumItems)){if(col=i%this._curLineItemCount,i-startIndex<pageSize){if(col<startCol)continue}else if(col>startCol)continue;(ii=this._virtualItems[i]).updateFlag=this.itemInfoVer}var lastObj=null,insertIndex=0;for(i=startIndex;i<lastIndex;i++)if(!(i>=this._realNumItems)&&(ii=this._virtualItems[i]).updateFlag==this.itemInfoVer){if(null==ii.obj){for(;reuseIndex<virtualItemCount;){if(null!=(ii2=this._virtualItems[reuseIndex]).obj&&ii2.updateFlag!=this.itemInfoVer){ii2.obj instanceof fgui.GButton&&(ii2.selected=ii2.obj.selected),ii.obj=ii2.obj,ii2.obj=null;break}reuseIndex++}-1==insertIndex&&(insertIndex=this.getChildIndex(lastObj)+1),null==ii.obj?(null!=this.itemProvider&&(null==(url=this.itemProvider.runWith(i%this._numItems))&&(url=this._defaultItem),url=fgui.UIPackage.normalizeURL(url)),ii.obj=this._pool.getObject(url),this.addChildAt(ii.obj,insertIndex)):insertIndex=this.setChildIndexBefore(ii.obj,insertIndex),insertIndex++,ii.obj instanceof fgui.GButton&&(ii.obj.selected=ii.selected),needRender=!0}else needRender=forceUpdate,insertIndex=-1,lastObj=ii.obj;needRender&&(this._autoResizeItem&&(this._curLineItemCount==this._columnCount&&this._curLineItemCount2==this._lineCount?ii.obj.setSize(partWidth,partHeight,!0):this._curLineItemCount==this._columnCount?ii.obj.setSize(partWidth,ii.obj.height,!0):this._curLineItemCount2==this._lineCount&&ii.obj.setSize(ii.obj.width,partHeight,!0)),this.itemRenderer.runWith([i%this._numItems,ii.obj]),ii.width=Math.ceil(ii.obj.width),ii.height=Math.ceil(ii.obj.height))}var borderX=startIndex/pageSize*viewWidth,xx=borderX,yy=0,lineHeight=0;for(i=startIndex;i<lastIndex;i++)i>=this._realNumItems||((ii=this._virtualItems[i]).updateFlag==this.itemInfoVer&&ii.obj.setXY(xx,yy),ii.height>lineHeight&&(lineHeight=ii.height),i%this._curLineItemCount==this._curLineItemCount-1?(xx=borderX,yy+=lineHeight+this._lineGap,lineHeight=0,i==startIndex+pageSize-1&&(xx=borderX+=viewWidth,yy=0)):xx+=ii.width+this._columnGap);for(i=reuseIndex;i<virtualItemCount;i++)(ii=this._virtualItems[i]).updateFlag!=this.itemInfoVer&&null!=ii.obj&&(ii.obj instanceof fgui.GButton&&(ii.selected=ii.obj.selected),this.removeChildToPool(ii.obj),ii.obj=null)}}handleArchOrder1(){if(this.childrenRenderOrder==fgui.ChildrenRenderOrder.Arch){for(var mid=this._scrollPane.posY+this.viewHeight/2,minDist=Number.POSITIVE_INFINITY,dist=0,apexIndex=0,cnt=this.numChildren,i=0;i<cnt;i++){var obj=this.getChildAt(i);this.foldInvisibleItems&&!obj.visible||(dist=Math.abs(mid-obj.y-obj.height/2))<minDist&&(minDist=dist,apexIndex=i)}this.apexIndex=apexIndex}}handleArchOrder2(){if(this.childrenRenderOrder==fgui.ChildrenRenderOrder.Arch){for(var mid=this._scrollPane.posX+this.viewWidth/2,minDist=Number.POSITIVE_INFINITY,dist=0,apexIndex=0,cnt=this.numChildren,i=0;i<cnt;i++){var obj=this.getChildAt(i);this.foldInvisibleItems&&!obj.visible||(dist=Math.abs(mid-obj.x-obj.width/2))<minDist&&(minDist=dist,apexIndex=i)}this.apexIndex=apexIndex}}handleAlign(contentWidth,contentHeight){var newOffsetX=0,newOffsetY=0;contentHeight<this.viewHeight&&("middle"==this._verticalAlign?newOffsetY=Math.floor((this.viewHeight-contentHeight)/2):"bottom"==this._verticalAlign&&(newOffsetY=this.viewHeight-contentHeight)),contentWidth<this.viewWidth&&("center"==this._align?newOffsetX=Math.floor((this.viewWidth-contentWidth)/2):"right"==this._align&&(newOffsetX=this.viewWidth-contentWidth)),newOffsetX==this._alignOffset.x&&newOffsetY==this._alignOffset.y||(this._alignOffset.setTo(newOffsetX,newOffsetY),null!=this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.pos(this._margin.left+this._alignOffset.x,this._margin.top+this._alignOffset.y))}updateBounds(){if(!this._virtual){var i,child,cw,ch,ratio,curX=0,curY=0,maxWidth=0,maxHeight=0,j=0,page=0,k=0,cnt=this._children.length,viewWidth=this.viewWidth,viewHeight=this.viewHeight,lineSize=0,lineStart=0;if(this._layout==fgui.ListLayoutType.SingleColumn){for(i=0;i<cnt;i++)child=this.getChildAt(i),this.foldInvisibleItems&&!child.visible||(0!=curY&&(curY+=this._lineGap),child.y=curY,this._autoResizeItem&&child.setSize(viewWidth,child.height,!0),curY+=Math.ceil(child.height),child.width>maxWidth&&(maxWidth=child.width));cw=Math.ceil(maxWidth),ch=curY}else if(this._layout==fgui.ListLayoutType.SingleRow){for(i=0;i<cnt;i++)child=this.getChildAt(i),this.foldInvisibleItems&&!child.visible||(0!=curX&&(curX+=this._columnGap),child.x=curX,this._autoResizeItem&&child.setSize(child.width,viewHeight,!0),curX+=Math.ceil(child.width),child.height>maxHeight&&(maxHeight=child.height));cw=curX,ch=Math.ceil(maxHeight)}else if(this._layout==fgui.ListLayoutType.FlowHorizontal)if(this._autoResizeItem&&this._columnCount>0){for(i=0;i<cnt;i++)if(child=this.getChildAt(i),(!this.foldInvisibleItems||child.visible)&&(lineSize+=child.sourceWidth,++j==this._columnCount||i==cnt-1)){for(ratio=(viewWidth-lineSize-(j-1)*this._columnGap)/lineSize,curX=0,j=lineStart;j<=i;j++)child=this.getChildAt(j),this.foldInvisibleItems&&!child.visible||(child.setXY(curX,curY),j<i?(child.setSize(child.sourceWidth+Math.round(child.sourceWidth*ratio),child.height,!0),curX+=Math.ceil(child.width)+this._columnGap):child.setSize(viewWidth-curX,child.height,!0),child.height>maxHeight&&(maxHeight=child.height));curY+=Math.ceil(maxHeight)+this._lineGap,maxHeight=0,j=0,lineStart=i+1,lineSize=0}ch=curY+Math.ceil(maxHeight),cw=viewWidth}else{for(i=0;i<cnt;i++)child=this.getChildAt(i),this.foldInvisibleItems&&!child.visible||(0!=curX&&(curX+=this._columnGap),(0!=this._columnCount&&j>=this._columnCount||0==this._columnCount&&curX+child.width>viewWidth&&0!=maxHeight)&&(curX=0,curY+=Math.ceil(maxHeight)+this._lineGap,maxHeight=0,j=0),child.setXY(curX,curY),(curX+=Math.ceil(child.width))>maxWidth&&(maxWidth=curX),child.height>maxHeight&&(maxHeight=child.height),j++);ch=curY+Math.ceil(maxHeight),cw=Math.ceil(maxWidth)}else if(this._layout==fgui.ListLayoutType.FlowVertical)if(this._autoResizeItem&&this._lineCount>0){for(i=0;i<cnt;i++)if(child=this.getChildAt(i),(!this.foldInvisibleItems||child.visible)&&(lineSize+=child.sourceHeight,++j==this._lineCount||i==cnt-1)){for(ratio=(viewHeight-lineSize-(j-1)*this._lineGap)/lineSize,curY=0,j=lineStart;j<=i;j++)child=this.getChildAt(j),this.foldInvisibleItems&&!child.visible||(child.setXY(curX,curY),j<i?(child.setSize(child.width,child.sourceHeight+Math.round(child.sourceHeight*ratio),!0),curY+=Math.ceil(child.height)+this._lineGap):child.setSize(child.width,viewHeight-curY,!0),child.width>maxWidth&&(maxWidth=child.width));curX+=Math.ceil(maxWidth)+this._columnGap,maxWidth=0,j=0,lineStart=i+1,lineSize=0}cw=curX+Math.ceil(maxWidth),ch=viewHeight}else{for(i=0;i<cnt;i++)child=this.getChildAt(i),this.foldInvisibleItems&&!child.visible||(0!=curY&&(curY+=this._lineGap),(0!=this._lineCount&&j>=this._lineCount||0==this._lineCount&&curY+child.height>viewHeight&&0!=maxWidth)&&(curY=0,curX+=Math.ceil(maxWidth)+this._columnGap,maxWidth=0,j=0),child.setXY(curX,curY),(curY+=Math.ceil(child.height))>maxHeight&&(maxHeight=curY),child.width>maxWidth&&(maxWidth=child.width),j++);cw=curX+Math.ceil(maxWidth),ch=Math.ceil(maxHeight)}else{var eachHeight;if(this._autoResizeItem&&this._lineCount>0&&(eachHeight=Math.floor((viewHeight-(this._lineCount-1)*this._lineGap)/this._lineCount)),this._autoResizeItem&&this._columnCount>0){for(i=0;i<cnt;i++)if(child=this.getChildAt(i),(!this.foldInvisibleItems||child.visible)&&(0==j&&(0!=this._lineCount&&k>=this._lineCount||0==this._lineCount&&curY+child.height>viewHeight)&&(page++,curY=0,k=0),lineSize+=child.sourceWidth,++j==this._columnCount||i==cnt-1)){for(ratio=(viewWidth-lineSize-(j-1)*this._columnGap)/lineSize,curX=0,j=lineStart;j<=i;j++)child=this.getChildAt(j),this.foldInvisibleItems&&!child.visible||(child.setXY(page*viewWidth+curX,curY),j<i?(child.setSize(child.sourceWidth+Math.round(child.sourceWidth*ratio),this._lineCount>0?eachHeight:child.height,!0),curX+=Math.ceil(child.width)+this._columnGap):child.setSize(viewWidth-curX,this._lineCount>0?eachHeight:child.height,!0),child.height>maxHeight&&(maxHeight=child.height));curY+=Math.ceil(maxHeight)+this._lineGap,maxHeight=0,j=0,lineStart=i+1,lineSize=0,k++}}else for(i=0;i<cnt;i++)child=this.getChildAt(i),this.foldInvisibleItems&&!child.visible||(0!=curX&&(curX+=this._columnGap),this._autoResizeItem&&this._lineCount>0&&child.setSize(child.width,eachHeight,!0),(0!=this._columnCount&&j>=this._columnCount||0==this._columnCount&&curX+child.width>viewWidth&&0!=maxHeight)&&(curX=0,curY+=Math.ceil(maxHeight)+this._lineGap,maxHeight=0,j=0,k++,(0!=this._lineCount&&k>=this._lineCount||0==this._lineCount&&curY+child.height>viewHeight&&0!=maxWidth)&&(page++,curY=0,k=0)),child.setXY(page*viewWidth+curX,curY),(curX+=Math.ceil(child.width))>maxWidth&&(maxWidth=curX),child.height>maxHeight&&(maxHeight=child.height),j++);ch=page>0?viewHeight:curY+Math.ceil(maxHeight),cw=(page+1)*viewWidth}this.handleAlign(cw,ch),this.setBounds(0,0,cw,ch)}}setup_beforeAdd(buffer,beginPos){var i,j,cnt,i1,nextPos,str;super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),this._layout=buffer.readByte(),this._selectionMode=buffer.readByte(),i1=buffer.readByte(),this._align=0==i1?"left":1==i1?"center":"right",i1=buffer.readByte(),this._verticalAlign=0==i1?"top":1==i1?"middle":"bottom",this._lineGap=buffer.getInt16(),this._columnGap=buffer.getInt16(),this._lineCount=buffer.getInt16(),this._columnCount=buffer.getInt16(),this._autoResizeItem=buffer.readBool(),this._childrenRenderOrder=buffer.readByte(),this._apexIndex=buffer.getInt16(),buffer.readBool()&&(this._margin.top=buffer.getInt32(),this._margin.bottom=buffer.getInt32(),this._margin.left=buffer.getInt32(),this._margin.right=buffer.getInt32());var overflow=buffer.readByte();if(overflow==fgui.OverflowType.Scroll){var savedPos=buffer.pos;buffer.seek(beginPos,7),this.setupScroll(buffer),buffer.pos=savedPos}else this.setupOverflow(overflow);buffer.readBool()&&buffer.skip(8),buffer.seek(beginPos,8),this._defaultItem=buffer.readS();var itemCount=buffer.getInt16();for(i=0;i<itemCount;i++)if(nextPos=buffer.getInt16(),nextPos+=buffer.pos,null!=(str=buffer.readS())||(str=this.defaultItem)){var obj=this.getFromPool(str);if(null!=obj&&(this.addChild(obj),null!=(str=buffer.readS())&&(obj.text=str),null!=(str=buffer.readS())&&obj instanceof fgui.GButton&&(obj.selectedTitle=str),null!=(str=buffer.readS())&&(obj.icon=str),null!=(str=buffer.readS())&&obj instanceof fgui.GButton&&(obj.selectedIcon=str),null!=(str=buffer.readS())&&(obj.name=str),obj instanceof fgui.GComponent))for(cnt=buffer.getInt16(),j=0;j<cnt;j++){var cc=obj.getController(buffer.readS());str=buffer.readS(),null!=cc&&(cc.selectedPageId=str)}buffer.pos=nextPos}else buffer.pos=nextPos}setup_afterAdd(buffer,beginPos){super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6);var i=buffer.getInt16();-1!=i&&(this._selectionController=this._parent.getControllerAt(i))}}fgui.GList=GList;class ItemInfo{constructor(){this.width=0,this.height=0,this.updateFlag=0,this.selected=!1}}}(fgui||(fgui={})),function(fgui){fgui.GObjectPool=class{constructor(){this._count=0,this._pool={}}clear(){for(var i1 in this._pool)for(var arr=this._pool[i1],cnt=arr.length,i=0;i<cnt;i++)arr[i].dispose();this._pool={},this._count=0}get count(){return this._count}getObject(url){if(null==(url=fgui.UIPackage.normalizeURL(url)))return null;var arr=this._pool[url];return null!=arr&&arr.length>0?(this._count--,arr.shift()):fgui.UIPackage.createObjectFromURL(url)}returnObject(obj){var url=obj.resourceURL;if(url){var arr=this._pool[url];null==arr&&(arr=[],this._pool[url]=arr),this._count++,arr.push(obj)}}}}(fgui||(fgui={})),function(fgui){class GLoader extends fgui.GObject{constructor(){super(),this._contentSourceWidth=0,this._contentSourceHeight=0,this._contentWidth=0,this._contentHeight=0,this._url="",this._fill=fgui.LoaderFillType.None,this._align="left",this._valign="top",this._showErrorSign=!0}createDisplayObject(){super.createDisplayObject(),this._content=new fgui.MovieClip,this._displayObject.addChild(this._content),this._displayObject.mouseEnabled=!0}dispose(){null==this._contentItem&&null!=this._content.texture&&this.freeExternal(this._content.texture),null!=this._content2&&this._content2.dispose(),super.dispose()}get url(){return this._url}set url(value){this._url!=value&&(this._url=value,this.loadContent(),this.updateGear(7))}get icon(){return this._url}set icon(value){this.url=value}get align(){return this._align}set align(value){this._align!=value&&(this._align=value,this.updateLayout())}get verticalAlign(){return this._valign}set verticalAlign(value){this._valign!=value&&(this._valign=value,this.updateLayout())}get fill(){return this._fill}set fill(value){this._fill!=value&&(this._fill=value,this.updateLayout())}get shrinkOnly(){return this._shrinkOnly}set shrinkOnly(value){this._shrinkOnly!=value&&(this._shrinkOnly=value,this.updateLayout())}get autoSize(){return this._autoSize}set autoSize(value){this._autoSize!=value&&(this._autoSize=value,this.updateLayout())}get playing(){return this._content.playing}set playing(value){this._content.playing!=value&&(this._content.playing=value,this.updateGear(5))}get frame(){return this._content.frame}set frame(value){this._content.frame!=value&&(this._content.frame=value,this.updateGear(5))}get color(){return this._content.color}set color(value){this._content.color!=value&&(this._content.color=value,this.updateGear(4))}get showErrorSign(){return this._showErrorSign}set showErrorSign(value){this._showErrorSign=value}get content(){return this._content}get component(){return this._content2}loadContent(){this.clearContent(),this._url&&(fgui.ToolSet.startsWith(this._url,"ui://")?this.loadFromPackage(this._url):this.loadExternal())}loadFromPackage(itemURL){if(this._contentItem=fgui.UIPackage.getItemByURL(itemURL),null!=this._contentItem)if(this._contentItem.load(),this._autoSize&&this.setSize(this._contentItem.width,this._contentItem.height),this._contentItem.type==fgui.PackageItemType.Image)null==this._contentItem.texture?this.setErrorState():(this._content.texture=this._contentItem.texture,this._content.scale9Grid=this._contentItem.scale9Grid,this._content.scaleByTile=this._contentItem.scaleByTile,this._content.tileGridIndice=this._contentItem.tileGridIndice,this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this.updateLayout());else if(this._contentItem.type==fgui.PackageItemType.MovieClip)this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this._content.interval=this._contentItem.interval,this._content.swing=this._contentItem.swing,this._content.repeatDelay=this._contentItem.repeatDelay,this._content.frames=this._contentItem.frames,this.updateLayout();else if(this._contentItem.type==fgui.PackageItemType.Component){var obj=fgui.UIPackage.createObjectFromURL(itemURL);obj?obj instanceof fgui.GComponent?(this._content2=obj.asCom,this._displayObject.addChild(this._content2.displayObject),this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this.updateLayout()):(obj.dispose(),this.setErrorState()):this.setErrorState()}else this.setErrorState();else this.setErrorState()}loadExternal(){fgui.AssetProxy.inst.load(this._url,Laya.Handler.create(this,this.__getResCompleted),null,Laya.Loader.IMAGE)}freeExternal(texture){}onExternalLoadSuccess(texture){this._content.texture=texture,this._content.scale9Grid=null,this._content.scaleByTile=!1,this._contentSourceWidth=texture.width,this._contentSourceHeight=texture.height,this.updateLayout()}onExternalLoadFailed(){this.setErrorState()}__getResCompleted(tex){null!=tex?this.onExternalLoadSuccess(tex):this.onExternalLoadFailed()}setErrorState(){this._showErrorSign&&(null==this._errorSign&&null!=fgui.UIConfig.loaderErrorSign&&(this._errorSign=GLoader._errorSignPool.getObject(fgui.UIConfig.loaderErrorSign)),null!=this._errorSign&&(this._errorSign.setSize(this.width,this.height),this._displayObject.addChild(this._errorSign.displayObject)))}clearErrorState(){null!=this._errorSign&&(this._displayObject.removeChild(this._errorSign.displayObject),GLoader._errorSignPool.returnObject(this._errorSign),this._errorSign=null)}updateLayout(){if(null!=this._content2||null!=this._content.texture||null!=this._content.frames)if(this._contentWidth=this._contentSourceWidth,this._contentHeight=this._contentSourceHeight,this._autoSize&&(this._updatingLayout=!0,0==this._contentWidth&&(this._contentWidth=50),0==this._contentHeight&&(this._contentHeight=30),this.setSize(this._contentWidth,this._contentHeight),this._updatingLayout=!1,this._contentWidth==this._width&&this._contentHeight==this._height))null!=this._content2?(this._content2.setXY(0,0),this._content2.setScale(1,1)):(this._content.size(this._contentWidth,this._contentHeight),this._content.pos(0,0));else{var nx,ny,sx=1,sy=1;this._fill!=fgui.LoaderFillType.None&&(sx=this.width/this._contentSourceWidth,sy=this.height/this._contentSourceHeight,1==sx&&1==sy||(this._fill==fgui.LoaderFillType.ScaleMatchHeight?sx=sy:this._fill==fgui.LoaderFillType.ScaleMatchWidth?sy=sx:this._fill==fgui.LoaderFillType.Scale?sx>sy?sx=sy:sy=sx:this._fill==fgui.LoaderFillType.ScaleNoBorder&&(sx>sy?sy=sx:sx=sy),this._shrinkOnly&&(sx>1&&(sx=1),sy>1&&(sy=1)),this._contentWidth=this._contentSourceWidth*sx,this._contentHeight=this._contentSourceHeight*sy)),null!=this._content2?this._content2.setScale(sx,sy):this._content.size(this._contentWidth,this._contentHeight),nx="center"==this._align?Math.floor((this.width-this._contentWidth)/2):"right"==this._align?this.width-this._contentWidth:0,ny="middle"==this._valign?Math.floor((this.height-this._contentHeight)/2):"bottom"==this._valign?this.height-this._contentHeight:0,null!=this._content2?this._content2.setXY(nx,ny):this._content.pos(nx,ny)}else this._autoSize&&(this._updatingLayout=!0,this.setSize(50,30),this._updatingLayout=!1)}clearContent(){this.clearErrorState(),null==this._contentItem&&null!=this._content.texture&&this.freeExternal(this._content.texture),this._content.texture=null,this._content.frames=null,null!=this._content2&&(this._content2.dispose(),this._content2=null),this._contentItem=null}handleSizeChanged(){super.handleSizeChanged(),this._updatingLayout||this.updateLayout()}getProp(index){switch(index){case fgui.ObjectPropID.Color:return this.color;case fgui.ObjectPropID.Playing:return this.playing;case fgui.ObjectPropID.Frame:return this.frame;case fgui.ObjectPropID.TimeScale:return this._content.timeScale;default:return super.getProp(index)}}setProp(index,value){switch(index){case fgui.ObjectPropID.Color:this.color=value;break;case fgui.ObjectPropID.Playing:this.playing=value;break;case fgui.ObjectPropID.Frame:this.frame=value;break;case fgui.ObjectPropID.TimeScale:this._content.timeScale=value;break;case fgui.ObjectPropID.DeltaTime:this._content.advance(value);break;default:super.setProp(index,value)}}setup_beforeAdd(buffer,beginPos){var iv;super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),this._url=buffer.readS(),iv=buffer.readByte(),this._align=0==iv?"left":1==iv?"center":"right",iv=buffer.readByte(),this._valign=0==iv?"top":1==iv?"middle":"bottom",this._fill=buffer.readByte(),this._shrinkOnly=buffer.readBool(),this._autoSize=buffer.readBool(),this._showErrorSign=buffer.readBool(),this._content.playing=buffer.readBool(),this._content.frame=buffer.getInt32(),buffer.readBool()&&(this.color=buffer.readColorS()),0!=buffer.readByte()&&buffer.skip(6),this._url&&this.loadContent()}}GLoader._errorSignPool=new fgui.GObjectPool,fgui.GLoader=GLoader}(fgui||(fgui={})),function(fgui){fgui.GMovieClip=class extends fgui.GObject{constructor(){super()}get color(){return"#FFFFFF"}set color(value){}createDisplayObject(){this._displayObject=this._movieClip=new fgui.MovieClip,this._movieClip.mouseEnabled=!1,this._displayObject.$owner=this}get playing(){return this._movieClip.playing}set playing(value){this._movieClip.playing!=value&&(this._movieClip.playing=value,this.updateGear(5))}get frame(){return this._movieClip.frame}set frame(value){this._movieClip.frame!=value&&(this._movieClip.frame=value,this.updateGear(5))}get timeScale(){return this._movieClip.timeScale}set timeScale(value){this._movieClip.timeScale=value}rewind(){this._movieClip.rewind()}syncStatus(anotherMc){this._movieClip.syncStatus(anotherMc._movieClip)}advance(timeInMiniseconds){this._movieClip.advance(timeInMiniseconds)}setPlaySettings(start=0,end=-1,times=0,endAt=-1,endHandler=null){this._movieClip.setPlaySettings(start,end,times,endAt,endHandler)}getProp(index){switch(index){case fgui.ObjectPropID.Color:return this.color;case fgui.ObjectPropID.Playing:return this.playing;case fgui.ObjectPropID.Frame:return this.frame;case fgui.ObjectPropID.TimeScale:return this.timeScale;default:return super.getProp(index)}}setProp(index,value){switch(index){case fgui.ObjectPropID.Color:this.color=value;break;case fgui.ObjectPropID.Playing:this.playing=value;break;case fgui.ObjectPropID.Frame:this.frame=value;break;case fgui.ObjectPropID.TimeScale:this.timeScale=value;break;case fgui.ObjectPropID.DeltaTime:this.advance(value);break;default:super.setProp(index,value)}}constructFromResource(){this.sourceWidth=this.packageItem.width,this.sourceHeight=this.packageItem.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),this.packageItem.load(),this._movieClip.interval=this.packageItem.interval,this._movieClip.swing=this.packageItem.swing,this._movieClip.repeatDelay=this.packageItem.repeatDelay,this._movieClip.frames=this.packageItem.frames}setup_beforeAdd(buffer,beginPos){super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),buffer.readBool()&&(this.color=buffer.readColorS()),buffer.readByte(),this._movieClip.frame=buffer.getInt32(),this._movieClip.playing=buffer.readBool()}}}(fgui||(fgui={})),function(fgui){fgui.GProgressBar=class extends fgui.GComponent{constructor(){super(),this._max=0,this._value=0,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._barStartX=0,this._barStartY=0,this._titleType=fgui.ProgressTitleType.Percent,this._value=50,this._max=100}get titleType(){return this._titleType}set titleType(value){this._titleType!=value&&(this._titleType=value,this.update(value))}get max(){return this._max}set max(value){this._max!=value&&(this._max=value,this.update(value))}get value(){return this._value}set value(value){this._value!=value&&(fgui.GTween.kill(this,!1,this.update),this._value=value,this.update(value))}tweenValue(value,duration){var oldValule,tweener=fgui.GTween.getTween(this,this.update);return null!=tweener?(oldValule=tweener.value.x,tweener.kill()):oldValule=this._value,this._value=value,fgui.GTween.to(oldValule,this._value,duration).setTarget(this,this.update).setEase(fgui.EaseType.Linear)}update(newValue){var percent=0!=this._max?Math.min(newValue/this._max,1):0;if(this._titleObject)switch(this._titleType){case fgui.ProgressTitleType.Percent:this._titleObject.text=Math.round(100*percent)+"%";break;case fgui.ProgressTitleType.ValueAndMax:this._titleObject.text=Math.round(newValue)+"/"+Math.round(this._max);break;case fgui.ProgressTitleType.Value:this._titleObject.text=""+Math.round(newValue);break;case fgui.ProgressTitleType.Max:this._titleObject.text=""+Math.round(this._max)}var fullWidth=this.width-this._barMaxWidthDelta,fullHeight=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH instanceof fgui.GImage&&this._barObjectH.fillMethod!=fgui.FillMethod.None?this._barObjectH.fillAmount=1-percent:(this._barObjectH.width=Math.round(fullWidth*percent),this._barObjectH.x=this._barStartX+(fullWidth-this._barObjectH.width))),this._barObjectV&&(this._barObjectV instanceof fgui.GImage&&this._barObjectV.fillMethod!=fgui.FillMethod.None?this._barObjectV.fillAmount=1-percent:(this._barObjectV.height=Math.round(fullHeight*percent),this._barObjectV.y=this._barStartY+(fullHeight-this._barObjectV.height)))):(this._barObjectH&&(this._barObjectH instanceof fgui.GImage&&this._barObjectH.fillMethod!=fgui.FillMethod.None?this._barObjectH.fillAmount=percent:this._barObjectH.width=Math.round(fullWidth*percent)),this._barObjectV&&(this._barObjectV instanceof fgui.GImage&&this._barObjectV.fillMethod!=fgui.FillMethod.None?this._barObjectV.fillAmount=percent:this._barObjectV.height=Math.round(fullHeight*percent))),this._aniObject instanceof fgui.GMovieClip&&(this._aniObject.frame=Math.round(100*percent))}constructExtension(buffer){buffer.seek(0,6),this._titleType=buffer.readByte(),this._reverse=buffer.readBool(),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._aniObject=this.getChild("ani"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y)}handleSizeChanged(){super.handleSizeChanged(),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update(this._value)}setup_afterAdd(buffer,beginPos){super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6)&&buffer.readByte()==this.packageItem.objectType?(this._value=buffer.getInt32(),this._max=buffer.getInt32(),this.update(this._value)):this.update(this._value)}}}(fgui||(fgui={})),function(fgui){fgui.GTextField=class extends fgui.GObject{constructor(){super(),this._gearColor=new fgui.GearColor(this)}get font(){return null}set font(value){}get fontSize(){return 0}set fontSize(value){}get color(){return null}set color(value){}get align(){return null}set align(value){}get valign(){return null}set valign(value){}get leading(){return 0}set leading(value){}get letterSpacing(){return 0}set letterSpacing(value){}get bold(){return!1}set bold(value){}get italic(){return!1}set italic(value){}get underline(){return!1}set underline(value){}get singleLine(){return!1}set singleLine(value){}get stroke(){return 0}set stroke(value){}get strokeColor(){return null}set strokeColor(value){}set ubbEnabled(value){}get ubbEnabled(){return!1}get autoSize(){return fgui.AutoSizeType.None}set autoSize(value){}get textWidth(){return 0}parseTemplate(template){for(var pos2,pos3,tag,value,pos1=0,result="";-1!=(pos2=template.indexOf("{",pos1));)if(pos2>0&&92==template.charCodeAt(pos2-1))result+=template.substring(pos1,pos2-1),result+="{",pos1=pos2+1;else{if(result+=template.substring(pos1,pos2),pos1=pos2,-1==(pos2=template.indexOf("}",pos1)))break;pos2!=pos1+1?(-1!=(pos3=(tag=template.substring(pos1+1,pos2)).indexOf("="))?result+=null==(value=this._templateVars[tag.substring(0,pos3)])?tag.substring(pos3+1):value:null!=(value=this._templateVars[tag])&&(result+=value),pos1=pos2+1):(result+=template.substr(pos1,2),pos1=pos2+1)}return pos1<template.length&&(result+=template.substr(pos1)),result}get templateVars(){return this._templateVars}set templateVars(value){null==this._templateVars&&null==value||(this._templateVars=value,this.flushVars())}setVar(name,value){return this._templateVars||(this._templateVars={}),this._templateVars[name]=value,this}flushVars(){this.text=this._text}handleControllerChanged(c){super.handleControllerChanged(c),this._gearColor.controller==c&&this._gearColor.apply()}getProp(index){switch(index){case fgui.ObjectPropID.Color:return this.color;case fgui.ObjectPropID.OutlineColor:return this.strokeColor;case fgui.ObjectPropID.FontSize:return this.fontSize;default:return super.getProp(index)}}setProp(index,value){switch(index){case fgui.ObjectPropID.Color:this.color=value;break;case fgui.ObjectPropID.OutlineColor:this.strokeColor=value;break;case fgui.ObjectPropID.FontSize:this.fontSize=value;break;default:super.setProp(index,value)}}setup_beforeAdd(buffer,beginPos){var iv;super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,5),this.font=buffer.readS(),this.fontSize=buffer.getInt16(),this.color=buffer.readColorS(),iv=buffer.readByte(),this.align=0==iv?"left":1==iv?"center":"right",iv=buffer.readByte(),this.valign=0==iv?"top":1==iv?"middle":"bottom",this.leading=buffer.getInt16(),this.letterSpacing=buffer.getInt16(),this.ubbEnabled=buffer.readBool(),this.autoSize=buffer.readByte(),this.underline=buffer.readBool(),this.italic=buffer.readBool(),this.bold=buffer.readBool(),this.singleLine=buffer.readBool(),buffer.readBool()&&(this.strokeColor=buffer.readColorS(),this.stroke=buffer.getFloat32()+1),buffer.readBool()&&buffer.skip(12),buffer.readBool()&&(this._templateVars={})}setup_afterAdd(buffer,beginPos){super.setup_afterAdd(buffer,beginPos),buffer.seek(beginPos,6);var str=buffer.readS();null!=str&&(this.text=str)}}}(fgui||(fgui={})),function(fgui){class GBasicTextField extends fgui.GTextField{constructor(){super(),this._letterSpacing=0,this._textWidth=0,this._textHeight=0,this._text="",this._color="#000000",this.textField.align="left",this.textField.font=fgui.UIConfig.defaultFont,this._autoSize=fgui.AutoSizeType.Both,this._widthAutoSize=this._heightAutoSize=!0,this.textField._sizeDirty=!1}createDisplayObject(){this._displayObject=this.textField=new TextExt(this),this._displayObject.$owner=this,this._displayObject.mouseEnabled=!1}set text(value){if(this._text=value,null==this._text&&(this._text=""),null==this._bitmapFont){this._widthAutoSize&&(this.textField.width=1e4);var text2=this._text;null!=this._templateVars&&(text2=this.parseTemplate(text2)),this._ubbEnabled?this.textField.text=fgui.ToolSet.removeUBB(fgui.ToolSet.encodeHTML(text2)):this.textField.text=text2}else this.textField.text="",this.textField.setChanged();this.parent&&this.parent._underConstruct&&this.textField.typeset()}get text(){return this._text}get font(){return this.textField.font}set font(value){this._font=value,fgui.ToolSet.startsWith(this._font,"ui://")?this._bitmapFont=fgui.UIPackage.getItemAssetByURL(this._font):this._bitmapFont=null,null!=this._bitmapFont?this.textField.setChanged():this._font?this.textField.font=this._font:this.textField.font=fgui.UIConfig.defaultFont}get fontSize(){return this.textField.fontSize}set fontSize(value){this.textField.fontSize=value}get color(){return this._color}set color(value){this._color!=value&&(this._color=value,this._gearColor.controller&&this._gearColor.updateState(),this.grayed?this.textField.color="#AAAAAA":this.textField.color=this._color)}get align(){return this.textField.align}set align(value){this.textField.align=value}get valign(){return this.textField.valign}set valign(value){this.textField.valign=value}get leading(){return this.textField.leading}set leading(value){this.textField.leading=value}get letterSpacing(){return this._letterSpacing}set letterSpacing(value){this._letterSpacing=value}get bold(){return this.textField.bold}set bold(value){this.textField.bold=value}get italic(){return this.textField.italic}set italic(value){this.textField.italic=value}get underline(){return this.textField.underline}set underline(value){this.textField.underline=value}get singleLine(){return this._singleLine}set singleLine(value){this._singleLine=value,this.textField.wordWrap=!this._widthAutoSize&&!this._singleLine}get stroke(){return this.textField.stroke}set stroke(value){this.textField.stroke=value}get strokeColor(){return this.textField.strokeColor}set strokeColor(value){this.textField.strokeColor=value,this.updateGear(4)}set ubbEnabled(value){this._ubbEnabled=value}get ubbEnabled(){return this._ubbEnabled}set autoSize(value){this._autoSize!=value&&this.setAutoSize(value)}setAutoSize(value){this._autoSize=value,this._widthAutoSize=value==fgui.AutoSizeType.Both,this._heightAutoSize=value==fgui.AutoSizeType.Both||value==fgui.AutoSizeType.Height,this.textField.wordWrap=!this._widthAutoSize&&!this._singleLine,this._underConstruct||(this._heightAutoSize?this._widthAutoSize||(this.textField.width=this.width):this.textField.size(this.width,this.height))}get autoSize(){return this._autoSize}get textWidth(){return this.textField._isChanged&&this.textField.typeset(),this._textWidth}ensureSizeCorrect(){!this._underConstruct&&this.textField._isChanged&&this.textField.typeset()}typeset(){null!=this._bitmapFont?this.renderWithBitmapFont():(this._widthAutoSize||this._heightAutoSize)&&this.updateSize()}updateSize(){this._textWidth=Math.ceil(this.textField.textWidth),this._textHeight=Math.ceil(this.textField.textHeight);var w,h=0;this._widthAutoSize?(w=this._textWidth,this.textField.width!=w&&(this.textField.width=w,"left"!=this.textField.align&&this.textField.baseTypeset())):w=this.width,this._heightAutoSize?(h=this._textHeight,this._widthAutoSize||this.textField.height!=this._textHeight&&(this.textField.height=this._textHeight)):(h=this.height,this._textHeight>h&&(this._textHeight=h),this.textField.height!=this._textHeight&&(this.textField.height=this._textHeight)),this._updatingSize=!0,this.setSize(w,h),this._updatingSize=!1}renderWithBitmapFont(){var gr=this._displayObject.graphics;gr.clear(),this._lines?LineInfo.returnList(this._lines):this._lines=new Array;this.letterSpacing;var line,lineSpacing=this.leading-1,rectWidth=this.width-2*GBasicTextField.GUTTER_X,lineWidth=0,lineHeight=0,lineTextHeight=0,glyphWidth=0,glyphHeight=0,wordChars=0,wordStart=0,wordEnd=0,lastLineHeight=0,lineBuffer="",lineY=GBasicTextField.GUTTER_Y,wordWrap=!this._widthAutoSize&&!this._singleLine,fontScale=(this.fontSize,this._bitmapFont.resizable?this.fontSize/this._bitmapFont.size:1);this._textWidth=0,this._textHeight=0;var text2=this._text;null!=this._templateVars&&(text2=this.parseTemplate(text2));for(var textLength=text2.length,offset=0;offset<textLength;++offset){var ch=text2.charAt(offset),cc=ch.charCodeAt(0);if(10!=cc){if(cc>=65&&cc<=90||cc>=97&&cc<=122?(0==wordChars&&(wordStart=lineWidth),wordChars++):(wordChars>0&&(wordEnd=lineWidth),wordChars=0),32==cc)glyphWidth=Math.ceil(this.fontSize/2),glyphHeight=this.fontSize;else{var glyph=this._bitmapFont.glyphs[ch];glyph?(glyphWidth=Math.ceil(glyph.advance*fontScale),glyphHeight=Math.ceil(glyph.lineHeight*fontScale)):(glyphWidth=0,glyphHeight=0)}if(glyphHeight>lineTextHeight&&(lineTextHeight=glyphHeight),glyphHeight>lineHeight&&(lineHeight=glyphHeight),0!=lineWidth&&(lineWidth+=this.letterSpacing),lineWidth+=glyphWidth,!wordWrap||lineWidth<=rectWidth)lineBuffer+=ch;else{if((line=LineInfo.borrow()).height=lineHeight,line.textHeight=lineTextHeight,0==lineBuffer.length)line.text=ch;else if(wordChars>0&&wordEnd>0){var len=(lineBuffer+=ch).length-wordChars;line.text=fgui.ToolSet.trimRight(lineBuffer.substr(0,len)),line.width=wordEnd,lineBuffer=lineBuffer.substr(len),lineWidth-=wordStart}else line.text=lineBuffer,line.width=lineWidth-(glyphWidth+this.letterSpacing),lineBuffer=ch,lineWidth=glyphWidth,lineHeight=glyphHeight,lineTextHeight=glyphHeight;line.y=lineY,lineY+=line.height+lineSpacing,line.width>this._textWidth&&(this._textWidth=line.width),wordChars=0,wordStart=0,wordEnd=0,this._lines.push(line)}}else lineBuffer+=ch,(line=LineInfo.borrow()).width=lineWidth,0==lineTextHeight&&(0==lastLineHeight&&(lastLineHeight=this.fontSize),0==lineHeight&&(lineHeight=lastLineHeight),lineTextHeight=lineHeight),line.height=lineHeight,lastLineHeight=lineHeight,line.textHeight=lineTextHeight,line.text=lineBuffer,line.y=lineY,lineY+=line.height+lineSpacing,line.width>this._textWidth&&(this._textWidth=line.width),this._lines.push(line),lineBuffer="",lineWidth=0,lineHeight=0,lineTextHeight=0,wordChars=0,wordStart=0,wordEnd=0}lineBuffer.length>0&&((line=LineInfo.borrow()).width=lineWidth,0==lineHeight&&(lineHeight=lastLineHeight),0==lineTextHeight&&(lineTextHeight=lineHeight),line.height=lineHeight,line.textHeight=lineTextHeight,line.text=lineBuffer,line.y=lineY,line.width>this._textWidth&&(this._textWidth=line.width),this._lines.push(line)),this._textWidth>0&&(this._textWidth+=2*GBasicTextField.GUTTER_X),0==this._lines.length?this._textHeight=0:(line=this._lines[this._lines.length-1],this._textHeight=line.y+line.height+GBasicTextField.GUTTER_Y);var w,h=0;if(w=this._widthAutoSize?0==this._textWidth?0:this._textWidth:this.width,h=this._heightAutoSize?0==this._textHeight?0:this._textHeight:this.height,this._updatingSize=!0,this.setSize(w,h),this._updatingSize=!1,this.doAlign(),0!=w&&0!=h){var charX=GBasicTextField.GUTTER_X,lineIndent=0,charIndent=0;rectWidth=this.width-2*GBasicTextField.GUTTER_X;for(var lineCount=this._lines.length,i=0;i<lineCount;i++){line=this._lines[i],charX=GBasicTextField.GUTTER_X,lineIndent="center"==this.align?(rectWidth-line.width)/2:"right"==this.align?rectWidth-line.width:0,textLength=line.text.length;for(var j=0;j<textLength;j++)10!=(cc=(ch=line.text.charAt(j)).charCodeAt(0))&&(32!=cc?null!=(glyph=this._bitmapFont.glyphs[ch])?(charIndent=(line.height+line.textHeight)/2-Math.ceil(glyph.lineHeight*fontScale),glyph.texture&&gr.drawTexture(glyph.texture,charX+lineIndent+Math.ceil(glyph.offsetX*fontScale),line.y+charIndent+Math.ceil(glyph.offsetY*fontScale),glyph.texture.width*fontScale,glyph.texture.height*fontScale),charX+=this.letterSpacing+Math.ceil(glyph.advance*fontScale)):charX+=this.letterSpacing:charX+=this._letterSpacing+Math.ceil(this.fontSize/2))}}}handleSizeChanged(){this._updatingSize||(this._underConstruct?this.textField.size(this.width,this.height):null!=this._bitmapFont?this._widthAutoSize?this.doAlign():this.textField.setChanged():this._widthAutoSize||(this._heightAutoSize?this.textField.width=this.width:this.textField.size(this.width,this.height)))}handleGrayedChanged(){super.handleGrayedChanged(),this.grayed?this.textField.color="#AAAAAA":this.textField.color=this._color}doAlign(){if("top"==this.valign||0==this._textHeight)this._yOffset=GBasicTextField.GUTTER_Y;else{var dh=this.height-this._textHeight;dh<0&&(dh=0),"middle"==this.valign?this._yOffset=Math.floor(dh/2):this._yOffset=Math.floor(dh)}this.handleXYChanged()}flushVars(){this.text=this._text}}GBasicTextField.GUTTER_X=2,GBasicTextField.GUTTER_Y=2,fgui.GBasicTextField=GBasicTextField;class LineInfo{constructor(){this.width=0,this.height=0,this.textHeight=0,this.y=0}static borrow(){if(LineInfo.pool.length){var ret=LineInfo.pool.pop();return ret.width=0,ret.height=0,ret.textHeight=0,ret.text=null,ret.y=0,ret}return new LineInfo}static returns(value){LineInfo.pool.push(value)}static returnList(value){for(var length=value.length,i=0;i<length;i++){var li=value[i];LineInfo.pool.push(li)}value.length=0}}LineInfo.pool=[];class TextExt extends Laya.Text{constructor(owner){super(),this._owner=owner}baseTypeset(){this._lock=!0,this.typeset(),this._lock=!1}typeset(){this._sizeDirty=!0,super.typeset(),this._lock||this._owner.typeset(),this._isChanged&&(Laya.timer.clear(this,this.typeset),this._isChanged=!1),this._sizeDirty=!1}setChanged(){this.isChanged=!0}set isChanged(value){value&&!this._sizeDirty&&this._owner.autoSize!=fgui.AutoSizeType.None&&this._owner.parent&&(this._sizeDirty=!0,this.event(fgui.Events.SIZE_DELAY_CHANGE)),super.isChanged=value}}}(fgui||(fgui={})),function(fgui){fgui.GRichTextField=class extends fgui.GTextField{constructor(){super(),this._text=""}createDisplayObject(){this._displayObject=this.div=new Laya.HTMLDivElement,this._displayObject.mouseEnabled=!0,this._displayObject.$owner=this}set text(value){this._text=value;var text2=this._text;null!=this._templateVars&&(text2=this.parseTemplate(text2));try{this._ubbEnabled?this.div.innerHTML=fgui.ToolSet.parseUBB(text2):this.div.innerHTML=text2}catch(err){Laya.Log.print(err)}}get text(){return this._text}get font(){return this.div.style.font}set font(value){this.div.style.font=value||fgui.UIConfig.defaultFont}get fontSize(){return this.div.style.fontSize}set fontSize(value){this.div.style.fontSize=value}get color(){return this._color}set color(value){this._color!=value&&(this._color=value,this.div.style.color=value,this._gearColor.controller&&this._gearColor.updateState())}get align(){return this.div.style.align}set align(value){this.div.style.align=value}get valign(){return this.div.style.valign}set valign(value){this.div.style.valign=value}get leading(){return this.div.style.leading}set leading(value){this.div.style.leading=value}get bold(){return this.div.style.bold}set bold(value){this.div.style.bold=value}get italic(){return this.div.style.italic}set italic(value){this.div.style.italic=value}get stroke(){return this.div.style.stroke}set stroke(value){this.div.style.stroke=value}get strokeColor(){return this.div.style.strokeColor}set strokeColor(value){this.div.style.strokeColor=value,this.updateGear(4)}set ubbEnabled(value){this._ubbEnabled=value}get ubbEnabled(){return this._ubbEnabled}handleSizeChanged(){this.div.size(this.width,this.height),this.div.style.width=this.width,this.div.style.height=this.height}}}(fgui||(fgui={})),function(fgui){fgui.GTextInput=class extends fgui.GTextField{constructor(){super()}createDisplayObject(){this._displayObject=this.input=new Laya.Input,this._displayObject.mouseEnabled=!0,this._displayObject.$owner=this}set text(value){this.input.text=value}get text(){return this.input.text}get font(){return this.input.font}set font(value){this.input.font=value}get fontSize(){return this.input.fontSize}set fontSize(value){this.input.fontSize=value}get color(){return this.input.color}set color(value){this.input.color=value}get align(){return this.input.align}set align(value){this.input.align=value}get valign(){return this.input.valign}set valign(value){this.input.valign=value}get leading(){return this.input.leading}set leading(value){this.input.leading=value}get bold(){return this.input.bold}set bold(value){this.input.bold=value}get italic(){return this.input.italic}set italic(value){this.input.italic=value}get singleLine(){return!this.input.multiline}set singleLine(value){this.input.multiline=!value}get stroke(){return this.input.stroke}set stroke(value){this.input.stroke=value}get strokeColor(){return this.input.strokeColor}set strokeColor(value){this.input.strokeColor=value,this.updateGear(4)}get password(){return"password"==this.input.type}set password(value){this.input.type=value?"password":"text"}get keyboardType(){return this.input.type}set keyboardType(value){this.input.type=value}set editable(value){this.input.editable=value}get editable(){return this.input.editable}set maxLength(value){this.input.maxChars=value}get maxLength(){return this.input.maxChars}set promptText(value){this.input.prompt=value}get promptText(){return this.input.prompt}set restrict(value){this.input.restrict=value}get restrict(){return this.input.restrict}get textWidth(){return this.input.textWidth}handleSizeChanged(){this.input.size(this.width,this.height)}setup_beforeAdd(buffer,beginPos){super.setup_beforeAdd(buffer,beginPos),buffer.seek(beginPos,4);var str=buffer.readS();null!=str&&(this.promptText=str),null!=(str=buffer.readS())&&(this.input.restrict=str);var iv=buffer.getInt32();0!=iv&&(this.input.maxChars=iv),0!=(iv=buffer.getInt32())&&(4==iv?this.keyboardType=Laya.Input.TYPE_NUMBER:3==iv&&(this.keyboardType=Laya.Input.TYPE_URL)),buffer.readBool()&&(this.password=!0)}}}(fgui||(fgui={})),function(fgui){class GRoot extends fgui.GComponent{constructor(){super(),null==GRoot._inst&&(GRoot._inst=this),this.opaque=!1,this._popupStack=[],this._justClosedPopups=[],this.displayObject.once(Laya.Event.DISPLAY,this,this.__addedToStage)}static get inst(){return null==GRoot._inst&&new GRoot,GRoot._inst}showWindow(win){this.addChild(win),win.requestFocus(),win.x>this.width?win.x=this.width-win.width:win.x+win.width<0&&(win.x=0),win.y>this.height?win.y=this.height-win.height:win.y+win.height<0&&(win.y=0),this.adjustModalLayer()}hideWindow(win){win.hide()}hideWindowImmediately(win){win.parent==this&&this.removeChild(win),this.adjustModalLayer()}bringToFront(win){var i,cnt=this.numChildren;for(i=null==this._modalLayer.parent||win.modal?cnt-1:this.getChildIndex(this._modalLayer)-1;i>=0;i--){var g=this.getChildAt(i);if(g==win)return;if(g instanceof fgui.Window)break}i>=0&&this.setChildIndex(win,i)}showModalWait(msg=null){null!=fgui.UIConfig.globalModalWaiting&&(null==this._modalWaitPane&&(this._modalWaitPane=fgui.UIPackage.createObjectFromURL(fgui.UIConfig.globalModalWaiting)),this._modalWaitPane.setSize(this.width,this.height),this._modalWaitPane.addRelation(this,fgui.RelationType.Size),this.addChild(this._modalWaitPane),this._modalWaitPane.text=msg)}closeModalWait(){null!=this._modalWaitPane&&null!=this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane)}closeAllExceptModals(){for(var arr=this._children.slice(),cnt=arr.length,i=0;i<cnt;i++){var g=arr[i];g instanceof fgui.Window&&!g.modal&&g.hide()}}closeAllWindows(){for(var arr=this._children.slice(),cnt=arr.length,i=0;i<cnt;i++){var g=arr[i];g instanceof fgui.Window&&g.hide()}}getTopWindow(){for(var i=this.numChildren-1;i>=0;i--){var g=this.getChildAt(i);if(g instanceof fgui.Window)return g}return null}get modalLayer(){return this._modalLayer}get hasModalWindow(){return null!=this._modalLayer.parent}get modalWaiting(){return this._modalWaitPane&&this._modalWaitPane.inContainer}showPopup(popup,target=null,downward=null){if(this._popupStack.length>0){var k=this._popupStack.indexOf(popup);if(-1!=k)for(var i=this._popupStack.length-1;i>=k;i--)this.removeChild(this._popupStack.pop())}if(this._popupStack.push(popup),null!=target)for(var p=target;null!=p;){if(p.parent==this){popup.sortingOrder<p.sortingOrder&&(popup.sortingOrder=p.sortingOrder);break}p=p.parent}var pos;this.addChild(popup),this.adjustModalLayer();var xx,yy,sizeW=0,sizeH=0;target?(pos=target.localToGlobal(),sizeW=target.width,sizeH=target.height):pos=this.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY),(xx=pos.x)+popup.width>this.width&&(xx=xx+sizeW-popup.width),yy=pos.y+sizeH,(null==downward&&yy+popup.height>this.height||0==downward)&&(yy=pos.y-popup.height-1)<0&&(yy=0,xx+=sizeW/2),popup.x=xx,popup.y=yy}togglePopup(popup,target=null,downward=null){-1==this._justClosedPopups.indexOf(popup)&&this.showPopup(popup,target,downward)}hidePopup(popup=null){if(null!=popup){var k=this._popupStack.indexOf(popup);if(-1!=k)for(var i=this._popupStack.length-1;i>=k;i--)this.closePopup(this._popupStack.pop())}else{for(i=this._popupStack.length-1;i>=0;i--)this.closePopup(this._popupStack[i]);this._popupStack.length=0}}get hasAnyPopup(){return 0!=this._popupStack.length}closePopup(target){null!=target.parent&&(target instanceof fgui.Window?target.hide():this.removeChild(target))}showTooltips(msg){if(null==this._defaultTooltipWin){var resourceURL=fgui.UIConfig.tooltipsWin;if(!resourceURL)return void Laya.Log.print("UIConfig.tooltipsWin not defined");this._defaultTooltipWin=fgui.UIPackage.createObjectFromURL(resourceURL)}this._defaultTooltipWin.text=msg,this.showTooltipsWin(this._defaultTooltipWin)}showTooltipsWin(tooltipWin,position=null){this.hideTooltips(),this._tooltipWin=tooltipWin;var xx=0,yy=0;null==position?(xx=Laya.stage.mouseX+10,yy=Laya.stage.mouseY+20):(xx=position.x,yy=position.y);var pt=this.globalToLocal(xx,yy);xx=pt.x,yy=pt.y,xx+this._tooltipWin.width>this.width&&(xx=xx-this._tooltipWin.width-1)<0&&(xx=10),yy+this._tooltipWin.height>this.height&&(yy=yy-this._tooltipWin.height-1,xx-this._tooltipWin.width-1>0&&(xx=xx-this._tooltipWin.width-1),yy<0&&(yy=10)),this._tooltipWin.x=xx,this._tooltipWin.y=yy,this.addChild(this._tooltipWin)}hideTooltips(){null!=this._tooltipWin&&(this._tooltipWin.parent&&this.removeChild(this._tooltipWin),this._tooltipWin=null)}getObjectUnderPoint(globalX,globalY){return null}get focus(){return this._focusedObject&&!this._focusedObject.onStage&&(this._focusedObject=null),this._focusedObject}set focus(value){if(value&&(!value.focusable||!value.onStage))throw"invalid this.focus target";this.setFocus(value)}setFocus(value){this._focusedObject!=value&&(this._focusedObject=value,this.displayObject.event(fgui.Events.FOCUS_CHANGED))}get volumeScale(){return Laya.SoundManager.soundVolume}set volumeScale(value){Laya.SoundManager.soundVolume=value}playOneShotSound(url,volumeScale=1){fgui.ToolSet.startsWith(url,"ui://")||Laya.SoundManager.playSound(url)}adjustModalLayer(){var cnt=this.numChildren;null!=this._modalWaitPane&&null!=this._modalWaitPane.parent&&this.setChildIndex(this._modalWaitPane,cnt-1);for(var i=cnt-1;i>=0;i--){var g=this.getChildAt(i);if(g instanceof fgui.Window&&g.modal)return void(null==this._modalLayer.parent?this.addChildAt(this._modalLayer,i):this.setChildIndexBefore(this._modalLayer,i))}null!=this._modalLayer.parent&&this.removeChild(this._modalLayer)}__addedToStage(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.__stageMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.__stageMouseUp),this._modalLayer=new fgui.GGraph,this._modalLayer.setSize(this.width,this.height),this._modalLayer.drawRect(0,null,fgui.UIConfig.modalLayerColor),this._modalLayer.addRelation(this,fgui.RelationType.Size),this.displayObject.stage.on(Laya.Event.RESIZE,this,this.__winResize),this.__winResize()}checkPopups(clickTarget){if(!this._checkPopups&&(this._checkPopups=!0,this._justClosedPopups.length=0,this._popupStack.length>0)){for(var mc=clickTarget;mc!=this.displayObject.stage&&null!=mc;){if(mc.$owner){var pindex=this._popupStack.indexOf(mc.$owner);if(-1!=pindex){for(var i=this._popupStack.length-1;i>pindex;i--){var popup=this._popupStack.pop();this.closePopup(popup),this._justClosedPopups.push(popup)}return}}mc=mc.parent}for(i=this._popupStack.length-1;i>=0;i--)popup=this._popupStack[i],this.closePopup(popup),this._justClosedPopups.push(popup);this._popupStack.length=0}}__stageMouseDown(evt){for(var mc=evt.target;mc!=this.displayObject.stage&&null!=mc;){if(mc.$owner){var gg=mc.$owner;if(gg.touchable&&gg.focusable){this.setFocus(gg);break}}mc=mc.parent}null!=this._tooltipWin&&this.hideTooltips(),this.checkPopups(evt.target)}__stageMouseUp(){this._checkPopups=!1}__winResize(){this.setSize(Laya.stage.width,Laya.stage.height)}}fgui.GRoot=GRoot}(fgui||(fgui={})),function(fgui){fgui.Margin=class{constructor(){this.left=0,this.right=0,this.top=0,this.bottom=0}copy(source){this.top=source.top,this.bottom=source.bottom,this.left=source.left,this.right=source.right}}}(fgui||(fgui={})),function(fgui){fgui.PopupMenu=class{constructor(resourceURL=null){if(!resourceURL&&!(resourceURL=fgui.UIConfig.popupMenu))throw"UIConfig.popupMenu not defined";this._contentPane=fgui.UIPackage.createObjectFromURL(resourceURL).asCom,this._contentPane.on(Laya.Event.DISPLAY,this,this.__addedToStage),this._list=this._contentPane.getChild("list"),this._list.removeChildrenToPool(),this._list.addRelation(this._contentPane,fgui.RelationType.Width),this._list.removeRelation(this._contentPane,fgui.RelationType.Height),this._contentPane.addRelation(this._list,fgui.RelationType.Height),this._list.on(fgui.Events.CLICK_ITEM,this,this.__clickItem)}dispose(){this._contentPane.dispose()}addItem(caption,handler=null){var item=this._list.addItemFromPool().asButton;item.title=caption,item.data=handler,item.grayed=!1;var c=item.getController("checked");return null!=c&&(c.selectedIndex=0),item}addItemAt(caption,index,handler=null){var item=this._list.getFromPool().asButton;this._list.addChildAt(item,index),item.title=caption,item.data=handler,item.grayed=!1;var c=item.getController("checked");return null!=c&&(c.selectedIndex=0),item}addSeperator(){if(null==fgui.UIConfig.popupMenu_seperator)throw"UIConfig.popupMenu_seperator not defined";this.list.addItemFromPool(fgui.UIConfig.popupMenu_seperator)}getItemName(index){return this._list.getChildAt(index).name}setItemText(name,caption){this._list.getChild(name).asButton.title=caption}setItemVisible(name,visible){var item=this._list.getChild(name).asButton;item.visible!=visible&&(item.visible=visible,this._list.setBoundsChangedFlag())}setItemGrayed(name,grayed){this._list.getChild(name).asButton.grayed=grayed}setItemCheckable(name,checkable){var c=this._list.getChild(name).asButton.getController("checked");null!=c&&(checkable?0==c.selectedIndex&&(c.selectedIndex=1):c.selectedIndex=0)}setItemChecked(name,checked){var c=this._list.getChild(name).asButton.getController("checked");null!=c&&(c.selectedIndex=checked?2:1)}isItemChecked(name){var c=this._list.getChild(name).asButton.getController("checked");return null!=c&&2==c.selectedIndex}removeItem(name){var item=this._list.getChild(name);if(null!=item){var index=this._list.getChildIndex(item);return this._list.removeChildToPoolAt(index),!0}return!1}clearItems(){this._list.removeChildrenToPool()}get itemCount(){return this._list.numChildren}get contentPane(){return this._contentPane}get list(){return this._list}show(target=null,downward=null){(null!=target?target.root:fgui.GRoot.inst).showPopup(this.contentPane,target instanceof fgui.GRoot?null:target,downward)}__clickItem(itemObject){Laya.timer.once(100,this,this.__clickItem2,[itemObject])}__clickItem2(itemObject){if(itemObject instanceof fgui.GButton)if(itemObject.grayed)this._list.selectedIndex=-1;else{var c=itemObject.asCom.getController("checked");null!=c&&0!=c.selectedIndex&&(1==c.selectedIndex?c.selectedIndex=2:c.selectedIndex=1),this._contentPane.parent.hidePopup(this.contentPane),null!=itemObject.data&&itemObject.data.run()}}__addedToStage(){this._list.selectedIndex=-1,this._list.resizeToFit(1e5,10)}}}(fgui||(fgui={})),function(fgui){fgui.RelationItem=class{constructor(owner){this._owner=owner,this._defs=new Array}get owner(){return this._owner}set target(value){this._target!=value&&(this._target&&this.releaseRefTarget(this._target),this._target=value,this._target&&this.addRefTarget(this._target))}get target(){return this._target}add(relationType,usePercent){if(relationType==fgui.RelationType.Size)return this.add(fgui.RelationType.Width,usePercent),void this.add(fgui.RelationType.Height,usePercent);for(var cnt=this._defs.length,i=0;i<cnt;i++)if(this._defs[i].type==relationType)return;this.internalAdd(relationType,usePercent)}internalAdd(relationType,usePercent){if(relationType==fgui.RelationType.Size)return this.internalAdd(fgui.RelationType.Width,usePercent),void this.internalAdd(fgui.RelationType.Height,usePercent);var info=new RelationDef;info.percent=usePercent,info.type=relationType,info.axis=relationType<=fgui.RelationType.Right_Right||relationType==fgui.RelationType.Width||relationType>=fgui.RelationType.LeftExt_Left&&relationType<=fgui.RelationType.RightExt_Right?0:1,this._defs.push(info),(usePercent||relationType==fgui.RelationType.Left_Center||relationType==fgui.RelationType.Center_Center||relationType==fgui.RelationType.Right_Center||relationType==fgui.RelationType.Top_Middle||relationType==fgui.RelationType.Middle_Middle||relationType==fgui.RelationType.Bottom_Middle)&&(this._owner.pixelSnapping=!0)}remove(relationType){if(relationType==fgui.RelationType.Size)return this.remove(fgui.RelationType.Width),void this.remove(fgui.RelationType.Height);for(var dc=this._defs.length,k=0;k<dc;k++)if(this._defs[k].type==relationType){this._defs.splice(k,1);break}}copyFrom(source){this.target=source.target,this._defs.length=0;for(var cnt=source._defs.length,i=0;i<cnt;i++){var info=source._defs[i],info2=new RelationDef;info2.copyFrom(info),this._defs.push(info2)}}dispose(){null!=this._target&&(this.releaseRefTarget(this._target),this._target=null)}get isEmpty(){return 0==this._defs.length}applyOnSelfResized(dWidth,dHeight,applyPivot){var cnt=this._defs.length;if(0!=cnt){for(var ox=this._owner.x,oy=this._owner.y,i=0;i<cnt;i++)switch(this._defs[i].type){case fgui.RelationType.Center_Center:this._owner.x-=(.5-(applyPivot?this._owner.pivotX:0))*dWidth;break;case fgui.RelationType.Right_Center:case fgui.RelationType.Right_Left:case fgui.RelationType.Right_Right:this._owner.x-=(1-(applyPivot?this._owner.pivotX:0))*dWidth;break;case fgui.RelationType.Middle_Middle:this._owner.y-=(.5-(applyPivot?this._owner.pivotY:0))*dHeight;break;case fgui.RelationType.Bottom_Middle:case fgui.RelationType.Bottom_Top:case fgui.RelationType.Bottom_Bottom:this._owner.y-=(1-(applyPivot?this._owner.pivotY:0))*dHeight}if((ox!=this._owner.x||oy!=this._owner.y)&&(ox=this._owner.x-ox,oy=this._owner.y-oy,this._owner.updateGearFromRelations(1,ox,oy),null!=this._owner.parent&&this._owner.parent._transitions.length>0)){cnt=this._owner.parent._transitions.length;for(var j=0;j<cnt;j++)this._owner.parent._transitions[j].updateFromRelations(this._owner.id,ox,oy)}}}applyOnXYChanged(info,dx,dy){var tmp;switch(info.type){case fgui.RelationType.Left_Left:case fgui.RelationType.Left_Center:case fgui.RelationType.Left_Right:case fgui.RelationType.Center_Center:case fgui.RelationType.Right_Left:case fgui.RelationType.Right_Center:case fgui.RelationType.Right_Right:this._owner.x+=dx;break;case fgui.RelationType.Top_Top:case fgui.RelationType.Top_Middle:case fgui.RelationType.Top_Bottom:case fgui.RelationType.Middle_Middle:case fgui.RelationType.Bottom_Top:case fgui.RelationType.Bottom_Middle:case fgui.RelationType.Bottom_Bottom:this._owner.y+=dy;break;case fgui.RelationType.Width:case fgui.RelationType.Height:break;case fgui.RelationType.LeftExt_Left:case fgui.RelationType.LeftExt_Right:tmp=this._owner.xMin,this._owner.width=this._owner._rawWidth-dx,this._owner.xMin=tmp+dx;break;case fgui.RelationType.RightExt_Left:case fgui.RelationType.RightExt_Right:tmp=this._owner.xMin,this._owner.width=this._owner._rawWidth+dx,this._owner.xMin=tmp;break;case fgui.RelationType.TopExt_Top:case fgui.RelationType.TopExt_Bottom:tmp=this._owner.yMin,this._owner.height=this._owner._rawHeight-dy,this._owner.yMin=tmp+dy;break;case fgui.RelationType.BottomExt_Top:case fgui.RelationType.BottomExt_Bottom:tmp=this._owner.yMin,this._owner.height=this._owner._rawHeight+dy,this._owner.yMin=tmp}}applyOnSizeChanged(info){var v,tmp,pos=0,pivot=0,delta=0;switch(0==info.axis?(this._target!=this._owner.parent&&(pos=this._target.x,this._target.pivotAsAnchor&&(pivot=this._target.pivotX)),info.percent?0!=this._targetWidth&&(delta=this._target._width/this._targetWidth):delta=this._target._width-this._targetWidth):(this._target!=this._owner.parent&&(pos=this._target.y,this._target.pivotAsAnchor&&(pivot=this._target.pivotY)),info.percent?0!=this._targetHeight&&(delta=this._target._height/this._targetHeight):delta=this._target._height-this._targetHeight),info.type){case fgui.RelationType.Left_Left:info.percent?this._owner.xMin=pos+(this._owner.xMin-pos)*delta:0!=pivot&&(this._owner.x+=delta*-pivot);break;case fgui.RelationType.Left_Center:info.percent?this._owner.xMin=pos+(this._owner.xMin-pos)*delta:this._owner.x+=delta*(.5-pivot);break;case fgui.RelationType.Left_Right:info.percent?this._owner.xMin=pos+(this._owner.xMin-pos)*delta:this._owner.x+=delta*(1-pivot);break;case fgui.RelationType.Center_Center:info.percent?this._owner.xMin=pos+(this._owner.xMin+.5*this._owner._rawWidth-pos)*delta-.5*this._owner._rawWidth:this._owner.x+=delta*(.5-pivot);break;case fgui.RelationType.Right_Left:info.percent?this._owner.xMin=pos+(this._owner.xMin+this._owner._rawWidth-pos)*delta-this._owner._rawWidth:0!=pivot&&(this._owner.x+=delta*-pivot);break;case fgui.RelationType.Right_Center:info.percent?this._owner.xMin=pos+(this._owner.xMin+this._owner._rawWidth-pos)*delta-this._owner._rawWidth:this._owner.x+=delta*(.5-pivot);break;case fgui.RelationType.Right_Right:info.percent?this._owner.xMin=pos+(this._owner.xMin+this._owner._rawWidth-pos)*delta-this._owner._rawWidth:this._owner.x+=delta*(1-pivot);break;case fgui.RelationType.Top_Top:info.percent?this._owner.yMin=pos+(this._owner.yMin-pos)*delta:0!=pivot&&(this._owner.y+=delta*-pivot);break;case fgui.RelationType.Top_Middle:info.percent?this._owner.yMin=pos+(this._owner.yMin-pos)*delta:this._owner.y+=delta*(.5-pivot);break;case fgui.RelationType.Top_Bottom:info.percent?this._owner.yMin=pos+(this._owner.yMin-pos)*delta:this._owner.y+=delta*(1-pivot);break;case fgui.RelationType.Middle_Middle:info.percent?this._owner.yMin=pos+(this._owner.yMin+.5*this._owner._rawHeight-pos)*delta-.5*this._owner._rawHeight:this._owner.y+=delta*(.5-pivot);break;case fgui.RelationType.Bottom_Top:info.percent?this._owner.yMin=pos+(this._owner.yMin+this._owner._rawHeight-pos)*delta-this._owner._rawHeight:0!=pivot&&(this._owner.y+=delta*-pivot);break;case fgui.RelationType.Bottom_Middle:info.percent?this._owner.yMin=pos+(this._owner.yMin+this._owner._rawHeight-pos)*delta-this._owner._rawHeight:this._owner.y+=delta*(.5-pivot);break;case fgui.RelationType.Bottom_Bottom:info.percent?this._owner.yMin=pos+(this._owner.yMin+this._owner._rawHeight-pos)*delta-this._owner._rawHeight:this._owner.y+=delta*(1-pivot);break;case fgui.RelationType.Width:v=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceWidth-this._target.initWidth:this._owner._rawWidth-this._targetWidth,info.percent&&(v*=delta),this._target==this._owner.parent?this._owner.pivotAsAnchor?(tmp=this._owner.xMin,this._owner.setSize(this._target._width+v,this._owner._rawHeight,!0),this._owner.xMin=tmp):this._owner.setSize(this._target._width+v,this._owner._rawHeight,!0):this._owner.width=this._target._width+v;break;case fgui.RelationType.Height:v=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceHeight-this._target.initHeight:this._owner._rawHeight-this._targetHeight,info.percent&&(v*=delta),this._target==this._owner.parent?this._owner.pivotAsAnchor?(tmp=this._owner.yMin,this._owner.setSize(this._owner._rawWidth,this._target._height+v,!0),this._owner.yMin=tmp):this._owner.setSize(this._owner._rawWidth,this._target._height+v,!0):this._owner.height=this._target._height+v;break;case fgui.RelationType.LeftExt_Left:tmp=this._owner.xMin,v=info.percent?pos+(tmp-pos)*delta-tmp:delta*-pivot,this._owner.width=this._owner._rawWidth-v,this._owner.xMin=tmp+v;break;case fgui.RelationType.LeftExt_Right:tmp=this._owner.xMin,v=info.percent?pos+(tmp-pos)*delta-tmp:delta*(1-pivot),this._owner.width=this._owner._rawWidth-v,this._owner.xMin=tmp+v;break;case fgui.RelationType.RightExt_Left:tmp=this._owner.xMin,v=info.percent?pos+(tmp+this._owner._rawWidth-pos)*delta-(tmp+this._owner._rawWidth):delta*-pivot,this._owner.width=this._owner._rawWidth+v,this._owner.xMin=tmp;break;case fgui.RelationType.RightExt_Right:tmp=this._owner.xMin,info.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=pos+this._target._width-this._target._width*pivot+(this._owner.sourceWidth-pos-this._target.initWidth+this._target.initWidth*pivot)*delta:this._owner.width=pos+(this._owner._rawWidth-pos)*delta:(v=pos+(tmp+this._owner._rawWidth-pos)*delta-(tmp+this._owner._rawWidth),this._owner.width=this._owner._rawWidth+v,this._owner.xMin=tmp):this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=this._owner.sourceWidth+(this._target._width-this._target.initWidth)*(1-pivot):this._owner.width=this._owner._rawWidth+delta*(1-pivot):(v=delta*(1-pivot),this._owner.width=this._owner._rawWidth+v,this._owner.xMin=tmp);break;case fgui.RelationType.TopExt_Top:tmp=this._owner.yMin,v=info.percent?pos+(tmp-pos)*delta-tmp:delta*-pivot,this._owner.height=this._owner._rawHeight-v,this._owner.yMin=tmp+v;break;case fgui.RelationType.TopExt_Bottom:tmp=this._owner.yMin,v=info.percent?pos+(tmp-pos)*delta-tmp:delta*(1-pivot),this._owner.height=this._owner._rawHeight-v,this._owner.yMin=tmp+v;break;case fgui.RelationType.BottomExt_Top:tmp=this._owner.yMin,v=info.percent?pos+(tmp+this._owner._rawHeight-pos)*delta-(tmp+this._owner._rawHeight):delta*-pivot,this._owner.height=this._owner._rawHeight+v,this._owner.yMin=tmp;break;case fgui.RelationType.BottomExt_Bottom:tmp=this._owner.yMin,info.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=pos+this._target._height-this._target._height*pivot+(this._owner.sourceHeight-pos-this._target.initHeight+this._target.initHeight*pivot)*delta:this._owner.height=pos+(this._owner._rawHeight-pos)*delta:(v=pos+(tmp+this._owner._rawHeight-pos)*delta-(tmp+this._owner._rawHeight),this._owner.height=this._owner._rawHeight+v,this._owner.yMin=tmp):this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=this._owner.sourceHeight+(this._target._height-this._target.initHeight)*(1-pivot):this._owner.height=this._owner._rawHeight+delta*(1-pivot):(v=delta*(1-pivot),this._owner.height=this._owner._rawHeight+v,this._owner.yMin=tmp)}}addRefTarget(target){this.target!=this._owner.parent&&this.target.on(fgui.Events.XY_CHANGED,this,this.__targetXYChanged),this.target.on(fgui.Events.SIZE_CHANGED,this,this.__targetSizeChanged),this.target.on(fgui.Events.SIZE_DELAY_CHANGE,this,this.__targetSizeWillChange),this._targetX=this._target.x,this._targetY=this._target.y,this._targetWidth=this._target._width,this._targetHeight=this._target._height}releaseRefTarget(target){null!=this.target.displayObject&&(this.target.off(fgui.Events.XY_CHANGED,this,this.__targetXYChanged),this.target.off(fgui.Events.SIZE_CHANGED,this,this.__targetSizeChanged),this.target.off(fgui.Events.SIZE_DELAY_CHANGE,this,this.__targetSizeWillChange))}__targetXYChanged(target){if(null!=this._owner.relations.handling||null!=this._owner.group&&this._owner.group._updating)return this._targetX=this._target.x,void(this._targetY=this._target.y);this._owner.relations.handling=this.target;for(var ox=this._owner.x,oy=this._owner.y,dx=this._target.x-this._targetX,dy=this._target.y-this._targetY,cnt=this._defs.length,i=0;i<cnt;i++)this.applyOnXYChanged(this._defs[i],dx,dy);if(this._targetX=this._target.x,this._targetY=this._target.y,(ox!=this._owner.x||oy!=this._owner.y)&&(ox=this._owner.x-ox,oy=this._owner.y-oy,this._owner.updateGearFromRelations(1,ox,oy),null!=this._owner.parent&&this._owner.parent._transitions.length>0)){cnt=this._owner.parent._transitions.length;for(var j=0;j<cnt;j++)this._owner.parent._transitions[j].updateFromRelations(this._owner.id,ox,oy)}this._owner.relations.handling=null}__targetSizeChanged(target){if(null!=this._owner.relations.handling)return this._targetWidth=this._target._width,void(this._targetHeight=this._target._height);this._owner.relations.handling=this.target;for(var ox=this._owner.x,oy=this._owner.y,ow=this._owner._rawWidth,oh=this._owner._rawHeight,cnt=this._defs.length,i=0;i<cnt;i++)this.applyOnSizeChanged(this._defs[i]);if(this._targetWidth=this._target._width,this._targetHeight=this._target._height,(ox!=this._owner.x||oy!=this._owner.y)&&(ox=this._owner.x-ox,oy=this._owner.y-oy,this._owner.updateGearFromRelations(1,ox,oy),null!=this._owner.parent&&this._owner.parent._transitions.length>0)){cnt=this._owner.parent._transitions.length;for(var j=0;j<cnt;j++)this._owner.parent._transitions[j].updateFromRelations(this._owner.id,ox,oy)}ow==this._owner._rawWidth&&oh==this._owner._rawHeight||(ow=this._owner._rawWidth-ow,oh=this._owner._rawHeight-oh,this._owner.updateGearFromRelations(2,ow,oh)),this._owner.relations.handling=null}__targetSizeWillChange(target){this._owner.relations.sizeDirty=!0}};class RelationDef{constructor(){}copyFrom(source){this.percent=source.percent,this.type=source.type,this.axis=source.axis}}}(fgui||(fgui={})),function(fgui){fgui.Relations=class{constructor(owner){this._owner=owner,this._items=[]}add(target,relationType,usePercent=!1){for(var length=this._items.length,i=0;i<length;i++){var item=this._items[i];if(item.target==target)return void item.add(relationType,usePercent)}var newItem=new fgui.RelationItem(this._owner);newItem.target=target,newItem.add(relationType,usePercent),this._items.push(newItem)}remove(target,relationType=0){for(var cnt=this._items.length,i=0;i<cnt;){var item=this._items[i];item.target==target?(item.remove(relationType),item.isEmpty?(item.dispose(),this._items.splice(i,1),cnt--):i++):i++}}contains(target){for(var length=this._items.length,i=0;i<length;i++)if(this._items[i].target==target)return!0;return!1}clearFor(target){for(var cnt=this._items.length,i=0;i<cnt;){var item=this._items[i];item.target==target?(item.dispose(),this._items.splice(i,1),cnt--):i++}}clearAll(){for(var length=this._items.length,i=0;i<length;i++)this._items[i].dispose();this._items.length=0}copyFrom(source){this.clearAll();for(var arr=source._items,length=arr.length,i=0;i<length;i++){var ri=arr[i],item=new fgui.RelationItem(this._owner);item.copyFrom(ri),this._items.push(item)}}dispose(){this.clearAll()}onOwnerSizeChanged(dWidth,dHeight,applyPivot){if(0!=this._items.length)for(var length=this._items.length,i=0;i<length;i++)this._items[i].applyOnSelfResized(dWidth,dHeight,applyPivot)}ensureRelationsSizeCorrect(){if(0!=this._items.length){this.sizeDirty=!1;for(var length=this._items.length,i=0;i<length;i++)this._items[i].target.ensureSizeCorrect()}}get empty(){return 0==this._items.length}setup(buffer,parentToChild){for(var target,cnt=buffer.readByte(),i=0;i<cnt;i++){var targetIndex=buffer.getInt16();target=-1==targetIndex?this._owner.parent:parentToChild?this._owner.getChildAt(targetIndex):this._owner.parent.getChildAt(targetIndex);var newItem=new fgui.RelationItem(this._owner);newItem.target=target,this._items.push(newItem);for(var cnt2=buffer.readByte(),j=0;j<cnt2;j++){var rt=buffer.readByte(),usePercent=buffer.readBool();newItem.internalAdd(rt,usePercent)}}}}}(fgui||(fgui={})),function(fgui){class ScrollPane{constructor(owner){this._owner=owner,this._maskContainer=new Laya.Sprite,this._owner.displayObject.addChild(this._maskContainer),this._container=this._owner._container,this._container.pos(0,0),this._maskContainer.addChild(this._container),this._scrollBarVisible=!0,this._mouseWheelEnabled=!0,this._xPos=0,this._yPos=0,this._aniFlag=0,this._footerLockedSize=0,this._headerLockedSize=0,this._scrollBarMargin=new fgui.Margin,this._viewSize=new Laya.Point,this._contentSize=new Laya.Point,this._pageSize=new Laya.Point(1,1),this._overlapSize=new Laya.Point,this._tweenTime=new Laya.Point,this._tweenStart=new Laya.Point,this._tweenDuration=new Laya.Point,this._tweenChange=new Laya.Point,this._velocity=new Laya.Point,this._containerPos=new Laya.Point,this._beginTouchPos=new Laya.Point,this._lastTouchPos=new Laya.Point,this._lastTouchGlobalPos=new Laya.Point,this._scrollStep=fgui.UIConfig.defaultScrollStep,this._mouseWheelStep=2*this._scrollStep,this._decelerationRate=fgui.UIConfig.defaultScrollDecelerationRate,this._owner.on(Laya.Event.MOUSE_DOWN,this,this.__mouseDown),this._owner.on(Laya.Event.MOUSE_WHEEL,this,this.__mouseWheel)}setup(buffer){this._scrollType=buffer.readByte();var scrollBarDisplay=buffer.readByte(),flags=buffer.getInt32();buffer.readBool()&&(this._scrollBarMargin.top=buffer.getInt32(),this._scrollBarMargin.bottom=buffer.getInt32(),this._scrollBarMargin.left=buffer.getInt32(),this._scrollBarMargin.right=buffer.getInt32());var vtScrollBarRes=buffer.readS(),hzScrollBarRes=buffer.readS(),headerRes=buffer.readS(),footerRes=buffer.readS();if(this._displayOnLeft=0!=(1&flags),this._snapToItem=0!=(2&flags),this._displayInDemand=0!=(4&flags),this._pageMode=0!=(8&flags),this._touchEffect=!!(16&flags)||!(32&flags)&&fgui.UIConfig.defaultScrollTouchEffect,this._bouncebackEffect=!!(64&flags)||!(128&flags)&&fgui.UIConfig.defaultScrollBounceEffect,this._inertiaDisabled=0!=(256&flags),0==(512&flags)&&(this._maskContainer.scrollRect=new Laya.Rectangle),scrollBarDisplay==fgui.ScrollBarDisplayType.Default&&(scrollBarDisplay=fgui.UIConfig.defaultScrollBarDisplay),scrollBarDisplay!=fgui.ScrollBarDisplayType.Hidden){if(this._scrollType==fgui.ScrollType.Both||this._scrollType==fgui.ScrollType.Vertical){var res=vtScrollBarRes||fgui.UIConfig.verticalScrollBar;if(res){if(this._vtScrollBar=fgui.UIPackage.createObjectFromURL(res),!this._vtScrollBar)throw"cannot create scrollbar from "+res;this._vtScrollBar.setScrollPane(this,!0),this._owner.displayObject.addChild(this._vtScrollBar.displayObject)}}if((this._scrollType==fgui.ScrollType.Both||this._scrollType==fgui.ScrollType.Horizontal)&&(res=hzScrollBarRes||fgui.UIConfig.horizontalScrollBar)){if(this._hzScrollBar=fgui.UIPackage.createObjectFromURL(res),!this._hzScrollBar)throw"cannot create scrollbar from "+res;this._hzScrollBar.setScrollPane(this,!1),this._owner.displayObject.addChild(this._hzScrollBar.displayObject)}this._scrollBarDisplayAuto=scrollBarDisplay==fgui.ScrollBarDisplayType.Auto,this._scrollBarDisplayAuto&&(this._scrollBarVisible=!1,this._vtScrollBar&&(this._vtScrollBar.displayObject.visible=!1),this._hzScrollBar&&(this._hzScrollBar.displayObject.visible=!1))}else this._mouseWheelEnabled=!1;if(headerRes&&(this._header=fgui.UIPackage.createObjectFromURL(headerRes),null==this._header))throw new Error("FairyGUI: cannot create scrollPane this.header from "+headerRes);if(footerRes&&(this._footer=fgui.UIPackage.createObjectFromURL(footerRes),null==this._footer))throw new Error("FairyGUI: cannot create scrollPane this.footer from "+footerRes);null==this._header&&null==this._footer||(this._refreshBarAxis=this._scrollType==fgui.ScrollType.Both||this._scrollType==fgui.ScrollType.Vertical?"y":"x"),this.setSize(this.owner.width,this.owner.height)}dispose(){0!=this._tweening&&Laya.timer.clear(this,this.tweenUpdate),this._pageController=null,null!=this._hzScrollBar&&this._hzScrollBar.dispose(),null!=this._vtScrollBar&&this._vtScrollBar.dispose(),null!=this._header&&this._header.dispose(),null!=this._footer&&this._footer.dispose()}get owner(){return this._owner}get hzScrollBar(){return this._hzScrollBar}get vtScrollBar(){return this._vtScrollBar}get header(){return this._header}get footer(){return this._footer}get bouncebackEffect(){return this._bouncebackEffect}set bouncebackEffect(sc){this._bouncebackEffect=sc}get touchEffect(){return this._touchEffect}set touchEffect(sc){this._touchEffect=sc}set scrollStep(val){this._scrollStep=val,0==this._scrollStep&&(this._scrollStep=fgui.UIConfig.defaultScrollStep),this._mouseWheelStep=2*this._scrollStep}get scrollStep(){return this._scrollStep}get snapToItem(){return this._snapToItem}set snapToItem(value){this._snapToItem=value}get mouseWheelEnabled(){return this._mouseWheelEnabled}set mouseWheelEnabled(value){this._mouseWheelEnabled=value}get decelerationRate(){return this._decelerationRate}set decelerationRate(value){this._decelerationRate=value}get percX(){return 0==this._overlapSize.x?0:this._xPos/this._overlapSize.x}set percX(value){this.setPercX(value,!1)}setPercX(value,ani){this._owner.ensureBoundsCorrect(),this.setPosX(this._overlapSize.x*fgui.ToolSet.clamp01(value),ani)}get percY(){return 0==this._overlapSize.y?0:this._yPos/this._overlapSize.y}set percY(value){this.setPercY(value,!1)}setPercY(value,ani){this._owner.ensureBoundsCorrect(),this.setPosY(this._overlapSize.y*fgui.ToolSet.clamp01(value),ani)}get posX(){return this._xPos}set posX(value){this.setPosX(value,!1)}setPosX(value,ani){this._owner.ensureBoundsCorrect(),1==this._loop&&(value=this.loopCheckingNewPos(value,"x")),(value=fgui.ToolSet.clamp(value,0,this._overlapSize.x))!=this._xPos&&(this._xPos=value,this.posChanged(ani))}get posY(){return this._yPos}set posY(value){this.setPosY(value,!1)}setPosY(value,ani){this._owner.ensureBoundsCorrect(),1==this._loop&&(value=this.loopCheckingNewPos(value,"y")),(value=fgui.ToolSet.clamp(value,0,this._overlapSize.y))!=this._yPos&&(this._yPos=value,this.posChanged(ani))}get contentWidth(){return this._contentSize.x}get contentHeight(){return this._contentSize.y}get viewWidth(){return this._viewSize.x}set viewWidth(value){value=value+this._owner.margin.left+this._owner.margin.right,null!=this._vtScrollBar&&(value+=this._vtScrollBar.width),this._owner.width=value}get viewHeight(){return this._viewSize.y}set viewHeight(value){value=value+this._owner.margin.top+this._owner.margin.bottom,null!=this._hzScrollBar&&(value+=this._hzScrollBar.height),this._owner.height=value}get currentPageX(){if(!this._pageMode)return 0;var page=Math.floor(this._xPos/this._pageSize.x);return this._xPos-page*this._pageSize.x>.5*this._pageSize.x&&page++,page}set currentPageX(value){this.setCurrentPageX(value,!1)}get currentPageY(){if(!this._pageMode)return 0;var page=Math.floor(this._yPos/this._pageSize.y);return this._yPos-page*this._pageSize.y>.5*this._pageSize.y&&page++,page}set currentPageY(value){this.setCurrentPageY(value,!1)}setCurrentPageX(value,ani){this._pageMode&&this._overlapSize.x>0&&this.setPosX(value*this._pageSize.x,ani)}setCurrentPageY(value,ani){this._pageMode&&this._overlapSize.y>0&&this.setPosY(value*this._pageSize.y,ani)}get isBottomMost(){return this._yPos==this._overlapSize.y||0==this._overlapSize.y}get isRightMost(){return this._xPos==this._overlapSize.x||0==this._overlapSize.x}get pageController(){return this._pageController}set pageController(value){this._pageController=value}get scrollingPosX(){return fgui.ToolSet.clamp(-this._container.x,0,this._overlapSize.x)}get scrollingPosY(){return fgui.ToolSet.clamp(-this._container.y,0,this._overlapSize.y)}scrollTop(ani){this.setPercY(0,ani)}scrollBottom(ani){this.setPercY(1,ani)}scrollUp(ratio=1,ani){this._pageMode?this.setPosY(this._yPos-this._pageSize.y*ratio,ani):this.setPosY(this._yPos-this._scrollStep*ratio,ani)}scrollDown(ratio=1,ani){this._pageMode?this.setPosY(this._yPos+this._pageSize.y*ratio,ani):this.setPosY(this._yPos+this._scrollStep*ratio,ani)}scrollLeft(ratio=1,ani){this._pageMode?this.setPosX(this._xPos-this._pageSize.x*ratio,ani):this.setPosX(this._xPos-this._scrollStep*ratio,ani)}scrollRight(ratio=1,ani){this._pageMode?this.setPosX(this._xPos+this._pageSize.x*ratio,ani):this.setPosX(this._xPos+this._scrollStep*ratio,ani)}scrollToView(target,ani,setFirst){var rect;if(this._owner.ensureBoundsCorrect(),this._needRefresh&&this.refresh(),target instanceof fgui.GObject?target.parent!=this._owner?(target.parent.localToGlobalRect(target.x,target.y,target.width,target.height,ScrollPane.sHelperRect),rect=this._owner.globalToLocalRect(ScrollPane.sHelperRect.x,ScrollPane.sHelperRect.y,ScrollPane.sHelperRect.width,ScrollPane.sHelperRect.height,ScrollPane.sHelperRect)):(rect=ScrollPane.sHelperRect).setTo(target.x,target.y,target.width,target.height):rect=target,this._overlapSize.y>0){var bottom=this._yPos+this._viewSize.y;setFirst||rect.y<=this._yPos||rect.height>=this._viewSize.y?this._pageMode?this.setPosY(Math.floor(rect.y/this._pageSize.y)*this._pageSize.y,ani):this.setPosY(rect.y,ani):rect.y+rect.height>bottom&&(this._pageMode?this.setPosY(Math.floor(rect.y/this._pageSize.y)*this._pageSize.y,ani):rect.height<=this._viewSize.y/2?this.setPosY(rect.y+2*rect.height-this._viewSize.y,ani):this.setPosY(rect.y+rect.height-this._viewSize.y,ani))}if(this._overlapSize.x>0){var right=this._xPos+this._viewSize.x;setFirst||rect.x<=this._xPos||rect.width>=this._viewSize.x?this._pageMode?this.setPosX(Math.floor(rect.x/this._pageSize.x)*this._pageSize.x,ani):this.setPosX(rect.x,ani):rect.x+rect.width>right&&(this._pageMode?this.setPosX(Math.floor(rect.x/this._pageSize.x)*this._pageSize.x,ani):rect.width<=this._viewSize.x/2?this.setPosX(rect.x+2*rect.width-this._viewSize.x,ani):this.setPosX(rect.x+rect.width-this._viewSize.x,ani))}!ani&&this._needRefresh&&this.refresh()}isChildInView(obj){if(this._overlapSize.y>0){var dist=obj.y+this._container.y;if(dist<-obj.height||dist>this._viewSize.y)return!1}return!(this._overlapSize.x>0&&((dist=obj.x+this._container.x)<-obj.width||dist>this._viewSize.x))}cancelDragging(){this._owner.displayObject.stage.off(Laya.Event.MOUSE_MOVE,this,this.__mouseMove),this._owner.displayObject.stage.off(Laya.Event.MOUSE_UP,this,this.__mouseUp),this._owner.displayObject.stage.off(Laya.Event.CLICK,this,this.__click),ScrollPane.draggingPane==this&&(ScrollPane.draggingPane=null),ScrollPane._gestureFlag=0,this.isDragged=!1,this._maskContainer.mouseEnabled=!0}lockHeader(size){this._headerLockedSize!=size&&(this._headerLockedSize=size,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]>=0&&(this._tweenStart.setTo(this._container.x,this._container.y),this._tweenChange.setTo(0,0),this._tweenChange[this._refreshBarAxis]=this._headerLockedSize-this._tweenStart[this._refreshBarAxis],this._tweenDuration.setTo(ScrollPane.TWEEN_TIME_DEFAULT,ScrollPane.TWEEN_TIME_DEFAULT),this._tweenTime.setTo(0,0),this._tweening=2,Laya.timer.frameLoop(1,this,this.tweenUpdate)))}lockFooter(size){if(this._footerLockedSize!=size&&(this._footerLockedSize=size,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]<=-this._overlapSize[this._refreshBarAxis])){this._tweenStart.setTo(this._container.x,this._container.y),this._tweenChange.setTo(0,0);var max=this._overlapSize[this._refreshBarAxis];0==max?max=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):max+=this._footerLockedSize,this._tweenChange[this._refreshBarAxis]=-max-this._tweenStart[this._refreshBarAxis],this._tweenDuration.setTo(ScrollPane.TWEEN_TIME_DEFAULT,ScrollPane.TWEEN_TIME_DEFAULT),this._tweenTime.setTo(0,0),this._tweening=2,Laya.timer.frameLoop(1,this,this.tweenUpdate)}}onOwnerSizeChanged(){this.setSize(this._owner.width,this._owner.height),this.posChanged(!1)}handleControllerChanged(c){this._pageController==c&&(this._scrollType==fgui.ScrollType.Horizontal?this.setCurrentPageX(c.selectedIndex,!0):this.setCurrentPageY(c.selectedIndex,!0))}updatePageController(){var index;if(null!=this._pageController&&!this._pageController.changing&&(index=this._scrollType==fgui.ScrollType.Horizontal?this.currentPageX:this.currentPageY)<this._pageController.pageCount){var c=this._pageController;this._pageController=null,c.selectedIndex=index,this._pageController=c}}adjustMaskContainer(){var mx,my;mx=this._displayOnLeft&&null!=this._vtScrollBar?Math.floor(this._owner.margin.left+this._vtScrollBar.width):Math.floor(this._owner.margin.left),my=Math.floor(this._owner.margin.top),this._maskContainer.pos(mx,my),0!=this._owner._alignOffset.x||0!=this._owner._alignOffset.y?(null==this._alignContainer&&(this._alignContainer=new Laya.Sprite,this._maskContainer.addChild(this._alignContainer),this._alignContainer.addChild(this._container)),this._alignContainer.pos(this._owner._alignOffset.x,this._owner._alignOffset.y)):this._alignContainer&&this._alignContainer.pos(0,0)}setSize(aWidth,aHeight){this.adjustMaskContainer(),this._hzScrollBar&&(this._hzScrollBar.y=aHeight-this._hzScrollBar.height,this._vtScrollBar&&!this._vScrollNone?(this._hzScrollBar.width=aWidth-this._vtScrollBar.width-this._scrollBarMargin.left-this._scrollBarMargin.right,this._displayOnLeft?this._hzScrollBar.x=this._scrollBarMargin.left+this._vtScrollBar.width:this._hzScrollBar.x=this._scrollBarMargin.left):(this._hzScrollBar.width=aWidth-this._scrollBarMargin.left-this._scrollBarMargin.right,this._hzScrollBar.x=this._scrollBarMargin.left)),this._vtScrollBar&&(this._displayOnLeft||(this._vtScrollBar.x=aWidth-this._vtScrollBar.width),this._hzScrollBar?this._vtScrollBar.height=aHeight-this._hzScrollBar.height-this._scrollBarMargin.top-this._scrollBarMargin.bottom:this._vtScrollBar.height=aHeight-this._scrollBarMargin.top-this._scrollBarMargin.bottom,this._vtScrollBar.y=this._scrollBarMargin.top),this._viewSize.x=aWidth,this._viewSize.y=aHeight,this._hzScrollBar&&!this._hScrollNone&&(this._viewSize.y-=this._hzScrollBar.height),this._vtScrollBar&&!this._vScrollNone&&(this._viewSize.x-=this._vtScrollBar.width),this._viewSize.x-=this._owner.margin.left+this._owner.margin.right,this._viewSize.y-=this._owner.margin.top+this._owner.margin.bottom,this._viewSize.x=Math.max(1,this._viewSize.x),this._viewSize.y=Math.max(1,this._viewSize.y),this._pageSize.x=this._viewSize.x,this._pageSize.y=this._viewSize.y,this.handleSizeChanged()}setContentSize(aWidth,aHeight){this._contentSize.x==aWidth&&this._contentSize.y==aHeight||(this._contentSize.x=aWidth,this._contentSize.y=aHeight,this.handleSizeChanged())}changeContentSizeOnScrolling(deltaWidth,deltaHeight,deltaPosX,deltaPosY){var isRightmost=this._xPos==this._overlapSize.x,isBottom=this._yPos==this._overlapSize.y;this._contentSize.x+=deltaWidth,this._contentSize.y+=deltaHeight,this.handleSizeChanged(),1==this._tweening?(0!=deltaWidth&&isRightmost&&this._tweenChange.x<0&&(this._xPos=this._overlapSize.x,this._tweenChange.x=-this._xPos-this._tweenStart.x),0!=deltaHeight&&isBottom&&this._tweenChange.y<0&&(this._yPos=this._overlapSize.y,this._tweenChange.y=-this._yPos-this._tweenStart.y)):2==this._tweening?(0!=deltaPosX&&(this._container.x-=deltaPosX,this._tweenStart.x-=deltaPosX,this._xPos=-this._container.x),0!=deltaPosY&&(this._container.y-=deltaPosY,this._tweenStart.y-=deltaPosY,this._yPos=-this._container.y)):this.isDragged?(0!=deltaPosX&&(this._container.x-=deltaPosX,this._containerPos.x-=deltaPosX,this._xPos=-this._container.x),0!=deltaPosY&&(this._container.y-=deltaPosY,this._containerPos.y-=deltaPosY,this._yPos=-this._container.y)):(0!=deltaWidth&&isRightmost&&(this._xPos=this._overlapSize.x,this._container.x=-this._xPos),0!=deltaHeight&&isBottom&&(this._yPos=this._overlapSize.y,this._container.y=-this._yPos)),this._pageMode&&this.updatePageController()}handleSizeChanged(onScrolling=!1){this._displayInDemand&&(this._vtScrollBar&&(this._contentSize.y<=this._viewSize.y?this._vScrollNone||(this._vScrollNone=!0,this._viewSize.x+=this._vtScrollBar.width):this._vScrollNone&&(this._vScrollNone=!1,this._viewSize.x-=this._vtScrollBar.width)),this._hzScrollBar&&(this._contentSize.x<=this._viewSize.x?this._hScrollNone||(this._hScrollNone=!0,this._viewSize.y+=this._hzScrollBar.height):this._hScrollNone&&(this._hScrollNone=!1,this._viewSize.y-=this._hzScrollBar.height))),this._vtScrollBar&&(this._viewSize.y<this._vtScrollBar.minSize?this._vtScrollBar.displayObject.visible=!1:(this._vtScrollBar.displayObject.visible=this._scrollBarVisible&&!this._vScrollNone,0==this._contentSize.y?this._vtScrollBar.displayPerc=0:this._vtScrollBar.displayPerc=Math.min(1,this._viewSize.y/this._contentSize.y))),this._hzScrollBar&&(this._viewSize.x<this._hzScrollBar.minSize?this._hzScrollBar.displayObject.visible=!1:(this._hzScrollBar.displayObject.visible=this._scrollBarVisible&&!this._hScrollNone,0==this._contentSize.x?this._hzScrollBar.displayPerc=0:this._hzScrollBar.displayPerc=Math.min(1,this._viewSize.x/this._contentSize.x)));var rect=this._maskContainer.scrollRect;if(rect&&(rect.width=this._viewSize.x,rect.height=this._viewSize.y,this._maskContainer.scrollRect=rect),this._scrollType==fgui.ScrollType.Horizontal||this._scrollType==fgui.ScrollType.Both?this._overlapSize.x=Math.ceil(Math.max(0,this._contentSize.x-this._viewSize.x)):this._overlapSize.x=0,this._scrollType==fgui.ScrollType.Vertical||this._scrollType==fgui.ScrollType.Both?this._overlapSize.y=Math.ceil(Math.max(0,this._contentSize.y-this._viewSize.y)):this._overlapSize.y=0,this._xPos=fgui.ToolSet.clamp(this._xPos,0,this._overlapSize.x),this._yPos=fgui.ToolSet.clamp(this._yPos,0,this._overlapSize.y),null!=this._refreshBarAxis){var max=this._overlapSize[this._refreshBarAxis];0==max?max=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):max+=this._footerLockedSize,"x"==this._refreshBarAxis?this._container.pos(fgui.ToolSet.clamp(this._container.x,-max,this._headerLockedSize),fgui.ToolSet.clamp(this._container.y,-this._overlapSize.y,0)):this._container.pos(fgui.ToolSet.clamp(this._container.x,-this._overlapSize.x,0),fgui.ToolSet.clamp(this._container.y,-max,this._headerLockedSize)),null!=this._header&&("x"==this._refreshBarAxis?this._header.height=this._viewSize.y:this._header.width=this._viewSize.x),null!=this._footer&&("y"==this._refreshBarAxis?this._footer.height=this._viewSize.y:this._footer.width=this._viewSize.x)}else this._container.pos(fgui.ToolSet.clamp(this._container.x,-this._overlapSize.x,0),fgui.ToolSet.clamp(this._container.y,-this._overlapSize.y,0));this.syncScrollBar(!0),this.checkRefreshBar(),this._pageMode&&this.updatePageController()}posChanged(ani){0==this._aniFlag?this._aniFlag=ani?1:-1:1!=this._aniFlag||ani||(this._aniFlag=-1),this._needRefresh=!0,Laya.timer.callLater(this,this.refresh)}refresh(){this._needRefresh=!1,Laya.timer.clear(this,this.refresh),(this._pageMode||this._snapToItem)&&(ScrollPane.sEndPos.setTo(-this._xPos,-this._yPos),this.alignPosition(ScrollPane.sEndPos,!1),this._xPos=-ScrollPane.sEndPos.x,this._yPos=-ScrollPane.sEndPos.y),this.refresh2(),fgui.Events.dispatch(fgui.Events.SCROLL,this._owner.displayObject),this._needRefresh&&(this._needRefresh=!1,Laya.timer.clear(this,this.refresh),this.refresh2()),this.syncScrollBar(),this._aniFlag=0}refresh2(){1!=this._aniFlag||this.isDragged?(0!=this._tweening&&this.killTween(),this._container.pos(Math.floor(-this._xPos),Math.floor(-this._yPos)),this.loopCheckingCurrent()):(this._overlapSize.x>0?this.posX=-Math.floor(this._xPos):(0!=this._container.x&&(this._container.x=0),this.posX=0),this._overlapSize.y>0?this.posY=-Math.floor(this._yPos):(0!=this._container.y&&(this._container.y=0),this.posY=0),this.posX!=this._container.x||this.posY!=this._container.y?(this._tweening=1,this._tweenTime.setTo(0,0),this._tweenDuration.setTo(ScrollPane.TWEEN_TIME_GO,ScrollPane.TWEEN_TIME_GO),this._tweenStart.setTo(this._container.x,this._container.y),this._tweenChange.setTo(this.posX-this._tweenStart.x,this.posY-this._tweenStart.y),Laya.timer.frameLoop(1,this,this.tweenUpdate)):0!=this._tweening&&this.killTween());this._pageMode&&this.updatePageController()}syncScrollBar(end=!1){null!=this._vtScrollBar&&(this._vtScrollBar.scrollPerc=0==this._overlapSize.y?0:fgui.ToolSet.clamp(-this._container.y,0,this._overlapSize.y)/this._overlapSize.y,this._scrollBarDisplayAuto&&this.showScrollBar(!end)),null!=this._hzScrollBar&&(this._hzScrollBar.scrollPerc=0==this._overlapSize.x?0:fgui.ToolSet.clamp(-this._container.x,0,this._overlapSize.x)/this._overlapSize.x,this._scrollBarDisplayAuto&&this.showScrollBar(!end)),end&&(this._maskContainer.mouseEnabled=!0)}__mouseDown(){if(this._touchEffect){0!=this._tweening?(this.killTween(),this.isDragged=!0):this.isDragged=!1;var pt=this._owner.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,ScrollPane.sHelperPoint);this._containerPos.setTo(this._container.x,this._container.y),this._beginTouchPos.setTo(pt.x,pt.y),this._lastTouchPos.setTo(pt.x,pt.y),this._lastTouchGlobalPos.setTo(Laya.stage.mouseX,Laya.stage.mouseY),this._isHoldAreaDone=!1,this._velocity.setTo(0,0),this._velocityScale=1,this._lastMoveTime=Laya.timer.currTimer/1e3,this._owner.displayObject.stage.on(Laya.Event.MOUSE_MOVE,this,this.__mouseMove),this._owner.displayObject.stage.on(Laya.Event.MOUSE_UP,this,this.__mouseUp),this._owner.displayObject.stage.on(Laya.Event.CLICK,this,this.__click)}}__mouseMove(){if(this._touchEffect&&(null==ScrollPane.draggingPane||ScrollPane.draggingPane==this)&&null==fgui.GObject.draggingObject){var diff,sv,sh,sensitivity=fgui.UIConfig.touchScrollSensitivity,pt=this._owner.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,ScrollPane.sHelperPoint);if(this._scrollType==fgui.ScrollType.Vertical){if(!this._isHoldAreaDone){if(ScrollPane._gestureFlag|=1,(diff=Math.abs(this._beginTouchPos.y-pt.y))<sensitivity)return;if(0!=(2&ScrollPane._gestureFlag)&&diff<Math.abs(this._beginTouchPos.x-pt.x))return}sv=!0}else if(this._scrollType==fgui.ScrollType.Horizontal){if(!this._isHoldAreaDone){if(ScrollPane._gestureFlag|=2,(diff=Math.abs(this._beginTouchPos.x-pt.x))<sensitivity)return;if(0!=(1&ScrollPane._gestureFlag)&&diff<Math.abs(this._beginTouchPos.y-pt.y))return}sh=!0}else{if(ScrollPane._gestureFlag=3,!this._isHoldAreaDone&&(diff=Math.abs(this._beginTouchPos.y-pt.y))<sensitivity&&(diff=Math.abs(this._beginTouchPos.x-pt.x))<sensitivity)return;sv=sh=!0}var newPosX=Math.floor(this._containerPos.x+pt.x-this._beginTouchPos.x),newPosY=Math.floor(this._containerPos.y+pt.y-this._beginTouchPos.y);sv&&(newPosY>0?this._bouncebackEffect?null!=this._header&&0!=this._header.maxHeight?this._container.y=Math.floor(Math.min(.5*newPosY,this._header.maxHeight)):this._container.y=Math.floor(Math.min(.5*newPosY,this._viewSize.y*ScrollPane.PULL_RATIO)):this._container.y=0:newPosY<-this._overlapSize.y?this._bouncebackEffect?null!=this._footer&&this._footer.maxHeight>0?this._container.y=Math.floor(Math.max(.5*(newPosY+this._overlapSize.y),-this._footer.maxHeight)-this._overlapSize.y):this._container.y=Math.floor(Math.max(.5*(newPosY+this._overlapSize.y),-this._viewSize.y*ScrollPane.PULL_RATIO)-this._overlapSize.y):this._container.y=-this._overlapSize.y:this._container.y=newPosY),sh&&(newPosX>0?this._bouncebackEffect?null!=this._header&&0!=this._header.maxWidth?this._container.x=Math.floor(Math.min(.5*newPosX,this._header.maxWidth)):this._container.x=Math.floor(Math.min(.5*newPosX,this._viewSize.x*ScrollPane.PULL_RATIO)):this._container.x=0:newPosX<0-this._overlapSize.x?this._bouncebackEffect?null!=this._footer&&this._footer.maxWidth>0?this._container.x=Math.floor(Math.max(.5*(newPosX+this._overlapSize.x),-this._footer.maxWidth)-this._overlapSize.x):this._container.x=Math.floor(Math.max(.5*(newPosX+this._overlapSize.x),-this._viewSize.x*ScrollPane.PULL_RATIO)-this._overlapSize.x):this._container.x=-this._overlapSize.x:this._container.x=newPosX);var frameRate=Laya.stage.frameRate==Laya.Stage.FRAME_SLOW?30:60,now=Laya.timer.currTimer/1e3,deltaTime=Math.max(now-this._lastMoveTime,1/frameRate),deltaPositionX=pt.x-this._lastTouchPos.x,deltaPositionY=pt.y-this._lastTouchPos.y;if(sh||(deltaPositionX=0),sv||(deltaPositionY=0),0!=deltaTime){var elapsed=deltaTime*frameRate-1;if(elapsed>1){var factor=Math.pow(.833,elapsed);this._velocity.x=this._velocity.x*factor,this._velocity.y=this._velocity.y*factor}this._velocity.x=fgui.ToolSet.lerp(this._velocity.x,60*deltaPositionX/frameRate/deltaTime,10*deltaTime),this._velocity.y=fgui.ToolSet.lerp(this._velocity.y,60*deltaPositionY/frameRate/deltaTime,10*deltaTime)}var deltaGlobalPositionX=this._lastTouchGlobalPos.x-Laya.stage.mouseX,deltaGlobalPositionY=this._lastTouchGlobalPos.y-Laya.stage.mouseY;0!=deltaPositionX?this._velocityScale=Math.abs(deltaGlobalPositionX/deltaPositionX):0!=deltaPositionY&&(this._velocityScale=Math.abs(deltaGlobalPositionY/deltaPositionY)),this._lastTouchPos.setTo(pt.x,pt.y),this._lastTouchGlobalPos.setTo(Laya.stage.mouseX,Laya.stage.mouseY),this._lastMoveTime=now,this._overlapSize.x>0&&(this._xPos=fgui.ToolSet.clamp(-this._container.x,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=fgui.ToolSet.clamp(-this._container.y,0,this._overlapSize.y)),0!=this._loop&&(newPosX=this._container.x,newPosY=this._container.y,this.loopCheckingCurrent()&&(this._containerPos.x+=this._container.x-newPosX,this._containerPos.y+=this._container.y-newPosY)),ScrollPane.draggingPane=this,this._isHoldAreaDone=!0,this.isDragged=!0,this._maskContainer.mouseEnabled=!1,this.syncScrollBar(),this.checkRefreshBar(),this._pageMode&&this.updatePageController(),fgui.Events.dispatch(fgui.Events.SCROLL,this._owner.displayObject)}}__mouseUp(){if(this._owner.displayObject.stage.off(Laya.Event.MOUSE_MOVE,this,this.__mouseMove),this._owner.displayObject.stage.off(Laya.Event.MOUSE_UP,this,this.__mouseUp),this._owner.displayObject.stage.off(Laya.Event.CLICK,this,this.__click),ScrollPane.draggingPane==this&&(ScrollPane.draggingPane=null),ScrollPane._gestureFlag=0,!this.isDragged||!this._touchEffect)return this.isDragged=!1,void(this._maskContainer.mouseEnabled=!0);this.isDragged=!1,this._maskContainer.mouseEnabled=!0,this._tweenStart.setTo(this._container.x,this._container.y),ScrollPane.sEndPos.setTo(this._tweenStart.x,this._tweenStart.y);var flag=!1;if(this._container.x>0?(ScrollPane.sEndPos.x=0,flag=!0):this._container.x<-this._overlapSize.x&&(ScrollPane.sEndPos.x=-this._overlapSize.x,flag=!0),this._container.y>0?(ScrollPane.sEndPos.y=0,flag=!0):this._container.y<-this._overlapSize.y&&(ScrollPane.sEndPos.y=-this._overlapSize.y,flag=!0),flag){if(this._tweenChange.setTo(ScrollPane.sEndPos.x-this._tweenStart.x,ScrollPane.sEndPos.y-this._tweenStart.y),this._tweenChange.x<-fgui.UIConfig.touchDragSensitivity||this._tweenChange.y<-fgui.UIConfig.touchDragSensitivity?(this._refreshEventDispatching=!0,fgui.Events.dispatch(fgui.Events.PULL_DOWN_RELEASE,this._owner.displayObject),this._refreshEventDispatching=!1):(this._tweenChange.x>fgui.UIConfig.touchDragSensitivity||this._tweenChange.y>fgui.UIConfig.touchDragSensitivity)&&(this._refreshEventDispatching=!0,fgui.Events.dispatch(fgui.Events.PULL_UP_RELEASE,this._owner.displayObject),this._refreshEventDispatching=!1),this._headerLockedSize>0&&0==ScrollPane.sEndPos[this._refreshBarAxis])ScrollPane.sEndPos[this._refreshBarAxis]=this._headerLockedSize,this._tweenChange.x=ScrollPane.sEndPos.x-this._tweenStart.x,this._tweenChange.y=ScrollPane.sEndPos.y-this._tweenStart.y;else if(this._footerLockedSize>0&&ScrollPane.sEndPos[this._refreshBarAxis]==-this._overlapSize[this._refreshBarAxis]){var max=this._overlapSize[this._refreshBarAxis];0==max?max=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):max+=this._footerLockedSize,ScrollPane.sEndPos[this._refreshBarAxis]=-max,this._tweenChange.x=ScrollPane.sEndPos.x-this._tweenStart.x,this._tweenChange.y=ScrollPane.sEndPos.y-this._tweenStart.y}this._tweenDuration.setTo(ScrollPane.TWEEN_TIME_DEFAULT,ScrollPane.TWEEN_TIME_DEFAULT)}else{if(this._inertiaDisabled)this._tweenDuration.setTo(ScrollPane.TWEEN_TIME_DEFAULT,ScrollPane.TWEEN_TIME_DEFAULT);else{var frameRate=Laya.stage.frameRate==Laya.Stage.FRAME_SLOW?30:60,elapsed=(Laya.timer.currTimer/1e3-this._lastMoveTime)*frameRate-1;if(elapsed>1){var factor=Math.pow(.833,elapsed);this._velocity.x=this._velocity.x*factor,this._velocity.y=this._velocity.y*factor}this.updateTargetAndDuration(this._tweenStart,ScrollPane.sEndPos)}if(ScrollPane.sOldChange.setTo(ScrollPane.sEndPos.x-this._tweenStart.x,ScrollPane.sEndPos.y-this._tweenStart.y),this.loopCheckingTarget(ScrollPane.sEndPos),(this._pageMode||this._snapToItem)&&this.alignPosition(ScrollPane.sEndPos,!0),this._tweenChange.x=ScrollPane.sEndPos.x-this._tweenStart.x,this._tweenChange.y=ScrollPane.sEndPos.y-this._tweenStart.y,0==this._tweenChange.x&&0==this._tweenChange.y)return void(this._scrollBarDisplayAuto&&this.showScrollBar(!1));(this._pageMode||this._snapToItem)&&(this.fixDuration("x",ScrollPane.sOldChange.x),this.fixDuration("y",ScrollPane.sOldChange.y))}this._tweening=2,this._tweenTime.setTo(0,0),Laya.timer.frameLoop(1,this,this.tweenUpdate)}__click(){this.isDragged=!1}__mouseWheel(evt){if(this._mouseWheelEnabled){this._owner.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY,ScrollPane.sHelperPoint);var delta=evt.delta;delta=delta>0?-1:delta<0?1:0,this._overlapSize.x>0&&0==this._overlapSize.y?this._pageMode?this.setPosX(this._xPos+this._pageSize.x*delta,!1):this.setPosX(this._xPos+this._mouseWheelStep*delta,!1):this._pageMode?this.setPosY(this._yPos+this._pageSize.y*delta,!1):this.setPosY(this._yPos+this._mouseWheelStep*delta,!1)}}__rollOver(){this.showScrollBar(!0)}__rollOut(){this.showScrollBar(!1)}showScrollBar(val){val?(this.__showScrollBar(!0),Laya.timer.clear(this,this.__showScrollBar)):Laya.timer.once(500,this,this.__showScrollBar,[val])}__showScrollBar(val){this._scrollBarVisible=val&&this._viewSize.x>0&&this._viewSize.y>0,this._vtScrollBar&&(this._vtScrollBar.displayObject.visible=this._scrollBarVisible&&!this._vScrollNone),this._hzScrollBar&&(this._hzScrollBar.displayObject.visible=this._scrollBarVisible&&!this._hScrollNone)}getLoopPartSize(division,axis){return(this._contentSize[axis]+("x"==axis?this._owner.columnGap:this._owner.lineGap))/division}loopCheckingCurrent(){var changed=!1;return 1==this._loop&&this._overlapSize.x>0?this._xPos<.001?(this._xPos+=this.getLoopPartSize(2,"x"),changed=!0):this._xPos>=this._overlapSize.x&&(this._xPos-=this.getLoopPartSize(2,"x"),changed=!0):2==this._loop&&this._overlapSize.y>0&&(this._yPos<.001?(this._yPos+=this.getLoopPartSize(2,"y"),changed=!0):this._yPos>=this._overlapSize.y&&(this._yPos-=this.getLoopPartSize(2,"y"),changed=!0)),changed&&this._container.pos(Math.floor(-this._xPos),Math.floor(-this._yPos)),changed}loopCheckingTarget(endPos){1==this._loop&&this.loopCheckingTarget2(endPos,"x"),2==this._loop&&this.loopCheckingTarget2(endPos,"y")}loopCheckingTarget2(endPos,axis){var halfSize,tmp;endPos[axis]>0?(halfSize=this.getLoopPartSize(2,axis),(tmp=this._tweenStart[axis]-halfSize)<=0&&tmp>=-this._overlapSize[axis]&&(endPos[axis]-=halfSize,this._tweenStart[axis]=tmp)):endPos[axis]<-this._overlapSize[axis]&&(halfSize=this.getLoopPartSize(2,axis),(tmp=this._tweenStart[axis]+halfSize)<=0&&tmp>=-this._overlapSize[axis]&&(endPos[axis]+=halfSize,this._tweenStart[axis]=tmp))}loopCheckingNewPos(value,axis){if(0==this._overlapSize[axis])return value;var v,pos="x"==axis?this._xPos:this._yPos,changed=!1;return value<.001?(value+=this.getLoopPartSize(2,axis))>pos&&(v=this.getLoopPartSize(6,axis),v=Math.ceil((value-pos)/v)*v,pos=fgui.ToolSet.clamp(pos+v,0,this._overlapSize[axis]),changed=!0):value>=this._overlapSize[axis]&&(value-=this.getLoopPartSize(2,axis))<pos&&(v=this.getLoopPartSize(6,axis),v=Math.ceil((pos-value)/v)*v,pos=fgui.ToolSet.clamp(pos-v,0,this._overlapSize[axis]),changed=!0),changed&&("x"==axis?this._container.x=-Math.floor(pos):this._container.y=-Math.floor(pos)),value}alignPosition(pos,inertialScrolling){if(this._pageMode)pos.x=this.alignByPage(pos.x,"x",inertialScrolling),pos.y=this.alignByPage(pos.y,"y",inertialScrolling);else if(this._snapToItem){var xDir=0,yDir=0;inertialScrolling&&(xDir=pos.x-this._containerPos.x,yDir=pos.y-this._containerPos.y);var pt=this._owner.getSnappingPositionWithDir(-pos.x,-pos.y,xDir,yDir,ScrollPane.sHelperPoint);pos.x<0&&pos.x>-this._overlapSize.x&&(pos.x=-pt.x),pos.y<0&&pos.y>-this._overlapSize.y&&(pos.y=-pt.y)}}alignByPage(pos,axis,inertialScrolling){var page;if(pos>0)page=0;else if(pos<-this._overlapSize[axis])page=Math.ceil(this._contentSize[axis]/this._pageSize[axis])-1;else{page=Math.floor(-pos/this._pageSize[axis]);var change=inertialScrolling?pos-this._containerPos[axis]:pos-this._container[axis],testPageSize=Math.min(this._pageSize[axis],this._contentSize[axis]-(page+1)*this._pageSize[axis]),delta=-pos-page*this._pageSize[axis];Math.abs(change)>this._pageSize[axis]?delta>.5*testPageSize&&page++:delta>testPageSize*(change<0?fgui.UIConfig.defaultScrollPagingThreshold:1-fgui.UIConfig.defaultScrollPagingThreshold)&&page++,(pos=-page*this._pageSize[axis])<-this._overlapSize[axis]&&(pos=-this._overlapSize[axis])}if(inertialScrolling){var oldPage,oldPos=this._tweenStart[axis];oldPage=oldPos>0?0:oldPos<-this._overlapSize[axis]?Math.ceil(this._contentSize[axis]/this._pageSize[axis])-1:Math.floor(-oldPos/this._pageSize[axis]);var startPage=Math.floor(-this._containerPos[axis]/this._pageSize[axis]);Math.abs(page-startPage)>1&&Math.abs(oldPage-startPage)<=1&&(pos=-(page=page>startPage?startPage+1:startPage-1)*this._pageSize[axis])}return pos}updateTargetAndDuration(orignPos,resultPos){resultPos.x=this.updateTargetAndDuration2(orignPos.x,"x"),resultPos.y=this.updateTargetAndDuration2(orignPos.y,"y")}updateTargetAndDuration2(pos,axis){var v=this._velocity[axis],duration=0;if(pos>0)pos=0;else if(pos<-this._overlapSize[axis])pos=-this._overlapSize[axis];else{var v2=Math.abs(v)*this._velocityScale;Laya.Browser.onMobile&&(v2*=1136/Math.max(Laya.stage.width,Laya.stage.height));var ratio=0;if(this._pageMode||!Laya.Browser.onMobile?v2>500&&(ratio=Math.pow((v2-500)/500,2)):v2>1e3&&(ratio=Math.pow((v2-1e3)/1e3,2)),0!=ratio)ratio>1&&(ratio=1),v2*=ratio,v*=ratio,this._velocity[axis]=v,duration=Math.log(60/v2)/Math.log(this._decelerationRate)/60,pos+=Math.floor(v*duration*.4)}return duration<ScrollPane.TWEEN_TIME_DEFAULT&&(duration=ScrollPane.TWEEN_TIME_DEFAULT),this._tweenDuration[axis]=duration,pos}fixDuration(axis,oldChange){if(!(0==this._tweenChange[axis]||Math.abs(this._tweenChange[axis])>=Math.abs(oldChange))){var newDuration=Math.abs(this._tweenChange[axis]/oldChange)*this._tweenDuration[axis];newDuration<ScrollPane.TWEEN_TIME_DEFAULT&&(newDuration=ScrollPane.TWEEN_TIME_DEFAULT),this._tweenDuration[axis]=newDuration}}killTween(){1==this._tweening&&(this._container.pos(this._tweenStart.x+this._tweenChange.x,this._tweenStart.y+this._tweenChange.y),fgui.Events.dispatch(fgui.Events.SCROLL,this._owner.displayObject)),this._tweening=0,Laya.timer.clear(this,this.tweenUpdate),fgui.Events.dispatch(fgui.Events.SCROLL_END,this._owner.displayObject)}checkRefreshBar(){if(null!=this._header||null!=this._footer){var pos=this._container[this._refreshBarAxis];if(null!=this._header)if(pos>0){null==this._header.displayObject.parent&&this._maskContainer.addChildAt(this._header.displayObject,0);var pt=ScrollPane.sHelperPoint;pt.setTo(this._header.width,this._header.height),pt[this._refreshBarAxis]=pos,this._header.setSize(pt.x,pt.y)}else null!=this._header.displayObject.parent&&this._maskContainer.removeChild(this._header.displayObject);if(null!=this._footer){var max=this._overlapSize[this._refreshBarAxis];pos<-max||0==max&&this._footerLockedSize>0?(null==this._footer.displayObject.parent&&this._maskContainer.addChildAt(this._footer.displayObject,0),(pt=ScrollPane.sHelperPoint).setTo(this._footer.x,this._footer.y),pt[this._refreshBarAxis]=max>0?pos+this._contentSize[this._refreshBarAxis]:Math.max(Math.min(pos+this._viewSize[this._refreshBarAxis],this._viewSize[this._refreshBarAxis]-this._footerLockedSize),this._viewSize[this._refreshBarAxis]-this._contentSize[this._refreshBarAxis]),this._footer.setXY(pt.x,pt.y),pt.setTo(this._footer.width,this._footer.height),pt[this._refreshBarAxis]=max>0?-max-pos:this._viewSize[this._refreshBarAxis]-this._footer[this._refreshBarAxis],this._footer.setSize(pt.x,pt.y)):null!=this._footer.displayObject.parent&&this._maskContainer.removeChild(this._footer.displayObject)}}}tweenUpdate(){var nx=this.runTween("x"),ny=this.runTween("y");this._container.pos(nx,ny),2==this._tweening&&(this._overlapSize.x>0&&(this._xPos=fgui.ToolSet.clamp(-nx,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=fgui.ToolSet.clamp(-ny,0,this._overlapSize.y)),this._pageMode&&this.updatePageController()),0==this._tweenChange.x&&0==this._tweenChange.y?(this._tweening=0,Laya.timer.clear(this,this.tweenUpdate),this.loopCheckingCurrent(),this.syncScrollBar(!0),this.checkRefreshBar(),fgui.Events.dispatch(fgui.Events.SCROLL,this._owner.displayObject),fgui.Events.dispatch(fgui.Events.SCROLL_END,this._owner.displayObject)):(this.syncScrollBar(!1),this.checkRefreshBar(),fgui.Events.dispatch(fgui.Events.SCROLL,this._owner.displayObject))}runTween(axis){var newValue;if(0!=this._tweenChange[axis]){if(this._tweenTime[axis]+=Laya.timer.delta/1e3,this._tweenTime[axis]>=this._tweenDuration[axis])newValue=this._tweenStart[axis]+this._tweenChange[axis],this._tweenChange[axis]=0;else{var ratio=ScrollPane.easeFunc(this._tweenTime[axis],this._tweenDuration[axis]);newValue=this._tweenStart[axis]+Math.floor(this._tweenChange[axis]*ratio)}var threshold1=0,threshold2=-this._overlapSize[axis];if(this._headerLockedSize>0&&this._refreshBarAxis==axis&&(threshold1=this._headerLockedSize),this._footerLockedSize>0&&this._refreshBarAxis==axis){var max=this._overlapSize[this._refreshBarAxis];0==max?max=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):max+=this._footerLockedSize,threshold2=-max}2==this._tweening&&this._bouncebackEffect?newValue>20+threshold1&&this._tweenChange[axis]>0||newValue>threshold1&&0==this._tweenChange[axis]?(this._tweenTime[axis]=0,this._tweenDuration[axis]=ScrollPane.TWEEN_TIME_DEFAULT,this._tweenChange[axis]=-newValue+threshold1,this._tweenStart[axis]=newValue):(newValue<threshold2-20&&this._tweenChange[axis]<0||newValue<threshold2&&0==this._tweenChange[axis])&&(this._tweenTime[axis]=0,this._tweenDuration[axis]=ScrollPane.TWEEN_TIME_DEFAULT,this._tweenChange[axis]=threshold2-newValue,this._tweenStart[axis]=newValue):newValue>threshold1?(newValue=threshold1,this._tweenChange[axis]=0):newValue<threshold2&&(newValue=threshold2,this._tweenChange[axis]=0)}else newValue=this._container[axis];return newValue}static easeFunc(t,d){return(t=t/d-1)*t*t+1}}ScrollPane._gestureFlag=0,ScrollPane.sHelperPoint=new Laya.Point,ScrollPane.sHelperRect=new Laya.Rectangle,ScrollPane.sEndPos=new Laya.Point,ScrollPane.sOldChange=new Laya.Point,ScrollPane.TWEEN_TIME_GO=.5,ScrollPane.TWEEN_TIME_DEFAULT=.3,ScrollPane.PULL_RATIO=.5,fgui.ScrollPane=ScrollPane}(fgui||(fgui={})),function(fgui){class UIConfig{constructor(){}}UIConfig.defaultFont="SimSun",UIConfig.modalLayerColor="rgba(33,33,33,0.2)",UIConfig.buttonSoundVolumeScale=1,UIConfig.defaultScrollStep=25,UIConfig.defaultScrollDecelerationRate=.967,UIConfig.defaultScrollBarDisplay=fgui.ScrollBarDisplayType.Visible,UIConfig.defaultScrollTouchEffect=!0,UIConfig.defaultScrollBounceEffect=!0,UIConfig.defaultScrollSnappingThreshold=.1,UIConfig.defaultScrollPagingThreshold=.3,UIConfig.defaultComboBoxVisibleItemCount=10,UIConfig.touchScrollSensitivity=20,UIConfig.touchDragSensitivity=10,UIConfig.clickDragSensitivity=2,UIConfig.bringWindowToFrontOnClick=!0,UIConfig.frameTimeForAsyncUIConstruction=2,UIConfig.textureLinearSampling=!0,UIConfig.packageFileExtension="fui",fgui.UIConfig=UIConfig}(fgui||(fgui={})),function(fgui){class UIObjectFactory{static setPackageItemExtension(url,type){if(null==url)throw new Error("Invaild url: "+url);var pi=fgui.UIPackage.getItemByURL(url);null!=pi&&(pi.extensionType=type),UIObjectFactory.packageItemExtensions[url]=type}static setLoaderExtension(type){UIObjectFactory.loaderType=type}static resolvePackageItemExtension(pi){pi.extensionType=UIObjectFactory.packageItemExtensions["ui://"+pi.owner.id+pi.id],pi.extensionType||(pi.extensionType=UIObjectFactory.packageItemExtensions["ui://"+pi.owner.name+"/"+pi.name])}static newObject(pi){return pi.extensionType?new pi.extensionType:UIObjectFactory.newObject2(pi.objectType)}static newObject2(type){switch(type){case fgui.ObjectType.Image:return new fgui.GImage;case fgui.ObjectType.MovieClip:return new fgui.GMovieClip;case fgui.ObjectType.Component:return new fgui.GComponent;case fgui.ObjectType.Text:return new fgui.GBasicTextField;case fgui.ObjectType.RichText:return new fgui.GRichTextField;case fgui.ObjectType.InputText:return new fgui.GTextInput;case fgui.ObjectType.Group:return new fgui.GGroup;case fgui.ObjectType.List:return new fgui.GList;case fgui.ObjectType.Graph:return new fgui.GGraph;case fgui.ObjectType.Loader:return UIObjectFactory.loaderType?new UIObjectFactory.loaderType:new fgui.GLoader;case fgui.ObjectType.Button:return new fgui.GButton;case fgui.ObjectType.Label:return new fgui.GLabel;case fgui.ObjectType.ProgressBar:return new fgui.GProgressBar;case fgui.ObjectType.Slider:return new fgui.GSlider;case fgui.ObjectType.ScrollBar:return new fgui.GScrollBar;case fgui.ObjectType.ComboBox:return new fgui.GComboBox;default:return null}}}UIObjectFactory.packageItemExtensions={},fgui.UIObjectFactory=UIObjectFactory}(fgui||(fgui={})),function(fgui){class UIPackage{constructor(){this._items=[],this._itemsById={},this._itemsByName={},this._sprites={}}static getById(id){return UIPackage._instById[id]}static getByName(name){return UIPackage._instByName[name]}static addPackage(resKey,descData){if(!(descData||(descData=fgui.AssetProxy.inst.getRes(resKey+"."+fgui.UIConfig.packageFileExtension))&&0!=descData.byteLength))throw new Error("namespace sunnyboxs not ready: "+resKey);var buffer=new fgui.ByteBuffer(descData),pkg=new UIPackage;return pkg.loadPackage(buffer,resKey),UIPackage._instById[pkg.id]=pkg,UIPackage._instByName[pkg.name]=pkg,pkg._customId=resKey,pkg}static loadPackage(resKey,completeHandler){let url=resKey+"."+fgui.UIConfig.packageFileExtension;var descCompleteHandler=Laya.Handler.create(this,function(asset){let pkg=new UIPackage;pkg.loadPackage(new fgui.ByteBuffer(asset),resKey);let cnt=pkg._items.length,urls=[];for(var i=0;i<cnt;i++){var pi=pkg._items[i];pi.type==fgui.PackageItemType.Atlas?urls.push({url:pi.file,type:Laya.Loader.IMAGE}):pi.type==fgui.PackageItemType.Sound&&urls.push({url:pi.file,type:Laya.Loader.SOUND})}urls.length>0?fgui.AssetProxy.inst.load(urls,Laya.Handler.create(this,function(){UIPackage._instById[pkg.id]=pkg,UIPackage._instByName[pkg.name]=pkg,completeHandler.run()})):completeHandler.run()});fgui.AssetProxy.inst.load(url,descCompleteHandler,null,Laya.Loader.BUFFER)}static removePackage(packageIdOrName){var pkg=UIPackage._instById[packageIdOrName];if(pkg||(pkg=UIPackage._instByName[packageIdOrName]),!pkg)throw new Error("unknown package: "+packageIdOrName);pkg.dispose(),delete UIPackage._instById[pkg.id],null!=pkg._customId&&delete UIPackage._instById[pkg._customId],delete UIPackage._instByName[pkg.name]}static createObject(pkgName,resName,userClass){var pkg=UIPackage.getByName(pkgName);return pkg?pkg.createObject(resName,userClass):null}static createObjectFromURL(url,userClass){var pi=UIPackage.getItemByURL(url);return pi?pi.owner.internalCreateObject(pi,userClass):null}static getItemURL(pkgName,resName){var pkg=UIPackage.getByName(pkgName);if(!pkg)return null;var pi=pkg._itemsByName[resName];return pi?"ui://"+pkg.id+pi.id:null}static getItemByURL(url){var pos1=url.indexOf("//");if(-1==pos1)return null;var pos2=url.indexOf("/",pos1+2);if(-1==pos2){if(url.length>13){var pkgId=url.substr(5,8),pkg=UIPackage.getById(pkgId);if(null!=pkg){var srcId=url.substr(13);return pkg.getItemById(srcId)}}}else{var pkgName=url.substr(pos1+2,pos2-pos1-2);if(null!=(pkg=UIPackage.getByName(pkgName))){var srcName=url.substr(pos2+1);return pkg.getItemByName(srcName)}}return null}static getItemAssetByURL(url){var item=UIPackage.getItemByURL(url);return null==item?null:item.owner.getItemAsset(item)}static normalizeURL(url){if(null==url)return null;var pos1=url.indexOf("//");if(-1==pos1)return null;var pos2=url.indexOf("/",pos1+2);if(-1==pos2)return url;var pkgName=url.substr(pos1+2,pos2-pos1-2),srcName=url.substr(pos2+1);return UIPackage.getItemURL(pkgName,srcName)}static setStringsSource(source){fgui.TranslationHelper.loadFromXML(source)}loadPackage(buffer,resKey){if(1179080009!=buffer.getUint32())throw new Error("FairyGUI: old namespace sunnyboxs found in '"+resKey+"'");buffer.version=buffer.getInt32();var compressed=buffer.readBool();if(this._id=buffer.readUTFString(),this._name=buffer.readUTFString(),buffer.skip(20),compressed){var buf=new Uint8Array(buffer.buffer,buffer.pos,buffer.length-buffer.pos);buf=new Zlib.RawInflate(buf).decompress(),buffer=new fgui.ByteBuffer(buf)}var cnt,i,nextPos,indexTablePos=buffer.pos;buffer.seek(indexTablePos,4),cnt=buffer.getInt32();var pi,stringTable=[];for(i=0;i<cnt;i++)stringTable[i]=buffer.readUTFString();for(buffer.stringTable=stringTable,buffer.seek(indexTablePos,1),resKey+="_",cnt=buffer.getUint16(),i=0;i<cnt;i++){switch(nextPos=buffer.getInt32(),nextPos+=buffer.pos,(pi=new fgui.PackageItem).owner=this,pi.type=buffer.readByte(),pi.id=buffer.readS(),pi.name=buffer.readS(),buffer.readS(),pi.file=buffer.readS(),buffer.readBool(),pi.width=buffer.getInt32(),pi.height=buffer.getInt32(),pi.type){case fgui.PackageItemType.Image:pi.objectType=fgui.ObjectType.Image;var scaleOption=buffer.readByte();1==scaleOption?(pi.scale9Grid=new Laya.Rectangle,pi.scale9Grid.x=buffer.getInt32(),pi.scale9Grid.y=buffer.getInt32(),pi.scale9Grid.width=buffer.getInt32(),pi.scale9Grid.height=buffer.getInt32(),pi.tileGridIndice=buffer.getInt32()):2==scaleOption&&(pi.scaleByTile=!0),pi.smoothing=buffer.readBool();break;case fgui.PackageItemType.MovieClip:pi.smoothing=buffer.readBool(),pi.objectType=fgui.ObjectType.MovieClip,pi.rawData=buffer.readBuffer();break;case fgui.PackageItemType.Font:pi.rawData=buffer.readBuffer();break;case fgui.PackageItemType.Component:var extension=buffer.readByte();pi.objectType=extension>0?extension:fgui.ObjectType.Component,pi.rawData=buffer.readBuffer(),fgui.UIObjectFactory.resolvePackageItemExtension(pi);break;case fgui.PackageItemType.Atlas:case fgui.PackageItemType.Sound:case fgui.PackageItemType.Misc:pi.file=resKey+pi.file}this._items.push(pi),this._itemsById[pi.id]=pi,null!=pi.name&&(this._itemsByName[pi.name]=pi),buffer.pos=nextPos}for(buffer.seek(indexTablePos,2),cnt=buffer.getUint16(),i=0;i<cnt;i++){nextPos=buffer.getUint16(),nextPos+=buffer.pos;var itemId=buffer.readS();pi=this._itemsById[buffer.readS()];var sprite=new AtlasSprite;sprite.atlas=pi,sprite.rect.x=buffer.getInt32(),sprite.rect.y=buffer.getInt32(),sprite.rect.width=buffer.getInt32(),sprite.rect.height=buffer.getInt32(),sprite.rotated=buffer.readBool(),this._sprites[itemId]=sprite,buffer.pos=nextPos}if(buffer.seek(indexTablePos,3))for(cnt=buffer.getUint16(),i=0;i<cnt;i++)nextPos=buffer.getInt32(),nextPos+=buffer.pos,(pi=this._itemsById[buffer.readS()])&&pi.type==fgui.PackageItemType.Image&&(pi.pixelHitTestData=new fgui.PixelHitTestData,pi.pixelHitTestData.load(buffer)),buffer.pos=nextPos}loadAllAssets(){for(var cnt=this._items.length,i=0;i<cnt;i++){var pi=this._items[i];this.getItemAsset(pi)}}unloadAssets(){for(var cnt=this._items.length,i=0;i<cnt;i++){var pi=this._items[i];pi.type==fgui.PackageItemType.Atlas&&null!=pi.texture&&Laya.loader.clearTextureRes(pi.texture.url)}}dispose(){for(var cnt=this._items.length,i=0;i<cnt;i++){var pi=this._items[i];pi.type==fgui.PackageItemType.Atlas?null!=pi.texture&&(pi.texture.destroy(),pi.texture=null):pi.type==fgui.PackageItemType.Sound&&Laya.SoundManager.destroySound(pi.file)}}get id(){return this._id}get name(){return this._name}get customId(){return this._customId}set customId(value){null!=this._customId&&delete UIPackage._instById[this._customId],this._customId=value,null!=this._customId&&(UIPackage._instById[this._customId]=this)}createObject(resName,userClass){var pi=this._itemsByName[resName];return pi?this.internalCreateObject(pi,userClass):null}internalCreateObject(item,userClass){var g;return null==(g=item.type==fgui.PackageItemType.Component&&userClass?new userClass:fgui.UIObjectFactory.newObject(item))?null:(UIPackage._constructing++,g.packageItem=item,g.constructFromResource(),UIPackage._constructing--,g)}getItemById(itemId){return this._itemsById[itemId]}getItemByName(resName){return this._itemsByName[resName]}getItemAssetByName(resName){var pi=this._itemsByName[resName];if(null==pi)throw"Resource not found -"+resName;return this.getItemAsset(pi)}getItemAsset(item){switch(item.type){case fgui.PackageItemType.Image:if(!item.decoded){item.decoded=!0;var sprite=this._sprites[item.id];if(null!=sprite){var atlasTexture=this.getItemAsset(sprite.atlas);item.texture=Laya.Texture.create(atlasTexture,sprite.rect.x,sprite.rect.y,sprite.rect.width,sprite.rect.height)}else item.texture=null}return item.texture;case fgui.PackageItemType.Atlas:return item.decoded||(item.decoded=!0,item.texture=fgui.AssetProxy.inst.getRes(item.file)),item.texture;case fgui.PackageItemType.Font:return item.decoded||(item.decoded=!0,this.loadFont(item)),item.bitmapFont;case fgui.PackageItemType.MovieClip:return item.decoded||(item.decoded=!0,this.loadMovieClip(item)),item.frames;case fgui.PackageItemType.Component:return item.rawData;case fgui.PackageItemType.Misc:return item.file?fgui.AssetProxy.inst.getRes(item.file):null;default:return null}}loadMovieClip(item){var buffer=item.rawData;buffer.seek(0,0),item.interval=buffer.getInt32(),item.swing=buffer.readBool(),item.repeatDelay=buffer.getInt32(),buffer.seek(0,1);var spriteId,frame,sprite,fx,fy,frameCount=buffer.getInt16();item.frames=[];for(var i=0;i<frameCount;i++){var nextPos=buffer.getInt16();if(nextPos+=buffer.pos,frame=new fgui.Frame,fx=buffer.getInt32(),fy=buffer.getInt32(),buffer.getInt32(),buffer.getInt32(),frame.addDelay=buffer.getInt32(),null!=(spriteId=buffer.readS())&&null!=(sprite=this._sprites[spriteId])){var atlasTexture=this.getItemAsset(sprite.atlas);frame.texture=Laya.Texture.create(atlasTexture,sprite.rect.x,sprite.rect.y,sprite.rect.width,sprite.rect.height,fx,fy,item.width,item.height)}item.frames[i]=frame,buffer.pos=nextPos}}loadFont(item){var font=new fgui.BitmapFont;item.bitmapFont=font;var buffer=item.rawData;buffer.seek(0,0),font.ttf=buffer.readBool(),buffer.readBool(),font.resizable=buffer.readBool(),buffer.readBool(),font.size=buffer.getInt32();var xadvance=buffer.getInt32(),lineHeight=buffer.getInt32(),mainTexture=null,mainSprite=this._sprites[item.id];null!=mainSprite&&(mainTexture=this.getItemAsset(mainSprite.atlas)),buffer.seek(0,1);for(var bg=null,cnt=buffer.getInt32(),i=0;i<cnt;i++){var nextPos=buffer.getInt16();nextPos+=buffer.pos,bg=new fgui.BMGlyph;var ch=buffer.readChar();font.glyphs[ch]=bg;var img=buffer.readS(),bx=buffer.getInt32(),by=buffer.getInt32();if(bg.offsetX=buffer.getInt32(),bg.offsetY=buffer.getInt32(),bg.width=buffer.getInt32(),bg.height=buffer.getInt32(),bg.advance=buffer.getInt32(),bg.channel=buffer.readByte(),1==bg.channel?bg.channel=3:2==bg.channel?bg.channel=2:3==bg.channel&&(bg.channel=1),font.ttf)bg.texture=Laya.Texture.create(mainTexture,bx+mainSprite.rect.x,by+mainSprite.rect.y,bg.width,bg.height);else{var charImg=this._itemsById[img];charImg&&(this.getItemAsset(charImg),bg.width=charImg.width,bg.height=charImg.height,bg.texture=charImg.texture)}font.ttf?bg.lineHeight=lineHeight:(0==bg.advance&&(bg.advance=0==xadvance?bg.offsetX+bg.width:xadvance),bg.lineHeight=bg.offsetY<0?bg.height:bg.offsetY+bg.height,bg.lineHeight<font.size&&(bg.lineHeight=font.size)),buffer.pos=nextPos}}}UIPackage._constructing=0,UIPackage._instById={},UIPackage._instByName={},fgui.UIPackage=UIPackage;class AtlasSprite{constructor(){this.rect=new Laya.Rectangle}}}(fgui||(fgui={})),function(fgui){fgui.Window=class extends fgui.GComponent{constructor(){super(),this._requestingCmd=0,this.focusable=!0,this._uiSources=[],this.bringToFontOnClick=fgui.UIConfig.bringWindowToFrontOnClick,this.displayObject.on(Laya.Event.DISPLAY,this,this.__onShown),this.displayObject.on(Laya.Event.UNDISPLAY,this,this.__onHidden),this.displayObject.on(Laya.Event.MOUSE_DOWN,this,this.__mouseDown)}addUISource(source){this._uiSources.push(source)}set contentPane(val){this._contentPane!=val&&(null!=this._contentPane&&this.removeChild(this._contentPane),this._contentPane=val,null!=this._contentPane&&(this.addChild(this._contentPane),this.setSize(this._contentPane.width,this._contentPane.height),this._contentPane.addRelation(this,fgui.RelationType.Size),this._frame=this._contentPane.getChild("frame"),null!=this._frame&&(this.closeButton=this._frame.getChild("closeButton"),this.dragArea=this._frame.getChild("dragArea"),this.contentArea=this._frame.getChild("contentArea"))))}get contentPane(){return this._contentPane}get frame(){return this._frame}get closeButton(){return this._closeButton}set closeButton(value){null!=this._closeButton&&this._closeButton.offClick(this,this.closeEventHandler),this._closeButton=value,null!=this._closeButton&&this._closeButton.onClick(this,this.closeEventHandler)}get dragArea(){return this._dragArea}set dragArea(value){this._dragArea!=value&&(null!=this._dragArea&&(this._dragArea.draggable=!1,this._dragArea.off(fgui.Events.DRAG_START,this,this.__dragStart)),this._dragArea=value,null!=this._dragArea&&(this._dragArea instanceof fgui.GGraph&&this._dragArea.asGraph.drawRect(0,null,null),this._dragArea.draggable=!0,this._dragArea.on(fgui.Events.DRAG_START,this,this.__dragStart)))}get contentArea(){return this._contentArea}set contentArea(value){this._contentArea=value}show(){fgui.GRoot.inst.showWindow(this)}showOn(root){root.showWindow(this)}hide(){this.isShowing&&this.doHideAnimation()}hideImmediately(){var r=this.parent instanceof fgui.GRoot?this.parent:null;r||(r=fgui.GRoot.inst),r.hideWindowImmediately(this)}centerOn(r,restraint=!1){this.setXY(Math.round((r.width-this.width)/2),Math.round((r.height-this.height)/2)),restraint&&(this.addRelation(r,fgui.RelationType.Center_Center),this.addRelation(r,fgui.RelationType.Middle_Middle))}toggleStatus(){this.isTop?this.hide():this.show()}get isShowing(){return null!=this.parent}get isTop(){return null!=this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1}get modal(){return this._modal}set modal(val){this._modal=val}bringToFront(){this.root.bringToFront(this)}showModalWait(requestingCmd=0){0!=requestingCmd&&(this._requestingCmd=requestingCmd),fgui.UIConfig.windowModalWaiting&&(this._modalWaitPane||(this._modalWaitPane=fgui.UIPackage.createObjectFromURL(fgui.UIConfig.windowModalWaiting)),this.layoutModalWaitPane(),this.addChild(this._modalWaitPane))}layoutModalWaitPane(){if(null!=this._contentArea){var pt=this._frame.localToGlobal();pt=this.globalToLocal(pt.x,pt.y,pt),this._modalWaitPane.setXY(pt.x+this._contentArea.x,pt.y+this._contentArea.y),this._modalWaitPane.setSize(this._contentArea.width,this._contentArea.height)}else this._modalWaitPane.setSize(this.width,this.height)}closeModalWait(requestingCmd=0){return(0==requestingCmd||this._requestingCmd==requestingCmd)&&(this._requestingCmd=0,this._modalWaitPane&&null!=this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane),!0)}get modalWaiting(){return this._modalWaitPane&&null!=this._modalWaitPane.parent}init(){if(!this._inited&&!this._loading)if(this._uiSources.length>0){this._loading=!1;for(var cnt=this._uiSources.length,i=0;i<cnt;i++){var lib=this._uiSources[i];lib.loaded||(lib.load(this.__uiLoadComplete,this),this._loading=!0)}this._loading||this._init()}else this._init()}onInit(){}onShown(){}onHide(){}doShowAnimation(){this.onShown()}doHideAnimation(){this.hideImmediately()}__uiLoadComplete(){for(var cnt=this._uiSources.length,i=0;i<cnt;i++)if(!this._uiSources[i].loaded)return;this._loading=!1,this._init()}_init(){this._inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()}dispose(){null!=this.parent&&this.hideImmediately(),super.dispose()}closeEventHandler(){this.hide()}__onShown(){this._inited?this.doShowAnimation():this.init()}__onHidden(){this.closeModalWait(),this.onHide()}__mouseDown(){this.isShowing&&this.bringToFontOnClick&&this.bringToFront()}__dragStart(evt){fgui.GObject.cast(evt.currentTarget).stopDrag(),this.startDrag()}}}(fgui||(fgui={})),function(fgui){class DragDropManager{constructor(){this._agent=new fgui.GLoader,this._agent.draggable=!0,this._agent.touchable=!1,this._agent.setSize(100,100),this._agent.setPivot(.5,.5,!0),this._agent.align="center",this._agent.verticalAlign="middle",this._agent.sortingOrder=1e6,this._agent.on(fgui.Events.DRAG_END,this,this.__dragEnd)}static get inst(){return null==DragDropManager._inst&&(DragDropManager._inst=new DragDropManager),DragDropManager._inst}get dragAgent(){return this._agent}get dragging(){return null!=this._agent.parent}startDrag(source,icon,sourceData,touchPointID=-1){if(null==this._agent.parent){this._sourceData=sourceData,this._agent.url=icon,fgui.GRoot.inst.addChild(this._agent);var pt=fgui.GRoot.inst.globalToLocal(Laya.stage.mouseX,Laya.stage.mouseY);this._agent.setXY(pt.x,pt.y),this._agent.startDrag(touchPointID)}}cancel(){null!=this._agent.parent&&(this._agent.stopDrag(),fgui.GRoot.inst.removeChild(this._agent),this._sourceData=null)}__dragEnd(evt){if(null!=this._agent.parent){fgui.GRoot.inst.removeChild(this._agent);var sourceData=this._sourceData;this._sourceData=null;for(var obj=fgui.GObject.cast(evt.target);null!=obj;){if(obj.displayObject.hasListener(fgui.Events.DROP))return obj.requestFocus(),void obj.displayObject.event(fgui.Events.DROP,[sourceData,fgui.Events.createEvent(fgui.Events.DROP,obj.displayObject,evt)]);obj=obj.parent}}}}fgui.DragDropManager=DragDropManager}(fgui||(fgui={})),function(fgui){class TranslationHelper{constructor(){}static loadFromXML(source){TranslationHelper.strings={};for(var xml=Laya.Utils.parseXMLFromString(source),nodes=TranslationHelper.findChildNode(xml,"resources").childNodes,length1=nodes.length,i1=0;i1<length1;i1++){var cxml=nodes[i1];if("string"==cxml.nodeName){var key=cxml.getAttribute("name"),text=cxml.textContent,i=key.indexOf("-");if(-1==i)continue;var key2=key.substr(0,i),key3=key.substr(i+1),col=TranslationHelper.strings[key2];col||(col={},TranslationHelper.strings[key2]=col),col[key3]=text}}}static translateComponent(item){if(null!=TranslationHelper.strings){var compStrings=TranslationHelper.strings[item.owner.id+item.id];if(null!=compStrings){var elementId,value,nextPos,itemCount,i,j,k,dataLen,curPos,valueCnt,buffer=item.rawData;buffer.seek(0,2);var childCount=buffer.getInt16();for(i=0;i<childCount;i++){dataLen=buffer.getInt16(),curPos=buffer.pos,buffer.seek(curPos,0);var type=buffer.readByte();buffer.skip(4),elementId=buffer.readS(),type==fgui.ObjectType.Component&&buffer.seek(curPos,6)&&(type=buffer.readByte()),buffer.seek(curPos,1),null!=(value=compStrings[elementId+"-tips"])&&buffer.writeS(value),buffer.seek(curPos,2);var gearCnt=buffer.getInt16();for(j=0;j<gearCnt;j++){if(nextPos=buffer.getInt16(),nextPos+=buffer.pos,6==buffer.readByte()){for(buffer.skip(2),valueCnt=buffer.getInt16(),k=0;k<valueCnt;k++)null!=buffer.readS()&&(null!=(value=compStrings[elementId+"-texts_"+k])?buffer.writeS(value):buffer.skip(2));buffer.readBool()&&null!=(value=compStrings[elementId+"-texts_def"])&&buffer.writeS(value)}buffer.pos=nextPos}switch(type){case fgui.ObjectType.Text:case fgui.ObjectType.RichText:case fgui.ObjectType.InputText:null!=(value=compStrings[elementId])&&(buffer.seek(curPos,6),buffer.writeS(value)),null!=(value=compStrings[elementId+"-prompt"])&&(buffer.seek(curPos,4),buffer.writeS(value));break;case fgui.ObjectType.List:for(buffer.seek(curPos,8),buffer.skip(2),itemCount=buffer.getInt16(),j=0;j<itemCount;j++)nextPos=buffer.getInt16(),nextPos+=buffer.pos,buffer.skip(2),null!=(value=compStrings[elementId+"-"+j])?buffer.writeS(value):buffer.skip(2),null!=(value=compStrings[elementId+"-"+j+"-0"])&&buffer.writeS(value),buffer.pos=nextPos;break;case fgui.ObjectType.Label:buffer.seek(curPos,6)&&buffer.readByte()==type&&(null!=(value=compStrings[elementId])?buffer.writeS(value):buffer.skip(2),buffer.skip(2),buffer.readBool()&&buffer.skip(4),buffer.skip(4),buffer.readBool()&&null!=(value=compStrings[elementId+"-prompt"])&&buffer.writeS(value));break;case fgui.ObjectType.Button:buffer.seek(curPos,6)&&buffer.readByte()==type&&(null!=(value=compStrings[elementId])?buffer.writeS(value):buffer.skip(2),null!=(value=compStrings[elementId+"-0"])&&buffer.writeS(value));break;case fgui.ObjectType.ComboBox:if(buffer.seek(curPos,6)&&buffer.readByte()==type){for(itemCount=buffer.getInt16(),j=0;j<itemCount;j++)nextPos=buffer.getInt16(),nextPos+=buffer.pos,null!=(value=compStrings[elementId+"-"+j])&&buffer.writeS(value),buffer.pos=nextPos;null!=(value=compStrings[elementId])&&buffer.writeS(value)}}buffer.pos=curPos+dataLen}}}}static findChildNode(xml,name){var col=xml.childNodes,length1=col.length;if(length1>0)for(var i1=0;i1<length1;i1++){var cxml=col[i1];if(cxml.nodeName==name)return cxml}return null}}TranslationHelper.strings=null,fgui.TranslationHelper=TranslationHelper}(fgui||(fgui={}));