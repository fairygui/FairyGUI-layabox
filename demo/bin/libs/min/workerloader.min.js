var createImageBitmapOK=!!self.createImageBitmap;onmessage=function(e){loadImage2(e.data),isSet||(isSet=!0,setInterval(workerloop,1e3))};var isSet=!0;function workerloop(){myTrace("png:workerloop")}var enableTrace=!1,ifShowTraceToMain=!1;function myTrace(e){enableTrace&&(console.log("png:"+e),ifShowTraceToMain&&showMsgToMain(e))}function loadImage2(e){var a,o=!1;(a=new XMLHttpRequest).open("GET",e,!0),a.responseType="arraybuffer",myTrace("load:"+e),a.onload=function(){var t=a.response||a.mozResponseArrayBuffer;(myTrace("onload:"+e),200!=a.status&&0!=a.status||t.byteLength<10)?o||(o=!0,pngFail(e,"loadFail from onload"+a.status)):doCreateImageBitmap(new Uint8Array(t),e)},a.onerror=function(a){pngFail(e,"loadFail")},a.send(null)}function doCreateImageBitmap(e,a){try{var o=getTimeNow();e=new self.Blob([e],{type:"image/png"}),self.createImageBitmap(e).then((function(e){var t={};t.url=a,t.imageBitmap=e,t.dataType="imageBitmap",t.startTime=o,t.decodeTime=getTimeNow()-o,t.sendTime=getTimeNow(),myTrace("png:Decode By createImageBitmap,"+t.decodeTime,a),t.type="Image",postMessage(t,[t.imageBitmap])})).catch((function(e){showMsgToMain("catch e:"+e),pngFail(a,"parse fail"+e+":ya")}))}catch(e){pngFail(a,"parse fail"+e.toString()+":ya")}}function getTimeNow(){return(new Date).getTime()}function disableWorker(e){var a={};a.url=url,a.imagedata=null,a.type="Disable",a.msg=e,postMessage(a)}function pngFail(e,a){var o={};o.url=e,o.imagedata=null,o.type="Image",o.msg=a,console.log("png:"+a+" "+e),postMessage(o)}function showMsgToMain(e){var a={type:"Msg"};a.msg=e,postMessage(a)}